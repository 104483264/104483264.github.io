<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>电脑商城项目(springboot+mybatis) | 卑微小陈的Blog</title><meta name="keywords" content="springboot"><meta name="author" content="卑微小陈"><meta name="copyright" content="卑微小陈"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文章目录  项目环境搭建  1.项目分析 2.项目基本环境 3.项目创建 4.项目测试  4.1 测试能否成功连接数据库 4.2 测试静态资源能否正常加载     用户注册功能  1.创建数据表 2.创建用户的实体类 3.注册-持久层  3.1 规划需要执行的 SQL 语句 3.2 设计接口和抽象方法及实现 3.3 编写映射 3.4 单元测试   4.注册-业务层  4.1 规划异常 4.2 设计">
<meta property="og:type" content="article">
<meta property="og:title" content="电脑商城项目(springboot+mybatis)">
<meta property="og:url" content="https://104483264.github.io/posts/b75a4e69.html">
<meta property="og:site_name" content="卑微小陈的Blog">
<meta property="og:description" content="文章目录  项目环境搭建  1.项目分析 2.项目基本环境 3.项目创建 4.项目测试  4.1 测试能否成功连接数据库 4.2 测试静态资源能否正常加载     用户注册功能  1.创建数据表 2.创建用户的实体类 3.注册-持久层  3.1 规划需要执行的 SQL 语句 3.2 设计接口和抽象方法及实现 3.3 编写映射 3.4 单元测试   4.注册-业务层  4.1 规划异常 4.2 设计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/6d/wallhaven-6dkg8w.png">
<meta property="article:published_time" content="2022-12-20T04:00:00.000Z">
<meta property="article:modified_time" content="2022-12-20T04:27:55.861Z">
<meta property="article:author" content="卑微小陈">
<meta property="article:tag" content="springboot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/6d/wallhaven-6dkg8w.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://104483264.github.io/posts/b75a4e69"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#425aef"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '电脑商城项目(springboot+mybatis)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-20 12:27:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/css/runtime/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="卑微小陈的Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw fas fa-archive faa-tada"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/artitalk/"><i class="fa-fw fas fa-comment-dots faa-tada"></i><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/"><i class="fa-fw fas fa-music faa-tada"></i><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/fcircle/"><i class="fa-fw fab fa-artstation faa-tada"></i><span> 朋友圈</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw fas fa-link faa-tada"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili1"></use></svg><span> 追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"></use></svg><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/6d/wallhaven-6dkg8w.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">卑微小陈的Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw fas fa-archive faa-tada"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/artitalk/"><i class="fa-fw fas fa-comment-dots faa-tada"></i><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/"><i class="fa-fw fas fa-music faa-tada"></i><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/fcircle/"><i class="fa-fw fab fa-artstation faa-tada"></i><span> 朋友圈</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw fas fa-link faa-tada"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili1"></use></svg><span> 追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"></use></svg><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">电脑商城项目(springboot+mybatis)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-20T04:00:00.000Z" title="发表于 2022-12-20 12:00:00">2022-12-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-20T04:27:55.861Z" title="更新于 2022-12-20 12:27:55">2022-12-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E8%AE%BE%E9%A1%B9%E7%9B%AE/">课设项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">24.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>92分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="电脑商城项目(springboot+mybatis)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h3><ul>
<li><ul>
<li><a href="#_9">项目环境搭建</a></li>
<li><ul>
<li><a href="#1_11">1.项目分析</a></li>
<li><a href="#2_29">2.项目基本环境</a></li>
<li><a href="#3_43">3.项目创建</a></li>
<li><a href="#4_71">4.项目测试</a></li>
<li><ul>
<li><a href="#41_73">4.1 测试能否成功连接数据库</a></li>
<li><a href="#42_99">4.2 测试静态资源能否正常加载</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_111">用户注册功能</a></li>
<li><ul>
<li><a href="#1_113">1.创建数据表</a></li>
<li><a href="#2_168">2.创建用户的实体类</a></li>
<li><a href="#3_220">3.注册-持久层</a></li>
<li><ul>
<li><a href="#31SQL_224">3.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#32_240">3.2 设计接口和抽象方法及实现</a></li>
<li><a href="#33_271">3.3 编写映射</a></li>
<li><a href="#34_357">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#4_401">4.注册-业务层</a></li>
<li><ul>
<li><a href="#41_416">4.1 规划异常</a></li>
<li><a href="#42_483">4.2 设计接口和抽象方法</a></li>
<li><a href="#43_571">4.3 单元测试</a></li>
</ul>
</li>
<li><a href="#5_613">5.注册-控制层</a></li>
<li><ul>
<li><a href="#51_615">5.1 创建响应</a></li>
<li><a href="#52_655">5.2 设计请求</a></li>
<li><a href="#53_666">5.3 处理请求</a></li>
<li><a href="#54_701">5.4 控制层优化设计</a></li>
</ul>
</li>
<li><a href="#6_746">6.注册-前端页面</a></li>
<li><ul>
<li><a href="#61ajax_748">6.1 熟悉 ajax</a></li>
<li><a href="#62js_790">6.2 前端 js 编写</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_841">用户登录功能</a></li>
<li><ul>
<li><a href="#1_845">1.登录-持久层</a></li>
<li><ul>
<li><a href="#SQL_847">规划需要执行的 SQL 语句</a></li>
</ul>
</li>
<li><a href="#2_861">2.登录-业务层</a></li>
<li><ul>
<li><a href="#21_863">2.1 规划异常</a></li>
<li><a href="#22_885">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_946">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_961">3.登录-控制层</a></li>
<li><ul>
<li><a href="#31_963">3.1 处理异常</a></li>
<li><a href="#32_979">3.2 设计请求</a></li>
<li><a href="#33_986">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_1010">4.登录-前端页面</a></li>
<li><a href="#5session_1044">5.用 session 存储和获取用户数据</a></li>
<li><a href="#6_1096">6.拦截器</a></li>
</ul>
</li>
<li><a href="#_1184">修改密码</a></li>
<li><ul>
<li><a href="#1_1188">1.修改密码-持久层</a></li>
<li><ul>
<li><a href="#11SQL_1190">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_1206">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_1232">1.3 编写映射</a></li>
<li><a href="#14_1250">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_1268">2.修改密码-业务层</a></li>
<li><ul>
<li><a href="#21_1270">2.1 规划异常</a></li>
<li><a href="#22_1283">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_1336">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_1345">3.修改密码-控制层</a></li>
<li><ul>
<li><a href="#31_1347">3.1 处理异常</a></li>
<li><a href="#32_1360">3.2 设计请求</a></li>
<li><a href="#33_1367">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_1383">4.修改密码-前端页面</a></li>
</ul>
</li>
<li><a href="#_1411">个人资料</a></li>
<li><ul>
<li><a href="#1_1415">1.个人资料-持久层</a></li>
<li><ul>
<li><a href="#11SQL_1417">1.1 规划 SQL 语句</a></li>
<li><a href="#12_1433">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_1446">1.3 编写映射</a></li>
<li><a href="#14_1465">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_1479">2.个人资料-业务层</a></li>
<li><ul>
<li><a href="#21_1487">2.1 规划异常</a></li>
<li><a href="#22_1492">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_1552">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_1574">3.个人资料-控制层</a></li>
<li><ul>
<li><a href="#31_1576">3.1 处理异常</a></li>
<li><a href="#32_1580">3.2 设计请求</a></li>
<li><a href="#33_1596">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_1625">4.个人资料-前端页面</a></li>
</ul>
</li>
<li><a href="#_1696">上传头像</a></li>
<li><ul>
<li><a href="#1_1704">1.上传头像-持久层</a></li>
<li><ul>
<li><a href="#11SQL_1706">1.1SQL 语句的规划</a></li>
<li><a href="#12_1714">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_1739">1.3 编写映射</a></li>
<li><a href="#14_1755">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_1768">2.上传头像-业务层</a></li>
<li><ul>
<li><a href="#21_1770">2.1 规划异常</a></li>
<li><a href="#22_1777">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_1813">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_1822">3.上传头像-控制层</a></li>
<li><ul>
<li><a href="#31_1828">3.1 规划异常</a></li>
<li><a href="#32_1846">3.2 处理异常</a></li>
<li><a href="#33_1868">3.3 设计请求</a></li>
<li><a href="#34_1875">3.4 处理请求</a></li>
</ul>
</li>
<li><a href="#4_1962">4.上传头像-前端页面</a></li>
<li><a href="#5bug_1972">5.前端页面优化——修复 bug</a></li>
<li><ul>
<li><a href="#51_1974">5.1 更改默认的大小限制</a></li>
<li><a href="#52_2008">5.2 上传后显示头像</a></li>
<li><a href="#53_2061">5.3 登录后显示头像</a></li>
<li><a href="#54_2108">5.4 显示最新头像</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_2120">新增收货地址</a></li>
<li><ul>
<li><a href="#1_2122">1.创建数据表</a></li>
<li><a href="#2_2159">2.创建收货地址的实体类</a></li>
<li><a href="#3_2189">3.新增收货地址-持久层</a></li>
<li><ul>
<li><a href="#31_2191">3.1 各功能的开发顺序</a></li>
<li><a href="#32SQL_2200">3.2 规划需要执行的 SQL 语句</a></li>
<li><a href="#33_2214">3.3 设计接口和抽象方法</a></li>
<li><a href="#34_2237">3.4 编写映射</a></li>
<li><a href="#35_2296">3.5 单元测试</a></li>
</ul>
</li>
<li><a href="#4_2325">4.新增收货地址-业务层</a></li>
<li><ul>
<li><a href="#41_2327">4.1 规划异常</a></li>
<li><a href="#42_2346">4.2 设计接口和抽象方法及实现</a></li>
<li><a href="#43_2440">4.3 单元测试</a></li>
</ul>
</li>
<li><a href="#5_2461">5.新增收货地址-控制层</a></li>
<li><ul>
<li><a href="#51_2463">5.1 处理异常</a></li>
<li><a href="#52_2474">5.2 设计请求</a></li>
<li><a href="#53_2481">5.3 处理请求</a></li>
</ul>
</li>
<li><a href="#6_2504">6.新增收货地址-前端页面</a></li>
</ul>
</li>
<li><a href="#_2529">获取省市区列表</a></li>
<li><ul>
<li><a href="#1_2535">1.创建数据表</a></li>
<li><a href="#2_2564">2.创建省市区的实体类</a></li>
<li><a href="#3_2583">3.获取省市区列表-持久层</a></li>
<li><ul>
<li><a href="#31SQL_2585">3.1 规划需执行的 SQL 语句</a></li>
<li><a href="#32_2591">3.2 设计接口和抽象方法</a></li>
<li><a href="#33_2609">3.3 编写映射</a></li>
<li><a href="#34_2626">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#4_2649">4.获取省市区列表-业务层</a></li>
<li><ul>
<li><a href="#41_2651">4.1 规划异常</a></li>
<li><a href="#42_2655">4.2 设计接口和抽象方法及实现</a></li>
<li><a href="#43_2696">4.3 单元测试</a></li>
</ul>
</li>
<li><a href="#5_2718">5.获取省市区列表-控制层</a></li>
<li><ul>
<li><a href="#51_2720">5.1 设计请求</a></li>
<li><a href="#52_2727">5.2 处理请求</a></li>
</ul>
</li>
<li><a href="#6_2758">6.获取省市区列表-前端页面</a></li>
</ul>
</li>
<li><a href="#_2773">获取省市区名称</a></li>
<li><ul>
<li><a href="#1_2777">1.获取省市区名称-持久层</a></li>
<li><ul>
<li><a href="#31SQL_2779">3.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#32_2787">3.2 设计接口和抽象方法</a></li>
<li><a href="#33_2795">3.3 编写映射</a></li>
<li><a href="#34_2805">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_2817">2.获取省市区名称-业务层</a></li>
<li><ul>
<li><a href="#21_2819">2.1 规划异常</a></li>
<li><a href="#22_2823">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_2840">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_2844">3.获取省市区名称-控制层</a></li>
<li><a href="#4_2848">4.获取省市区名称-业务层优化</a></li>
<li><a href="#5_2874">5.获取省市区名称-前端页面</a></li>
</ul>
</li>
<li><a href="#_3007">收货地址列表展示</a></li>
<li><ul>
<li><a href="#1_3009">1.收货地址列表展示-持久层</a></li>
<li><ul>
<li><a href="#11SQL_3011">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_3021">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_3034">1.3 编写映射</a></li>
<li><a href="#14_3045">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_3055">2.收货地址列表展示-业务层</a></li>
<li><ul>
<li><a href="#21_3057">2.1 规划异常</a></li>
<li><a href="#22_3061">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_3101">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_3105">3.收货地址列表展示-控制层</a></li>
<li><ul>
<li><a href="#31_3107">3.1 处理异常</a></li>
<li><a href="#32_3111">3.2 设计请求</a></li>
<li><a href="#33_3118">3.3 处理请求</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_3191">设置默认收货地址</a></li>
<li><ul>
<li><a href="#1_3193">1.设置默认收货地址-持久层</a></li>
<li><ul>
<li><a href="#11SQL_3195">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_3219">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_3245">1.3 编写映射</a></li>
<li><a href="#14_3269">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_3288">2.设置默认收货地址-业务层</a></li>
<li><ul>
<li><a href="#21_3290">2.1 规划异常</a></li>
<li><a href="#22_3312">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_3367">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_3378">3.设置默认收货地址-控制层</a></li>
<li><ul>
<li><a href="#31_3380">3.1 处理异常</a></li>
<li><a href="#32_3394">3.2 设计请求</a></li>
<li><a href="#33_3401">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_3422">4.设置默认收货地址-前端页面</a></li>
</ul>
</li>
<li><a href="#_3468">删除收货地址</a></li>
<li><ul>
<li><a href="#1_3470">1.删除收货地址-持久层</a></li>
<li><ul>
<li><a href="#11SQL_3472">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_3494">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_3514">1.3 编写映射</a></li>
<li><a href="#14_3530">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_3545">2.删除收货地址-业务层</a></li>
<li><ul>
<li><a href="#21_3547">2.1 规划异常</a></li>
<li><a href="#22_3561">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_3631">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_3640">3.删除收货地址-控制层</a></li>
<li><ul>
<li><a href="#31_3642">3.1 处理异常</a></li>
<li><a href="#32_3653">3.2 设计请求</a></li>
<li><a href="#33_3660">3.3 处理请求</a></li>
<li><a href="#34_3673">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#4_3679">4.删除收货地址-前端页面</a></li>
</ul>
</li>
<li><a href="#_3717">商品热销排行</a></li>
<li><ul>
<li><a href="#1_3719">1.创建数据表</a></li>
<li><a href="#2_3751">2.创建商品的实体类</a></li>
<li><a href="#3_3776">3.商品热销排行-持久层</a></li>
<li><ul>
<li><a href="#31_SQL_3778">3.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#32__3786">3.2 设计接口和抽象方法</a></li>
<li><a href="#33__3800">3.3 编写映射</a></li>
</ul>
</li>
<li><a href="#4_3827">4.商品热销排行-业务层</a></li>
<li><ul>
<li><a href="#41__3829">4.1 规划异常</a></li>
<li><a href="#42__3833">4.2 设计接口和抽象方法及实现</a></li>
</ul>
</li>
<li><a href="#5_3879">5.商品热销排行-控制层</a></li>
<li><ul>
<li><a href="#51__3881">5.1 处理异常</a></li>
<li><a href="#52__3885">5.2 设计请求</a></li>
<li><a href="#53__3892">5.3 处理请求</a></li>
</ul>
</li>
<li><a href="#6_3920">6.商品-热销排行-前端页面</a></li>
</ul>
</li>
<li><a href="#_3976">显示商品详情</a></li>
<li><ul>
<li><a href="#1_3978">1.显示商品详情-持久层</a></li>
<li><ul>
<li><a href="#11SQL_3980">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_3988">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_4001">1.3 编写映射</a></li>
</ul>
</li>
<li><a href="#2_4011">2.显示商品详情-业务层</a></li>
<li><ul>
<li><a href="#21_4013">2.1 规划异常</a></li>
<li><a href="#22_4024">2.2 设计接口和抽象方法及实现</a></li>
</ul>
</li>
<li><a href="#3_4058">3.显示商品详情-控制层</a></li>
<li><ul>
<li><a href="#31_4060">3.1 处理异常</a></li>
<li><a href="#32__4071">3.2 设计请求</a></li>
<li><a href="#33_4080">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_4092">4.显示商品详情-前端页面</a></li>
</ul>
</li>
<li><a href="#_4138">加入购物车</a></li>
<li><ul>
<li><a href="#1_4140">1.创建数据表</a></li>
<li><a href="#2_4165">2.创建购物车的实体类</a></li>
<li><a href="#3_4185">3.加入购物车-持久层</a></li>
<li><ul>
<li><a href="#31SQL_4187">3.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#32_4207">3.2 设计接口和抽象方法</a></li>
<li><a href="#33_4247">3.3 编写映射</a></li>
<li><a href="#34_4287">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#4_4321">4.加入购物车-业务层</a></li>
<li><ul>
<li><a href="#41_4323">4.1 规划异常</a></li>
<li><a href="#42_4327">4.2 设计接口和抽象方法及实现</a></li>
<li><a href="#43_4414">4.3 单元测试</a></li>
</ul>
</li>
<li><a href="#5_4432">5.加入购物车-控制层</a></li>
<li><ul>
<li><a href="#51_4434">5.1 处理异常</a></li>
<li><a href="#52_4438">5.2 设计请求</a></li>
<li><a href="#53_4445">5.3 处理请求</a></li>
</ul>
</li>
<li><a href="#6_4470">6.加入购物车-前端页面</a></li>
</ul>
</li>
<li><a href="#_4527">显示购物车列表</a></li>
<li><ul>
<li><a href="#1_4529">1.显示购物车列表-持久层</a></li>
<li><ul>
<li><a href="#11SQL_4531">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_4565">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_4603">1.3 编写映射</a></li>
<li><a href="#14_4628">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_4640">2.显示购物车列表-业务层</a></li>
<li><ul>
<li><a href="#21__4642">2.1 规划异常</a></li>
<li><a href="#22_4646">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_4668">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_4672">3.显示购物车列表-控制层</a></li>
<li><ul>
<li><a href="#31__4674">3.1 处理异常</a></li>
<li><a href="#32__4678">3.2 设计请求</a></li>
<li><a href="#33__4685">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_4699">4.显示购物车列表-前端页面</a></li>
</ul>
</li>
<li><a href="#_4786">增加商品数量</a></li>
<li><ul>
<li><a href="#1_4792">1.增加购物车商品数量-持久层</a></li>
<li><ul>
<li><a href="#11SQL_4794">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_4804">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_4812">1.3 编写映射</a></li>
<li><a href="#14_4822">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_4835">2.增加购物车商品数量-业务层</a></li>
<li><ul>
<li><a href="#21_4837">2.1 规划异常</a></li>
<li><a href="#22_4850">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_4901">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_4905">3.增加购物车商品数量-控制层</a></li>
<li><ul>
<li><a href="#31_4907">3.1 处理异常</a></li>
<li><a href="#32_4918">3.2 设计请求</a></li>
<li><a href="#33_4925">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_4942">4.增加购物车商品数量-前端页面</a></li>
</ul>
</li>
<li><a href="#_4984">确认订单</a></li>
<li><ul>
<li><a href="#1_4986">1.确认订单-持久层</a></li>
<li><ul>
<li><a href="#11SQL_4988">1.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#12_5014">1.2 设计接口和抽象方法</a></li>
<li><a href="#13_5022">1.3 配置映射</a></li>
<li><a href="#14_5056">1.4 单元测试</a></li>
</ul>
</li>
<li><a href="#2_5071">2.确认订单-业务层</a></li>
<li><ul>
<li><a href="#21_5073">2.1 规划异常</a></li>
<li><a href="#22_5077">2.2 设计接口和抽象方法及实现</a></li>
<li><a href="#23_5112">2.3 单元测试</a></li>
</ul>
</li>
<li><a href="#3_5116">3.确认订单-控制层</a></li>
<li><ul>
<li><a href="#31_5118">3.1 处理异常</a></li>
<li><a href="#32_5122">3.2 设计请求</a></li>
<li><a href="#33_5129">3.3 处理请求</a></li>
</ul>
</li>
<li><a href="#4_5143">4.确认订单-前端页面</a></li>
<li><ul>
<li><a href="#41_5145">4.1 显示勾选的购物车数据</a></li>
<li><a href="#42_5224">4.2 显示选择收货地址</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_5277">创建订单</a></li>
<li><ul>
<li><a href="#1_5279">1.创建数据表</a></li>
<li><a href="#2_5328">2.创建用户的实体类</a></li>
<li><a href="#3_5375">3.创建订单-持久层</a></li>
<li><ul>
<li><a href="#31SQL_5377">3.1 规划需要执行的 SQL 语句</a></li>
<li><a href="#32_5393">3.2 实现接口和抽象方法</a></li>
<li><a href="#33_5415">3.3 编写映射</a></li>
<li><a href="#34_5452">3.4 单元测试</a></li>
</ul>
</li>
<li><a href="#4_5483">4.创建订单-业务层</a></li>
<li><ul>
<li><a href="#41_5485">4.1 规划异常</a></li>
<li><a href="#42_5489">4.2 实现接口和抽象方法及实现</a></li>
<li><a href="#43_5643">4.3 单元测试</a></li>
</ul>
</li>
<li><a href="#5_5666">5.创建订单-控制层</a></li>
<li><ul>
<li><a href="#51_5668">5.1 处理异常</a></li>
<li><a href="#52_5672">5.2 设计请求</a></li>
<li><a href="#53_5679">5.3 处理请求</a></li>
</ul>
</li>
<li><a href="#6_5702">6.创建订单-前端页面</a></li>
</ul>
</li>
<li><a href="#AOP_5731">AOP</a></li>
<li><ul>
<li><a href="#1Spring_AOP_5737">1.Spring AOP</a></li>
<li><a href="#2_5748">2.切面方法</a></li>
<li><a href="#3__5758">3 统计业务方法执行时长</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="项目环境搭建"><a href="#项目环境搭建" class="headerlink" title="项目环境搭建"></a>项目环境搭建</h2><h3 id="1-项目分析"><a href="#1-项目分析" class="headerlink" title="1.项目分析"></a>1.项目分析</h3><ol>
<li>项目功能:登录,注册,热销商品,用户管理(密码,个人信息,头像,收货地址),购物车(展示,增加,删除),订单模块</li>
<li>开发顺序:注册,登录,用户管理,购物车,商品,订单模块</li>
<li><p>某一个模块的开发顺序:</p>
<ul>
<li>持久层开发:依据前端页面的设置规划相关的 SQL 语句,以及进行配置</li>
<li>业务层开发:核心功能控制,业务操作以及异常的处理</li>
<li>控制层开发:接收请求,处理响应</li>
<li>前端开发:JS,Query,AJAX 这些技术来连接后台</li>
</ul>
</li>
</ol>
<h3 id="2-项目基本环境"><a href="#2-项目基本环境" class="headerlink" title="2.项目基本环境"></a>2.项目基本环境</h3><ol>
<li>JDK:1.8 版本及以上</li>
<li>maven:需要配置到 idea,3.6.1 版本及以上</li>
<li>数据库:MariaDB,MySQL,要求是 5.1 版本及以上</li>
<li>开发的平台:idea 开发</li>
</ol>
<hr>
<ol>
<li>项目名称:store,表示商城</li>
<li>结构:com.cy.store</li>
<li>资源文件:resources 文件夹下(static,templates)</li>
<li>单元测试:test.com.cy.store</li>
</ol>
<h3 id="3-项目创建"><a href="#3-项目创建" class="headerlink" title="3.项目创建"></a>3.项目创建</h3><ol>
<li>Create New Project-&gt;</li>
<li>选择 Spring Initializr,点击 next</li>
<li>跳转到 Project Metadata 页面,该页面的 Group 填写域 com 和自己起的域名 cy(即 com.cy)==;Artifact 填写项目名 store;==Java Version 版本选择自己安装的版本,点击 next</li>
<li><p>选择需要导入的 jar 包:</p>
<ul>
<li>前后端的连接 jar 包:Web 目录下的 Spring web</li>
<li>mybatis 的 jar 包:SQL 目录下的 Mybatis Framework</li>
<li>mysql 数据库的驱动:SQL 目录下的 MySQL Driver</li>
</ul>
</li>
<li><p>创建一个数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database store character set utf8;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 application.properties 文件中配置数据库的连接源信息</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/store?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/shanghai</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-项目测试"><a href="#4-项目测试" class="headerlink" title="4.项目测试"></a>4.项目测试</h3><h4 id="4-1-测试能否成功连接数据库"><a href="#4-1-测试能否成功连接数据库" class="headerlink" title="4.1 测试能否成功连接数据库"></a>4.1 测试能否成功连接数据库</h4><ul>
<li>启动 Springboot 主类,看 idea 中是否有对应的 spring 图形输出</li>
<li><p>若 idea 有对应的 spring 图形输出开始第二步测试:在单元测试中测试数据库的连接是否可以加载:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoreApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//自动装配</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        System.out.println(dataSource.getConnection());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 getConnection 方法,若成功返回 HikariProxyConnection@189194499 wrapping com.mysql.cj.jdbc.ConnectionImpl@2b0e9f30 则说明成功连接数据库,其中 Hikari 是一个连接池,用来管理数据库的连接对象,是 springboot 默认内部整合的连接池,该连接池号称世界上最快的连接池,底层仍然采用 c3p0 来管理数据库的连接对象</p>
</li>
</ul>
<h4 id="4-2-测试静态资源能否正常加载"><a href="#4-2-测试静态资源能否正常加载" class="headerlink" title="4.2 测试静态资源能否正常加载"></a>4.2 测试静态资源能否正常加载</h4><p>将静态资源(SpringBoot 电脑商城项目-V1.0\tools\pages_src\pages*)复制到 static 目录下重启项目并尝试访问 localhost:8080/web/login.html(因为 static 是默认根目录,所以不是 localhost:8080/static/web/login.html)</p>
<p>如果这个过程访问失败,原因是 idea 对于 JS 代码的兼容性较差,编写了 js 代码但是有的时候不能正常去加载,解决办法有以下四种</p>
<ul>
<li>clear-install:依次点击 MavenProject-&gt;store-&gt;Lifecycle-&gt;clean,等待清哩项目完毕后点击同目录下的 install 重新部署</li>
<li>idea 缓存清理:点击 File 下的 Invalidate Caches/Restart…然后在弹出的窗口中选择 Invalidate and Restart,此时就会自动清除缓存并重新启动 idea</li>
<li>rebuild 重新构建:点击工具栏的 Build 下的 Rebuild Project</li>
<li>重启电脑</li>
</ul>
<h2 id="用户注册功能"><a href="#用户注册功能" class="headerlink" title="用户注册功能"></a>用户注册功能</h2><h3 id="1-创建数据表"><a href="#1-创建数据表" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.选中数据表:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use store</span><br></pre></td></tr></table></figure>
<p>2.创建 t_user 表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_user (</span><br><span class="line">	uid INT AUTO_INCREMENT COMMENT &#x27;用户id&#x27;,</span><br><span class="line">	username VARCHAR(20) NOT NULL UNIQUE COMMENT &#x27;用户名&#x27;,</span><br><span class="line">	`password` CHAR(32) NOT NULL COMMENT &#x27;密码&#x27;,</span><br><span class="line">	salt CHAR(36) COMMENT &#x27;盐值&#x27;,</span><br><span class="line">	phone VARCHAR(20) COMMENT &#x27;电话号码&#x27;,</span><br><span class="line">	email VARCHAR(30) COMMENT &#x27;电子邮箱&#x27;,</span><br><span class="line">	gender INT COMMENT &#x27;性别:0-女，1-男&#x27;,</span><br><span class="line">	avatar VARCHAR(50) COMMENT &#x27;头像&#x27;,</span><br><span class="line">	is_delete INT COMMENT &#x27;是否删除：0-未删除，1-已删除&#x27;,</span><br><span class="line">	created_user VARCHAR(20) COMMENT &#x27;日志-创建人&#x27;,</span><br><span class="line">	created_time DATETIME COMMENT &#x27;日志-创建时间&#x27;,</span><br><span class="line">	modified_user VARCHAR(20) COMMENT &#x27;日志-最后修改执行人&#x27;,</span><br><span class="line">	modified_time DATETIME COMMENT &#x27;日志-最后修改时间&#x27;,</span><br><span class="line">	PRIMARY KEY (uid)</span><br><span class="line">) ENGINE=INNODB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<p><strong>tips:</strong></p>
<ul>
<li>注册页面的确认密码功能多数开发中交给前端做,如果两次密码输入不同就不能将数据传给后台</li>
<li>创建 t-user 表时`password` CHAR(32) NOT NULL COMMENT ‘密码’,因为 password 是关键字,所以需要用``号(不是单引号,是 esc 下面的那个键)并且后面用到该字段时(比如往表中插入数据)也需要用``</li>
<li>创建 t_user 表时 salt CHAR(36) COMMENT ‘盐值’,是为了在用户注册时对用户的密码进行加密操作(后续再讲)</li>
<li>数据库中的性别 0 代表女,1 代表男,数据库中用数字而不是文字是因为前端的性别选项是单选框,提交给后台的是数字</li>
<li>创建 t_user 表时 is_delete INT COMMENT ‘是否删除：0-未删除，1-已删除’,的作用:网站中都有注销账号的功能,大部分的网站并不是真的将用户注销了,而是在下次用户登录时进行验证,如果是 0 就放行,如果是 1 就禁止登录</li>
<li>创建 t-user 表时 username VARCHAR(20) NOT NULL UNIQUE COMMENT ‘用户名’,的 UNIQUE 作为约束条件使用户名唯一</li>
<li><p>将来任何一张表都有以下四个字段:</p>
<p>created_user VARCHAR(20) COMMENT ‘创建人’,</p>
<p>created_time DATETIME COMMENT ‘创建时间’,</p>
<p>modified_user VARCHAR(20) COMMENT ‘修改人’,</p>
<p>modified_time DATETIME COMMENT ‘修改时间’,</p>
<p>所以为了开发方便可以把这四个字段作为整个实体类</p>
</li>
</ul>
<h3 id="2-创建用户的实体类"><a href="#2-创建用户的实体类" class="headerlink" title="2.创建用户的实体类"></a>2.创建用户的实体类</h3><p>1.通过表的结构提取出表的公共字段,放在一个实体类的基类中,起名 BaseEntity 基类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String createdUser;</span><br><span class="line">    <span class="keyword">private</span> Date createdTime;</span><br><span class="line">    <span class="keyword">private</span> String modifiedUser;</span><br><span class="line">    <span class="keyword">private</span> Date emodifiedTime;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.创建用户的实体类,并使其继承 BaseEntity 基类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String PASSWORD;</span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> Integer isDelete;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>tips:</strong></p>
<ul>
<li>实体类 User 因为要在网络中以流的形式传输,所以需要 serialize 序列化(但因为其继承的父类 BaseEntity 已经实现序列化,所以就不需要再写 implements Serializable)</li>
<li><p>实体类 BaseEntity 中自动导入 Getter and Setter 方法,euqals()方法,hashCode()方法,toString 方法,其中 euqals()方法,hashCode()方法自动导入步骤:</p>
<ol>
<li>enter+insert</li>
<li>点击 euqals() and hashCode()</li>
<li>勾选 Accept…和 Use 这两段话,并且选择 Template 为 IntelliJ Default</li>
<li>一路 next 到底</li>
</ol>
</li>
<li><p>ssm 框架开发项目的时候需要在实体类上面加@Component 然后 spring 才能自动进行对象的创建维护,而 springboot 不再需要,因为 springboot 遵循的原则是约定大于配置,如果字段名称相同那就可以自动完成字段的初始化</p>
</li>
</ul>
<h3 id="3-注册-持久层"><a href="#3-注册-持久层" class="headerlink" title="3.注册-持久层"></a>3.注册-持久层</h3><p>通过 Mybatis 来操作数据库,也就是在做 mybatis 开发的流程</p>
<h4 id="3-1-规划需要执行的-SQL-语句"><a href="#3-1-规划需要执行的-SQL-语句" class="headerlink" title="3.1 规划需要执行的 SQL 语句"></a>3.1 规划需要执行的 SQL 语句</h4><p>1.用户的注册功能,从后端持久层来看相当于在做数据的插入操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inser into t_user (username)</span><br></pre></td></tr></table></figure>
<p>2.在用户的注册时首先要去查询当前的用户名是否存在,如果存在则不能进行注册,相当于是一条查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_user where username=?</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计接口和抽象方法及实现"><a href="#3-2-设计接口和抽象方法及实现" class="headerlink" title="3.2 设计接口和抽象方法及实现"></a>3.2 设计接口和抽象方法及实现</h4><p>1.定义 Mapper 接口.在项目的目录结构下首先创建一个 mapper 包,在这个包下再根据不同的功能模块来创建 mapper 接口.注册功能需要在 mapper 包下创建 UserMapper 接口然后定义上述两个 SQL 语句的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入用户的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数(增删改都将受影响的行数作为返回值,可以根据返回值来判断是否执行成功)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名来查询用户的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果找到对应的用户则返回这个用户的数据,如果没有找到则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.ssm 框架开发项目的时候需要在 mapper 接口上加@Mapper 用于自动生成相应的接口实现类,在 springboot 也可以这样,但是后续会有很多 mapper 接口,每个接口分别加@Mapper 太麻烦了,所以在启动类类里面指定当前项目的 mapper 接口在哪,然后项目启动的时候会自动加载所有的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.cy.mapper&quot;)</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射"><a href="#3-3-编写映射" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>1.定义 xml 映射文件,与对应的接口进行关联.所有的映射文件都属于资源文件,需要放在 resources 目录下,为了管理方便我们在 resources 目录下创建一个 mapper 文件夹,然后在这个文件夹里存放 mapper 的映射文件</p>
<p>2.创建接口的映射文件,需要和接口的名称保持一致.如 UserMapper.xml</p>
<p>UserMapper.xml 的配置在 Mybatis 官网</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace用于指定当前的映射文件和哪个接口进行映射,需要指定接口的文件路径,路径需要是包的完整路径结构--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3.将配置接口的方法对应到 SQL 语句上</p>
<ul>
<li>insert into () values (),因为 values 后面插入的值是动态值,mybatis 规定需要用占位符来占位,并给占位符起一个变量的名字,且变量的名字需要在占位符#{}内部</li>
<li>创建 t_user 表时 uid INT AUTO_INCREMENT COMMENT ‘用户 id’,中的 AUTO_INCREMENT 表示主键 uid 自增,所以需要 useGeneratedKeys 和 keyProperty</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在sql语句的最上面借助ResultMap标签来自定义映射规则</span></span><br><span class="line"><span class="comment">    id属性:表示给这个映射规则分配一个唯一的id值,对应的就是resultMap=&quot;id属性值&quot;</span></span><br><span class="line"><span class="comment">    type属性:取值是一个类,表示数据库中的查询结果与java中哪个实体类进行结果集的映射</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserEntityMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.cy.store.entity.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将表的字段和类的属性名不一致的进行匹配指定,名称一致的也可以指定,但没必要</span></span><br><span class="line"><span class="comment">        但是,在定义映射规则时无论主键名称是否一致都不能省</span></span><br><span class="line"><span class="comment">        column属性:表示表中的字段名称</span></span><br><span class="line"><span class="comment">        property属性:表示类中的属性名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;is_delete&quot;</span> <span class="attr">property</span>=<span class="string">&quot;isDelete&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdUser&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedUser&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--id属性:表示映射的接口中方法的名称,直接标签的内容部来编写SQL语句--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--useGeneratedKeys=&quot;true&quot;表示开启某个字段的值递增(大部分都是主键递增)</span></span><br><span class="line"><span class="comment">    keyProperty=&quot;uid&quot;表示将表中哪个字段进行递增</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;uid&quot;</span>&gt;</span></span><br><span class="line">    insert into t_user(</span><br><span class="line">        username,`password`,salt,phone,email,gender,avatar,is_delete,</span><br><span class="line">        created_user,created_time,modified_user,modified_time</span><br><span class="line">    ) values (</span><br><span class="line">    #&#123;username&#125;,#&#123;password&#125;,#&#123;salt&#125;,#&#123;phone&#125;,#&#123;email&#125;,#&#123;gender&#125;,#			&#123;avatar&#125;,#&#123;isDelete&#125;,#&#123;createdUser&#125;,#&#123;createdTime&#125;,#&#123;modifiedUser&#125;,#	&#123;modifiedTime&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--select语句在执行的时候查询的结果无非两种:一个对象或多个对象</span></span><br><span class="line"><span class="comment">    resultType:表示查询的结果集类型,用来指定对应映射类的类型,且包含完整的包结构,但此处不能是resultType=&quot;com.cy.store.entity.User&quot;,因为这种写法要求表的字段的名字和类的属性名一模一样</span></span><br><span class="line"><span class="comment">    resultMap:表示当表的字段和类的对象属性名不一致时,来自定义查询结果集的映射规则</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUsername&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where username=#&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>sql 语句匹配规则:如果在 insert 标签里面写了 insert 语句,首先将 insert 语句和某一个方法进行绑定，用到了 id=“”，但是和哪里的方法进行绑定呢，就要用到 namespace=“”，这两步映射就把唯一的 SQL 语句和唯一的方法进行了关联，实际上就是 jdbc 里面 dao 接口的的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer insert（User user） &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">SQL</span> <span class="operator">=</span> <span class="string">&quot;insert into () values ()&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用到映射的好处:使 SQL 语句和 java 代码分离,解耦了,方便后期代码的维护</p>
<p>4.将 mapper 文件的位置注册到 properties 对应的配置文件中.</p>
<p>在 application.properties 文件中增添:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试"><a href="#3-4-单元测试" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>1.每个独立的层编写完毕后需要编写单元测试方法来测试当前的功能:在 test 包结构下创建一个 mapper 包,在这个包下再创建持久层的功能测试,单元测试方法是独立运行,不用启动整个项目,提高了代码的测试效率</p>
<p>2.因为测试方法要用到 mapper 层的接口来访问刚刚写的两个方法,所以要在类里面声明 UserMapper 对象:即 private UserMapper userMapper;且需要加上@Autowired 完成值的初始化,但此时会发现提示”Could not autowire.No beans of’UserMapper’type found”,报错原因是 idea 有自动检测的功能,在 java 中接口是不能够直接创建 bean 的,所以 idea 认为这个语法不合理,但本质上在项目启动时 mybatis 自动创建了接口的动态代理实现类,所以从项目的运行角度讲这不能算是错.解决办法:</p>
<ul>
<li>在 Settings 里面搜索 inspections,依次找到 Spring-&gt;Spring Core-&gt;Code-&gt;Autowiring for Bean Class 然后将 Severity 的 Error 改为 Warning</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootTest表示当前的类是一个测试类,不会随同项目一块打包</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.<span class="doctag">@RunWith</span>表示启动这个单元测试类,否则这个单元测试类是不能运行的,需要传递</span></span><br><span class="line"><span class="comment"> * 一个参数,该参数必须是SpringRunner.class即SpringRunner的实例类型</span></span><br><span class="line"><span class="comment"> * 2.敲完<span class="doctag">@RunWith</span>(SpringRunner.class)后鼠标分别放在SpringRunner和<span class="doctag">@RunWith</span>上按alt+enter分别导入包</span></span><br><span class="line"><span class="comment"> * 3.单元测试类中出现的方法必须是单元测试方法</span></span><br><span class="line"><span class="comment"> * 4.单元测试方法的特点:必须被<span class="doctag">@Test</span>注解修饰;返回值类型必须是void;方法的参数列表不指定任何类型;方法的访问修饰符必须是public</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">        System.out.println(rows);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findByUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-注册-业务层"><a href="#4-注册-业务层" class="headerlink" title="4.注册-业务层"></a>4.注册-业务层</h3><p>业务层的核心功能:</p>
<ul>
<li>接受前端从控制器流转过来的数据</li>
<li>结合真实的注册业务来完成功能业务逻辑的调转和流程</li>
</ul>
<p>所以这里要考虑到真实的业务场景,如果只考虑业务场景的话不完整,因为在整个业务执行的过程中会产生很多问题,从 java 角度来讲这些都是属于异常,所以在业务开发的时候就要规划相关的异常,以便把项目的错误控制在一定范围内</p>
<p>service 下的目录结构(建议这样):</p>
<ul>
<li>service 包下创建 ex 包用来写异常类</li>
<li>service 包下创建 impl 包用来写接口的实现类</li>
<li>接口直接写在 service 包下,不再需要接口包</li>
</ul>
<h4 id="4-1-规划异常"><a href="#4-1-规划异常" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><p>1.为什么会有异常:</p>
<p>比如,用户在进行注册时可能会产生用户名被占用的错误,这时需要抛出一个异常</p>
<p>2.怎么处理异常:</p>
<ul>
<li>异常不能用 RuntimeException,太笼统了,开发者没办法第一时间定位到具体的错误类型上,我们可以定义具体的异常类型来继承这个异常.</li>
<li>正常的开发中异常又要分等级,可能是在业务层产生异常,可能是在控制层产生异常,所以可以创建一个业务层异常的基类,起名 ServiceException 异常,并使其继承 RuntimeException 异常</li>
<li><p>后期开发业务层时具体的异常可以再继承业务层的异常 ServiceException</p>
<p>3.处理异常的具体步骤:</p>
</li>
</ul>
<p>步骤一:在 ex 包下创建 ServiceException 类作为业务层异常的基类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 因为整个业务的异常只有一种情况下才会产生:只有运行时才会产生,不运行不会产生</span></span><br><span class="line"><span class="comment"> * 所以要求业务层的异常都要继承运行时异常RuntimeException并且重写父类的所有构造方法以便后期能抛出自已定义的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="comment">//什么也不返回</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回异常信息(常用)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回异常信息和异常对象(常用)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause, <span class="type">boolean</span> enableSuppression, <span class="type">boolean</span> writableStackTrace)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤二:后期再根据业务层不同的功能来详细定义具体的异常类型,并统一的继承 ServiceException 异常基类:</p>
<ul>
<li>用户在进行注册时可能会产生用户名被占用的错误,这时需要抛出一个 UsernameDuplicatedException 异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameDuplicatedException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>正在执行数据插入操作的时候,服务器宕机或数据库宕机.这种情况是处于正在执行插入的过程中所产生的异常,起名 InsertException 异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数据插入过程中产生异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-设计接口和抽象方法"><a href="#4-2-设计接口和抽象方法" class="headerlink" title="4.2 设计接口和抽象方法"></a>4.2 设计接口和抽象方法</h4><p>1.在 service 包下创建 IUserService 接口(接口命名的默认规则:I+业务名字+层的名字)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**用户模块业务层接口*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户的数据对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reg</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.创建一个实现 UserServiceImpl 类,需要实现 IUserService 接口,并且实现抽象的方法</p>
<p>因为要将这个实现类交给 spring 管理,所以需要在类上加@Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//reg方法核心就是调用mapper层的方法,所以要声明UserMapper对象并加@Autowired注解</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reg</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//通过user参数来获取传递过来的username</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> user.getUsername();</span><br><span class="line">        <span class="comment">//调用mapper的findByUsername(username)判断用户是否被注册过了</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUsername(username);</span><br><span class="line">        <span class="comment">//判断结果集是否为null,不为null的话则需抛出用户名被占用的异常</span></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//抛出异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameDuplicatedException</span>(<span class="string">&quot;用户名被占用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 密码加密处理作用:</span></span><br><span class="line"><span class="comment">         * 1.后端不再能直接看到用户的密码2.忽略了密码原来的强度,提升了数据安全性</span></span><br><span class="line"><span class="comment">         * 密码加密处理的实现:</span></span><br><span class="line"><span class="comment">         * 串+password+串-&gt;交给md5算法连续加密三次</span></span><br><span class="line"><span class="comment">         * 串就是数据库字段中的盐值,是一个随机字符串</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">oldpassword</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line">        <span class="comment">//1.随机生成一个盐值(大写的随机字符串)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> UUID.randomUUID().toString().toUpperCase();</span><br><span class="line">        <span class="comment">//2.将密码和盐值作为一个整体进行加密处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5Password</span> <span class="operator">=</span> getMD5Password(oldpassword, salt);</span><br><span class="line">        <span class="comment">//3.将盐值保存到数据库</span></span><br><span class="line">        user.setSalt(salt);</span><br><span class="line">        <span class="comment">//4.将加密之后的密码重新补全设置到user对象当中</span></span><br><span class="line">        user.setPassword(md5Password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//补全数据:is_delete设置为0</span></span><br><span class="line">        user.setIsDelete(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//补全数据:四个日志字段信息</span></span><br><span class="line">        user.setCreatedUser(user.getUsername());</span><br><span class="line">        user.setModifiedUser(user.getUsername());</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();<span class="comment">//java.util.Date</span></span><br><span class="line">        user.setCreatedTime(date);</span><br><span class="line">        user.setModifiedTime(date);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行注册业务功能的实现</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">        <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;在用户注册过程中产生了未知的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>md5 加密算法以后可能还要多次用到,为了方便在 UserServiceImpl 类里面单独写一个 getMD5Password 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">getMD5Password</span><span class="params">(String password,String salt)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        password = DigestUtils.md5DigestAsHex((salt + password + salt).getBytes()).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-单元测试"><a href="#4-3-单元测试" class="headerlink" title="4.3 单元测试"></a>4.3 单元测试</h4><p>在单元测试包下创建一个 UserServiceTests 类,在这个类中添加单元测试的功能(技巧:可以先在 test.com.cy.store 下创建 service 包,然后点击 UserMapperTests 并 ctrl+c,然后点击 service 包 ctrl+v 会弹出修改类名,将 UserMapperTests 改为 UserServiceTests 即可,然后修改部分代码至如下这样)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 进行插入时可能会出错抛出异常,这时需要捕获异常:</span></span><br><span class="line"><span class="comment">         * 1.选中    User user = new User();</span></span><br><span class="line"><span class="comment">         *           user.setUsername(&quot;张7&quot;);</span></span><br><span class="line"><span class="comment">         *           user.setPassword(&quot;123456&quot;);</span></span><br><span class="line"><span class="comment">         *           userService.reg(user);</span></span><br><span class="line"><span class="comment">         *           System.out.println(&quot;OK&quot;);</span></span><br><span class="line"><span class="comment">         * 2.点击导航栏的Code,然后依次点击SurroundWith-&gt;try/catch就可以捕获异常了</span></span><br><span class="line"><span class="comment">         * 3.Exception e没有问题,但这里我们知道是Service层的异常,所以可以改为ServiceException e</span></span><br><span class="line"><span class="comment">         * 4.System.out.println(e.getClass().getSimpleName());获取异常对象再获取类的名称然后输出</span></span><br><span class="line"><span class="comment">         * 5.System.out.println(e.getMessage());输出异常信息(是自己在ServiceException的子类类具体设置的信息)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setUsername(<span class="string">&quot;张7&quot;</span>);</span><br><span class="line">            user.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">            userService.reg(user);</span><br><span class="line">            System.out.println(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ServiceException e) &#123;</span><br><span class="line">            System.out.println(e.getClass().getSimpleName());</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-注册-控制层"><a href="#5-注册-控制层" class="headerlink" title="5.注册-控制层"></a>5.注册-控制层</h3><h4 id="5-1-创建响应"><a href="#5-1-创建响应" class="headerlink" title="5.1 创建响应"></a>5.1 创建响应</h4><p>状态码,状态描述信息,数据是所有控制层对应的方法都涉及到的操作,所以把这部分功能封装到一个类 JsonResult 中,将这个类作为方法的返回值返回给前端浏览器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为所有的响应的结果都采用Json格式的数据进行响应,所以需要实现Serializable接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonResult</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//状态码</span></span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="comment">//数据类型不确定,用E表示任何的数据类型,一个类里如果声明的有泛型的数据类型,类也要声明为泛型</span></span><br><span class="line">    <span class="keyword">private</span> E data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//无参构造</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将状态码传给构造方法初始化对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Integer state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将状态码和数据传给构造方法初始化对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Integer state, E data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果有异常,直接将异常传递给构造方法初始化对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message=e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**以及属性的get和set方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-设计请求"><a href="#5-2-设计请求" class="headerlink" title="5.2 设计请求"></a>5.2 设计请求</h4><p>接下来该向后端服务器发送请求以把用户数据插入到数据库,设计发送请求模块的第一步就是设计相关的请求</p>
<p>依据当前的业务功能模块进行请求的设计:</p>
<ul>
<li>请求路径:/users/reg</li>
<li>请求参数:User user</li>
<li>请求类型:POST</li>
<li>响应结果:JsonResult<void></li>
</ul>
<h4 id="5-3-处理请求"><a href="#5-3-处理请求" class="headerlink" title="5.3 处理请求"></a>5.3 处理请求</h4><p>创建一个控制层对应的 UserController 类,依赖于业务层的接口.编写完成后启动主服务验证一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="comment">//其作用等同于@Controller+@ResponseBody</span></span><br><span class="line"><span class="comment">//@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;reg&quot;)</span></span><br><span class="line">    <span class="comment">//@ResponseBody //表示此方法的响应结果以json格式进行数据的响应给到前端</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">reg</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//创建响应结果对象即JsonResult对象</span></span><br><span class="line">        JsonResult&lt;Void&gt; result = <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//调用userService的reg方法时可能出现异常,所以需要捕获异常</span></span><br><span class="line">            userService.reg(user);</span><br><span class="line">            result.setState(<span class="number">200</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户注册成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UsernameDuplicatedException e) &#123;</span><br><span class="line">            result.setState(<span class="number">4000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户名被占用&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InsertException e) &#123;</span><br><span class="line">            result.setState(<span class="number">5000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;注册时产生未知的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-4-控制层优化设计"><a href="#5-4-控制层优化设计" class="headerlink" title="5.4 控制层优化设计"></a>5.4 控制层优化设计</h4><p>凡是业务层抛出的异常我们都在控制层进行了捕获,如果其他的业务模块也抛用户名被占用或者插入时异常,那么抛出异常的代码就要重复编写</p>
<p>优化方法:在控制层抽离出一个 BaseController 父类,在这个父类中统一处理关于异常的相关操作,优化如下:</p>
<p>1.在 controller 包下创建 UserController 类作为控制层下类的基类,用来做统一的异常捕获:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作成功的状态码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.<span class="doctag">@ExceptionHandler</span>表示该方法用于处理捕获抛出的异常</span></span><br><span class="line"><span class="comment">     * 2.什么样的异常才会被这个方法处理呢?所以需要ServiceException.class,这样的话只要是抛出ServiceException异常就会被拦截到handleException方法,此时handleException方法就是请求处理方法,返回值就是需要传递给前端的数据</span></span><br><span class="line"><span class="comment">     * 3.被ExceptionHandler修饰后如果项目发生异常,那么异常对象就会被自动传递给此方法的参数列表上,所以形参就需要写Throwable e用来接收异常对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ServiceException.class)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        JsonResult&lt;Void&gt; result = <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(e);</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> UsernameDuplicatedException) &#123;</span><br><span class="line">            result.setState(<span class="number">4000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;用户名已经被占用&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> InsertException) &#123;</span><br><span class="line">            result.setState(<span class="number">5000</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;插入数据时产生未知的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.让 UserController 继承 BaseController 并重构 UserController 下的 reg 方法使该方法只需要关注请求处理而不再需要关注异常捕获:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">reg</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    userService.reg(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-注册-前端页面"><a href="#6-注册-前端页面" class="headerlink" title="6.注册-前端页面"></a>6.注册-前端页面</h3><h4 id="6-1-熟悉-ajax"><a href="#6-1-熟悉-ajax" class="headerlink" title="6.1 熟悉 ajax"></a>6.1 熟悉 ajax</h4><p>1.什么是 ajax 函数?</p>
<p>这是 jQuery 封装的一个函数,称为$.ajax()函数,通过对象调用 ajax()函数用来异步加载相关的请求.依靠的是 JavaScript 提供的一个对象:XHR(全称 XmlHttpResponse)</p>
<p>2.ajax()函数的语法结构:</p>
<ul>
<li>使用 ajax()时需要传递一个方法体作为方法的参数来使用(一对大括号就是一个方法体)</li>
<li>ajax 接受多个参数时,参数与参数之间使用”,”分割</li>
<li>每一组参数之间使用”:”进行分割</li>
<li>参数的组成部分一个是参数的名称(不能随便定义),另一个是参数的值(必须用字符串来表示)</li>
<li>参数的声明顺序没有要求</li>
</ul>
<p>演示一下语法结构:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">dataType</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3.ajax()函数参数的含义:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>参数</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>表示请求的地址(url 地址),例如:url:“localhost:8080/users/reg”(1.不能包含参数列表部分的内容 2.如果提交的请求是项目内部的一个 url,那么端口号前面的都可以省略掉,即 url:“/users/reg”)</td>
</tr>
<tr>
<td>type</td>
<td>请求类型(GET 和 POST 请求的类型).例如:type:“POST”(get 和 post 不区分大小写)</td>
</tr>
<tr>
<td>data</td>
<td>向指定的请求 url 地址提交的数据.例如:data:“username=tom&amp;pwd=123”</td>
</tr>
<tr>
<td>dataType</td>
<td>提交的数据的类型.数据的类型一般指定为 json 类型.例如:dataType:“json”(json 不区分大小写)</td>
</tr>
<tr>
<td>success</td>
<td>当服务器正常响应客户端时,会自动调用 success 参数的方法,并且将服务器返回的数据以参数的形式传递给这个方法的参数上</td>
</tr>
<tr>
<td>error</td>
<td>当服务器未正常响应客户端时,会自动调用 error 参数的方法,并且将服务器返回的数据以参数的形式传递给这个方法的参数上</td>
</tr>
</tbody>
</table>
</div>
<h4 id="6-2-前端-js-编写"><a href="#6-2-前端-js-编写" class="headerlink" title="6.2 前端 js 编写"></a>6.2 前端 js 编写</h4><p>js 代码可以独立声明在一个 js 文件里或者声明在一个 script 标签中.现在我们在 register.html 中编写 js 代码,js 代码可以放在 head 标签中,也可以放在 body 标签中,可以放在任意一个位置,只要被 script 标签包裹就行了,这里我们放在整个 body 结束之前:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">//1.监听注册按钮是否被点击,如果被点击可以执行一个方法(这里不能像ajax函数那样删去function()只留下&#123;&#125;,这是官方规定的!)</span></span><br><span class="line">    $(<span class="string">&quot;#btn-reg&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//let username = $(&quot;#username&quot;).val();</span></span><br><span class="line">        <span class="comment">//let pwd = $(&quot;#password&quot;).val();</span></span><br><span class="line">        <span class="comment">//上面这两行是动态获取表单中控件的数据,但是如果这样获取的话ajax函数中</span></span><br><span class="line">        <span class="comment">//就是data: &quot;username=&quot;+username + &quot;&amp;password=&quot;+pwd,但太麻烦了,如</span></span><br><span class="line">        <span class="comment">// 果这个表单提交的是用户的兴趣爱好,那数据就很多了,一个表单20个数据都很正</span></span><br><span class="line">        <span class="comment">// 常,如果此时还用这种方式就太麻烦了,所以不建议用这种方式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.发送ajax()的异步请求来完成用户的注册功能</span></span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/users/reg&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">//serialize这个API会自动检测该表单有什么控件,每个控件检测后还会获取每个控</span></span><br><span class="line">            <span class="comment">// 件的值,拿到这个值后并自动拼接成形如username=Tom&amp;password=123的结构</span></span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-reg&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line"></span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123; <span class="comment">//1.js是弱数据类型,这个地方不用声明json的数据类型</span></span><br><span class="line">                <span class="comment">//2.如果服务器成功响应就会将返回的数据传给形参,比如&#123;state: 4000,message: &quot;用户名</span></span><br><span class="line">                <span class="comment">// 已经被占用&quot;,data: null&#125;</span></span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;注册失败&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123; <span class="comment">//如果问题不在可控范围内,服务器就不会返回自己定</span></span><br><span class="line">                <span class="comment">//义的json字符串:&#123;state: 4000,message: &quot;用户名已经被占用&quot;,data: null&#125;</span></span><br><span class="line">                <span class="comment">//而是返回一个XHR类型的对象,该对象也有一个状态码名字是status</span></span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;注册时产生未知的错误!&quot;</span>+xhr.<span class="property">status</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>此时可能会出现点击注册提交表单时没有任何响应,原因是 idea 对于 JS 代码的兼容性较差,编写了 js 代码但是有的时候不能正常去加载,解决办法有四种,同前面的:项目环境搭建-&gt;项目测试-&gt;测试静态资源能否正常加载</p>
<p>包括以后如果修改了前端页面,测试时没有报错也没有按照预想的响应,就考虑是编写的 js 代码还没有被加载,尝试用这四种方法解决</p>
<h2 id="用户登录功能"><a href="#用户登录功能" class="headerlink" title="用户登录功能"></a>用户登录功能</h2><p>先分析一下思路:当用户输入用户名和密码将数据提交给后台数据库进行查询,如果存在对应的用户名和密码则表示登录成功,登录成功之后跳转到系统的主页就是 index.html 页面,跳转在前端使用 jQuery 来完成</p>
<h3 id="1-登录-持久层"><a href="#1-登录-持久层" class="headerlink" title="1.登录-持久层"></a>1.登录-持久层</h3><h4 id="规划需要执行的-SQL-语句"><a href="#规划需要执行的-SQL-语句" class="headerlink" title="规划需要执行的 SQL 语句"></a>规划需要执行的 SQL 语句</h4><p>依据用户提交的用户名来做 select 查询</p>
<p>select * from t_user where username=? and password=?这种不太好,这种相当于在查询用户名时直接判断了用户和密码是否一致了,如果持久层把判断做了那业务层就没事干了,所以这里我们只查询用户名,判断用户名和密码是否一致交给业务层做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_user where username=?</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析完以后发现这个功能模块已经被开发完成(UserMapper 接口的 findByUsername 方法),所以就可以省略当前的开发步骤,但是这个分析过程不能省略</p>
<p>后续的设计接口和抽象方法,编写映射,单元测试都不再需要进行,</p>
</blockquote>
<h3 id="2-登录-业务层"><a href="#2-登录-业务层" class="headerlink" title="2.登录-业务层"></a>2.登录-业务层</h3><h4 id="2-1-规划异常"><a href="#2-1-规划异常" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>用户名对应的密码错误,即密码匹配的异常,起名 PasswordNotMatchException,这个是运行时异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordNotMatchException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>用户名没有被找到的异常,起名 UsernameNotFoundException,这个也是运行时异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现"><a href="#2-2-设计接口和抽象方法及实现" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 IUserService 接口中编写抽象方法 login(String username,String password)login(User user)也是可以的</p>
<blockquote>
<p>细说一个事:登录成功某一个网站后,右上角会展示头像,昵称甚至电话号码等等,这些信息依赖于登陆成功后的信息,也就意味着一旦登录成功后在页面中切换到任意一个子页面写右上角都会展示这些信息.本质上就是查询出来这些信息,然后展示在右上角,但是这里实现查询不太现实:js 中虽然打开一个 html 页面就自动发送一个请求,但这样就需要把这个查询的代码写在每一个 html 页面,显然不现实</p>
</blockquote>
<p>这种情况下我们可以将当前登录成功的用户数据以当前用户对象的形式进行返回,然后进行状态管理:将数据保存在 cookie 或者 session 中,可以避免重复度很高的数据多次频繁操作数据库进行获取(这里我们用 session 存放用户名和用户 id,用 cookie 存放用户头像,其中用户 id 是为因为有的页面展示依赖于 id,用户头像也可以放在 session 中,而这里放在 cookie 是为了回顾一下 cookie)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户登录功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 当前匹配的用户数据,如果没有则返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">login</span><span class="params">(String username,String password)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在抽象类 UserServiceImpl 中实现该抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">    <span class="comment">//根据用户名称来查询用户的数据是否存在,不存在则抛出异常</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUsername(username);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检测用户的密码是否匹配:</span></span><br><span class="line"><span class="comment">     * 1.先获取数据库中加密之后的密码</span></span><br><span class="line"><span class="comment">     * 2.和用户传递过来的密码进行比较</span></span><br><span class="line"><span class="comment">     *  2.1先获取盐值</span></span><br><span class="line"><span class="comment">     *  2.2将获取的用户密码按照相同的md5算法加密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">oldPassword</span> <span class="operator">=</span> result.getPassword();</span><br><span class="line">    <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> result.getSalt();</span><br><span class="line">    <span class="type">String</span> <span class="variable">newMd5Password</span> <span class="operator">=</span> getMD5Password(password, salt);</span><br><span class="line">    <span class="keyword">if</span> (!newMd5Password.equals(oldPassword)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordNotMatchException</span>(<span class="string">&quot;用户密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断is_delete字段的值是否为1,为1表示被标记为删除</span></span><br><span class="line">    <span class="keyword">if</span> (result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法login返回的用户数据是为了辅助其他页面做数据展示使用(只会用到uid,username,avatar)</span></span><br><span class="line">    <span class="comment">//所以可以new一个新的user只赋这三个变量的值,这样使层与层之间传输时数据体量变小,后台层与</span></span><br><span class="line">    <span class="comment">// 层之间传输时数据量越小性能越高,前端也是的,数据量小了前端响应速度就变快了</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUid(result.getUid());</span><br><span class="line">    user.setUsername(result.getUsername());</span><br><span class="line">    user.setAvatar(result.getAvatar());</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试"><a href="#2-3-单元测试" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>在业务层的测试类 UserServiceTests 中添加测试方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//因为login方法可能抛出异常,所以应该捕获异常,但是测试时没必要写那么严谨</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(<span class="string">&quot;test02&quot;</span>, <span class="string">&quot;12&quot;</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-登录-控制层"><a href="#3-登录-控制层" class="headerlink" title="3.登录-控制层"></a>3.登录-控制层</h3><h4 id="3-1-处理异常"><a href="#3-1-处理异常" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>业务层抛出的异常需要在统一异常处理类中进行统一的捕获和处理,如果该异常类型已经在统一异常类中曾经处理过则不需要重复添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> UsernameNotFoundException) &#123;</span><br><span class="line">    result.setState(<span class="number">4001</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;用户数据不存在的异常&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> PasswordNotMatchException) &#123;</span><br><span class="line">    result.setState(<span class="number">4002</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;用户名密码错误的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求"><a href="#3-2-设计请求" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>请求路径:/users/login</li>
<li>请求参数:String username,String password</li>
<li>请求类型:POST</li>
<li>响应结果:JsonResult<User></li>
</ul>
<h4 id="3-3-处理请求"><a href="#3-3-处理请求" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>在 UserController 类中编写处理请求的方法.编写完成后启动主服务验证一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">login</span><span class="params">(String username,String password)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">data</span> <span class="operator">=</span> userService.login(username, password);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;User&gt;(OK,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意,控制层方法的参数是用来接收前端数据的,接收数据方式有两种:</p>
</blockquote>
<ul>
<li><p>请求处理方法的参数列表设置为非 pojo 类型:</p>
<p>SpringBoot 会直接将请求的参数名和方法的参数名直接进行比较,如果名称相同则自动完成值的依赖注入</p>
</li>
<li><p>请求处理方法的参数列表设置为 pojo 类型:</p>
<p>SpringBoot 会将前端的 url 地址中的参数名和 pojo 类的属性名进行比较,如果这两个名称相同,则将值注入到 pojo 类中对应的属性上</p>
</li>
</ul>
<p>这两种方法都没有使用注解等等花里胡哨的,却能正常使用,原因是 springboot 是约定大于配置的,省略了大量配置以及注解的编写</p>
<h3 id="4-登录-前端页面"><a href="#4-登录-前端页面" class="headerlink" title="4.登录-前端页面"></a>4.登录-前端页面</h3><p>在 login.html 加入 script 标签:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&quot;#btn-login&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/users/login&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-login&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">                    <span class="comment">//跳转到系统主页index.html</span></span><br><span class="line">                    <span class="comment">//index和login在同一个目录结构下,所以可以用相对路</span></span><br><span class="line">                    <span class="comment">// 径index.html来确定跳转的页面,index.html和./ind</span></span><br><span class="line">                    <span class="comment">// ex.html完全一样,因为./就是表示当前目录</span></span><br><span class="line">                    <span class="comment">// 结构,也可以用../web/index.html</span></span><br><span class="line">                    location.<span class="property">href</span> = <span class="string">&quot;index.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;登录失败&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="comment">//xhr.message可以获取未知异常的信息</span></span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;登录时产生未知的异常!&quot;</span>+xhr.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5-用-session-存储和获取用户数据"><a href="#5-用-session-存储和获取用户数据" class="headerlink" title="5.用 session 存储和获取用户数据"></a>5.用 session 存储和获取用户数据</h3><ul>
<li>在用户登录成功后要保存下来用户的 id,username,avatar,并且需要在任何类中都可以访问存储下来的数据,也就是说存储在一个全局对象中,会话 session 可以实现</li>
<li>把首次登录所获取的用户数据转移到 session 对象即可</li>
<li>获取 session 对象的属性值用 session.getAttribute(“key”),因为 session 对象的属性值在很多页面都要被访问,这时用 session 对象调用方法获取数据就显得太麻烦了,解决办法是将获取 session 中数据的这种行为进行封装</li>
<li>考虑一下封装在哪里呢?放在一个干净的工具类里肯定可以,但就这个项目目录结构而言,只有可能在控制层使用 session,而控制层里的类又继承 BaseController,所以可以封装到 BaseController 里面</li>
</ul>
<p>综上所述,该功能的实现需要两步:</p>
<p>1.在父类中封装两个方法:获取 uid 和获取 username 对应的两个方法(用户头像暂不考虑,将来封装到 cookie 中来使用)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取session对象中的uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> session session对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 当前登录的用户uid的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Integer <span class="title function_">getUidFromSession</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//getAttribute返回的是Object对象,需要转换为字符串再转换为包装类</span></span><br><span class="line">    <span class="keyword">return</span> Integer.valueOf(session.getAttribute(<span class="string">&quot;uid&quot;</span>).toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getUsernameFromSession</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;username&quot;</span>).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.把首次登录所获取的用户数据转移到 session 对象:</p>
<p>服务器本身自动创建有 session 对象,已经是一个全局的 session 对象,所以我们需要想办法获取 session 对象:如果直接将 HttpSession 类型的对象作为请求处理方法的参数,这时 springboot 会自动将全局的 session 对象注入到请求处理方法的 session 形参上:</p>
<ul>
<li>将登录模块的设计请求中的请求参数:String username,String password 加上 HttpSession session</li>
<li><p>将登录模块的处理请求中 login 方法加上参数 HttpSession session 并修改代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">login</span><span class="params">(String username, String password, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">data</span> <span class="operator">=</span> userService.login(username, password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向session对象中完成数据的绑定(这个session是全局的,项目的任何位置都可以访问)</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;uid&quot;</span>,data.getUid());</span><br><span class="line">    session.setAttribute(<span class="string">&quot;username&quot;</span>,data.getUsername());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试能否正常获取session中存储的数据</span></span><br><span class="line">    System.out.println(getUidFromSession(session));</span><br><span class="line">    System.out.println(getUsernameFromSession(session));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;User&gt;(OK,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-拦截器"><a href="#6-拦截器" class="headerlink" title="6.拦截器"></a>6.拦截器</h3><ul>
<li>拦截器的作用是将所有的请求统一拦截到拦截器中,可以在拦截器中定义过滤的规则,如果不满足系统设置的过滤规则,该项目统一的处理是重新去打开 login.html 页面(重定向和转发都可以,推荐使用重定向)</li>
<li><p>拦截器在 springboot 中本质是依靠 springMVC 完成的.springMVC 提供了一个 HandlerInterceptor 接口用于表示定义一个拦截器</p>
<p>1.所以想要使用拦截器就要定义一个类并使其实现 HandlerInterceptor 接口,在 store 下建包 interceptor,包下建类 LoginInterceptor 并编写代码:</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**定义一个拦截器*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *检测全局session对象中是否有uid数据,如果有则放行,如果没有重定向到登录页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler 处理器(把url和Controller映射到一块)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回值为true放行当前请求,反之拦截当前请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//在DispatcherServlet调用所有处理请求的方法前被自动调用执行的方法</span></span><br><span class="line">    <span class="comment">//springboot会自动把请求对象给到request,响应对象给到response,适配器给到handler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                             HttpServletResponse response,</span></span><br><span class="line"><span class="params">                             Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//通过HttpServletRequest对象来获取session对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;uid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123; <span class="comment">//说明用户没有登录过系统,则重定向到login.html页面</span></span><br><span class="line">            <span class="comment">//不能用相对路径,因为这里是要告诉前端访问的新页面是在哪个目录下的新</span></span><br><span class="line">            <span class="comment">//页面,但前面的localhost:8080可以省略,因为在同一个项目下</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/web/login.html&quot;</span>);</span><br><span class="line">            <span class="comment">//结束后续的调用</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//放行这个请求</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在ModelAndView对象返回给DispatcherServlet之后被自动调用的方法</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//在整个请求所有关联的资源被执行完毕后所执行的方法</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.注册过滤器:</p>
<p>注册过滤器的技术:借助 WebMvcConfigure 接口将用户定义的拦截器进行注册.所以想要注册过滤器需要定义一个类使其实现 WebMvcConfigure 接口并在其内部添加黑名单(在用户登录的状态下才可以访问的页面资源)和白名单(哪些资源可以在不登录的情况下访问:①register.html②login.html③index.html④/users/reg⑤/users/login⑥ 静态资源):</p>
<blockquote>
<p>WebMvcConfigure 是配置信息,建议在 store 包下建 config 包,再定义类 LoginInterceptorConfigure</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**拦截器的注册*/</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//自动加载当前的类并进行拦截器的注册,如果没有@Configuration就相当于没有写类LoginInterceptorConfigure</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptorConfigure</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//配置拦截器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//1.创建自定义的拦截器对象</span></span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.配置白名单并存放在一个List集合</span></span><br><span class="line">        List&lt;String&gt; patterns = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        patterns.add(<span class="string">&quot;/bootstrap3/**&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/css/**&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/js/**&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/web/register.html&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/web/login.html&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/web/index.html&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/web/product.html&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/users/reg&quot;</span>);</span><br><span class="line">        patterns.add(<span class="string">&quot;/users/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//registry.addInterceptor(interceptor);完成拦截</span></span><br><span class="line">        <span class="comment">// 器的注册,后面的addPathPatterns表示拦截哪些url</span></span><br><span class="line">        <span class="comment">//这里的参数/**表示所有请求,再后面的excludePathPatterns表</span></span><br><span class="line">        <span class="comment">// 示有哪些是白名单,且参数是列表</span></span><br><span class="line">        registry.addInterceptor(interceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(patterns);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>初步分析：需要用户提交原始密码和新密码，再根据当前登录的用户进行信息的修改操作</p>
<h3 id="1-修改密码-持久层"><a href="#1-修改密码-持久层" class="headerlink" title="1.修改密码-持久层"></a>1.修改密码-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句"><a href="#1-1-规划需要执行的-SQL-语句" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><ul>
<li><p>根据用户的 uid 修改用户 password 值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> password<span class="operator">=</span>?,modified_user<span class="operator">=</span>?, modified_time<span class="operator">=</span>? <span class="keyword">WHERE</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<p>modified_user=?, modified_time=?是为了跟踪用户数据的变动,如果这条数据被错误修改了可以找到第一责任人</p>
</li>
<li><p>在执行修改密码之前，还应检查用户数据是否存在或者用户数据是否被标记为”已删除”(比如登录账号后的几分钟在和朋友聊天,没有看页面,管理员错误删除了你的账号或者错误设置 is_delete 为 1)、并检查原密码是否正确，这些检查都可以通过查询用户数据来辅助完成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-2-设计接口和抽象方法"><a href="#1-2-设计接口和抽象方法" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>UserMapper 接口,将以上的两个方法的抽象定义出来,将来映射到 sql 语句上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的uid来修改用户密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password 用户输入的新密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modifiedUser 表示修改的执行者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modifiedTime 表示修改数据的时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回值为受影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Integer <span class="title function_">updatePasswordByUid</span><span class="params">(Integer uid,</span></span><br><span class="line"><span class="params">                            String password,</span></span><br><span class="line"><span class="params">                            String modifiedUser,</span></span><br><span class="line"><span class="params">                            Date modifiedTime)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的id查询用户的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到则返回对象,反之返回null值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">findByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射"><a href="#1-3-编写映射" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>配置到映射文件 UserMapper.xml 中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updatePasswordByUid&quot;</span>&gt;</span></span><br><span class="line">    update t_user set</span><br><span class="line">      `password`=#&#123;password&#125;,</span><br><span class="line">      modified_user=#&#123;modifiedUser&#125;,</span><br><span class="line">      modified_time=#&#123;modifiedTime&#125;,</span><br><span class="line">    where uid=#&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where uid=#&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试"><a href="#1-4-单元测试" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updatePasswordByUid</span><span class="params">()</span>&#123;</span><br><span class="line">    userMapper.updatePasswordByUid(</span><br><span class="line">        <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;321&quot;</span>,</span><br><span class="line">        <span class="string">&quot;管理员&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByUid</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(userMapper.findByUid(<span class="number">10</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-修改密码-业务层"><a href="#2-修改密码-业务层" class="headerlink" title="2.修改密码-业务层"></a>2.修改密码-业务层</h3><h4 id="2-1-规划异常-1"><a href="#2-1-规划异常-1" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>用户的原密码错误,抛 PasswordNotMatchException 异常(前面已创建)</li>
<li>检测到 is_delete 字段为 1 和 uid 找不到都是抛出用户没有找到的异常,UsernameNotFoundException(前面已创建)</li>
<li>update 在更新的时候,有可能产生未知的异常,抛 UpdateException 异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**用户在更新数据时产生的未知异常*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现-1"><a href="#2-2-设计接口和抽象方法及实现-1" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.执行用户修改密码的核心方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * changePassword方法需要什么参数:</span></span><br><span class="line"><span class="comment"> * 要先看底层持久层需要什么参数:uid,password,modifiedUser,modifiedTime</span></span><br><span class="line"><span class="comment"> * 1.修改人其实就是username,已经保存到session当中,通过控制层传递过来就行了</span></span><br><span class="line"><span class="comment"> * 2.在更新数据之前需要先根据uid查这个数据存不存在,uid也可以通过控制层传递</span></span><br><span class="line"><span class="comment"> * 3.新密码需要有</span></span><br><span class="line"><span class="comment"> * 4.修改时间不需要在参数列表,直接在方法内部new Date()就可以了</span></span><br><span class="line"><span class="comment"> * 5.旧密码</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(Integer uid,</span></span><br><span class="line"><span class="params">                   String username,</span></span><br><span class="line"><span class="params">                   String oldPassword,</span></span><br><span class="line"><span class="params">                   String newPassword)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在实现类中实现当前的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(Integer uid,</span></span><br><span class="line"><span class="params">                          String username,</span></span><br><span class="line"><span class="params">                          String oldPassword,</span></span><br><span class="line"><span class="params">                          String newPassword)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUid(uid);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户没找到:比如登录账号后的几分钟在和朋友聊天,没</span></span><br><span class="line"><span class="comment">     * 有看页面,管理员错误删除了你的账号或者错误设置is_delete为1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (result ==<span class="literal">null</span> || result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原始密码和数据库中密码进行比较</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">oldMd5Password</span> <span class="operator">=</span> getMD5Password(oldPassword,result.getSalt());</span><br><span class="line">    <span class="keyword">if</span> (!result.getPassword().equals(oldMd5Password)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordNotMatchException</span>(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将新的密码加密后设置到数据库中(只要曾经注册过就用以前的盐值)</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">newMd5Password</span> <span class="operator">=</span> getMD5Password(newPassword, result.getSalt());</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.updatePasswordByUid(uid, newMd5Password, username, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据产生未知的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-1"><a href="#2-3-单元测试-1" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">()</span> &#123;</span><br><span class="line">    userService.changePassword(<span class="number">11</span>,<span class="string">&quot;管理员&quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="string">&quot;321&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-修改密码-控制层"><a href="#3-修改密码-控制层" class="headerlink" title="3.修改密码-控制层"></a>3.修改密码-控制层</h3><h4 id="3-1-处理异常-1"><a href="#3-1-处理异常-1" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>UsernameNotFoundException 异常和 PasswordNotMatchException 异常在前面的章节中已经处理过,现在只需要把 UpdateException 异常配置到统一的异常处理方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> UpdateException) &#123;</span><br><span class="line">            result.setState(<span class="number">5001</span>);</span><br><span class="line">            result.setMessage(<span class="string">&quot;更新数据时产生未知的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求-1"><a href="#3-2-设计请求-1" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/users/change_password</li>
<li>post</li>
<li>String oldPassword,String newPassword,HttpSession session(uid 和 username 可以通过 session 获取到,在处理方法的内部获取就可以了)//如果参数名用的是非 pojo 类型,就需要和表单中的 name 属性值保持一致</li>
<li>JsonResult<void></li>
</ul>
<h4 id="3-3-处理请求-1"><a href="#3-3-处理请求-1" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;change_password&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">changePassword</span><span class="params">(String oldPassword,</span></span><br><span class="line"><span class="params">                                       String newPassword,</span></span><br><span class="line"><span class="params">                                       HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    userService.changePassword(uid,username,oldPassword,newPassword);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,先登录账号然后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/users/change_password?oldPassword=321&amp;newPassword=123">http://localhost:8080/users/change_password?oldPassword=321&amp;newPassword=123</a> 看看是否成功</p>
<h3 id="4-修改密码-前端页面"><a href="#4-修改密码-前端页面" class="headerlink" title="4.修改密码-前端页面"></a>4.修改密码-前端页面</h3><p>在 password.html 中添加 ajax 请求的处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&quot;#btn-change-password&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/users/change_password&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-change-password&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;密码修改成功&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;密码修改失败&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="comment">//xhr.message可以获取未知异常的信息</span></span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;修改密码时产生未知的异常!&quot;</span>+xhr.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="个人资料"><a href="#个人资料" class="headerlink" title="个人资料"></a>个人资料</h2><p>其中用户名是不可修改的并且是在进个人资料页面时就从 session 获取值并将值加入到控件中</p>
<h3 id="1-个人资料-持久层"><a href="#1-个人资料-持久层" class="headerlink" title="1.个人资料-持久层"></a>1.个人资料-持久层</h3><h4 id="1-1-规划-SQL-语句"><a href="#1-1-规划-SQL-语句" class="headerlink" title="1.1 规划 SQL 语句"></a>1.1 规划 SQL 语句</h4><ul>
<li><p>获取用户信息的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> python<span class="operator">=</span>?,email<span class="operator">=</span>?,gender<span class="operator">=</span>?,modified_user<span class="operator">=</span>?,modified_time<span class="operator">=</span>? <span class="keyword">where</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据 uid 查询用户数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<blockquote>
<p>根据 uid 查询用户数据不需要再重复开发</p>
</blockquote>
</li>
</ul>
<h4 id="1-2-设计接口和抽象方法-1"><a href="#1-2-设计接口和抽象方法-1" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>更新用户的信息方法的定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数为user的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回值为受影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Integer <span class="title function_">updateInfoByUid</span><span class="params">(User user)</span>;<span class="comment">//也可以用三个String的形参接收电话,邮箱,性别,但不如直接写个user省事</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-1"><a href="#1-3-编写映射-1" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 UserMapper.xml 文件中进行映射编写</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateInfoByUid&quot;</span>&gt;</span></span><br><span class="line">    update t_user</span><br><span class="line">    set</span><br><span class="line">        <span class="comment">&lt;!--if是条件判断标签,属性test接受的是一个返回值为boolean类型的条件,</span></span><br><span class="line"><span class="comment">        如果test条件的结果为true则执行if标签内部的语句,注意逗号也要在标签内--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone!=null&quot;</span>&gt;</span>phone = #&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span>email = #&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender!=null&quot;</span>&gt;</span>gender = #&#123;gender&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        modified_user = #&#123;modifiedUser&#125;,</span><br><span class="line">        modified_time = #&#123;modifiedTime&#125;</span><br><span class="line">    where uid=#&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-1"><a href="#1-4-单元测试-1" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateInfoByUid</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUid(<span class="number">11</span>);</span><br><span class="line">    user.setPhone(<span class="string">&quot;13333688&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;1454@qq.com&quot;</span>);</span><br><span class="line">    user.setGender(<span class="number">1</span>);</span><br><span class="line">    userMapper.updateInfoByUid(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-个人资料-业务层"><a href="#2-个人资料-业务层" class="headerlink" title="2.个人资料-业务层"></a>2.个人资料-业务层</h3><p>设计两个功能:</p>
<p>1.当打开页面时显示当前登录的用户的信息</p>
<p>2.点击修改按钮时更新用户的信息</p>
<h4 id="2-1-规划异常-2"><a href="#2-1-规划异常-2" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>点击个人资料页面时可能找不到用户的数据</li>
<li>点击修改按钮时可能找不到用户数据,也可能修改时出现未知错误</li>
</ul>
<h4 id="2-2-设计接口和抽象方法及实现-2"><a href="#2-2-设计接口和抽象方法及实现-2" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.业务层有两个功能模块,对应的是两个抽象方法的设计,并且这两个功能都涉及到用户是否存在的查询操作,所以需要在业务层设计根据用户 uid 查询数据的方法(持久层已经设计过该方法,但是没有在业务层实现该方法的调用)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的uid查询用户数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">getByUid</span><span class="params">(Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * uid通过控制层在session中获取然后传递给业务层,并在业务层封装到User对象中</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">changeInfo</span><span class="params">(Integer uid,User user)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在实现类中实现当前的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getByUid</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    <span class="comment">//查询用户是否存在</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUid(uid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以直接返回result给控制层,但是太臃肿了</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(result.getUsername());</span><br><span class="line">    user.setPhone(result.getPhone());</span><br><span class="line">    user.setEmail(result.getEmail());</span><br><span class="line">    user.setGender(result.getGender());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *User对象中的数据只有phone,email,gender,username,因为springboot进行依赖</span></span><br><span class="line"><span class="comment"> * 注入的时候只注入表单中数据的值,所以需要手动将uid封装到user中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeInfo</span><span class="params">(Integer uid, User user)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUid(uid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setUid(uid);</span><br><span class="line">    user.setModifiedUser(user.getUsername());</span><br><span class="line">    user.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.updateInfoByUid(user);</span><br><span class="line">    <span class="keyword">if</span> (rows!=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-2"><a href="#2-3-单元测试-2" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getByUid</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//err是为了让输出信息为红色</span></span><br><span class="line">    System.err.println(userService.getByUid(<span class="number">11</span>).getUsername());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="comment">//这四个属性值在真实开发中都是在控制层就已经自动封装在User对象中了</span></span><br><span class="line">    <span class="comment">//而uid需要由控制层传给业务层并在业务层封装到user中</span></span><br><span class="line">    user.setPhone(<span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;123@qq.com&quot;</span>);</span><br><span class="line">    user.setUsername(<span class="string">&quot;mxy&quot;</span>);</span><br><span class="line">    user.setGender(<span class="number">0</span>);</span><br><span class="line">    userService.changeInfo(<span class="number">11</span>,user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-个人资料-控制层"><a href="#3-个人资料-控制层" class="headerlink" title="3.个人资料-控制层"></a>3.个人资料-控制层</h3><h4 id="3-1-处理异常-2"><a href="#3-1-处理异常-2" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>没有新的异常,所以这里不需要有操作</p>
<h4 id="3-2-设计请求-2"><a href="#3-2-设计请求-2" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><p>1.设计一打开页面就发送当前用户数据的查询</p>
<ul>
<li>/users/get_by_uid</li>
<li>GET</li>
<li>HttpSession session(用于获取 uid)</li>
<li><p>JsonResult<User></p>
<p>2.点击修改按钮发送用户的数据修改操作</p>
</li>
<li><p>users/change_info</p>
</li>
<li>POST</li>
<li>User user,HttpSession session(用于获取 uid)</li>
<li>JsonResult<Void></li>
</ul>
<h4 id="3-3-处理请求-2"><a href="#3-3-处理请求-2" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>1.一打开页面就发送当前用户数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;get_by_uid&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">getByUid</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">data</span> <span class="operator">=</span> userService.getByUid(getUidFromSession(session));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;User&gt;(OK,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,先登录账号然后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/users/get_by_uid">http://localhost:8080/users/get_by_uid</a> 看看状态码是否为 200 并且看 data 值是否不为 null</p>
<p>2.点击修改按钮更改用户数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;change_info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">changeInfo</span><span class="params">(User user,HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//user对象中有四部分的数据:username,phone,email,gender</span></span><br><span class="line">    <span class="comment">//控制层给业务层传递uid,并在业务层通过user.setUid(uid);将uid封装到user中</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">    userService.changeInfo(uid,user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,先登录账号然后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/users/change_info?phone=175726&amp;email=6695@qq.com&amp;username=张">http://localhost:8080/users/change_info?phone=175726&amp;email=6695@qq.com&amp;username=张</a> 9&amp;gender=1 观察状态码是否为 200</p>
<h3 id="4-个人资料-前端页面"><a href="#4-个人资料-前端页面" class="headerlink" title="4.个人资料-前端页面"></a>4.个人资料-前端页面</h3><p>1.在打开 userdata.html(个人资料)页面自动发送 ajax 请求(get_by_uid),查询到的数据填充到这个页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一旦检测到当前的页面被加载就会触发ready方法</span></span><br><span class="line"><span class="comment">     * $(document).ready(function()&#123;</span></span><br><span class="line"><span class="comment">     *     //编写业务代码</span></span><br><span class="line"><span class="comment">     * &#125;);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//点击&quot;个人资料&quot;四个字加载userdata.html页面时$(document).ready(function()&#123;&#125;);就会起作用发送ajax请求</span></span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/users/get_by_uid&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">            <span class="comment">//data为null也可以,因为这里get是从数据库拉取数据,不需要data</span></span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-change-info&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="comment">//将查询到的数据设置到控件中</span></span><br><span class="line">                    $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">username</span>);</span><br><span class="line">                    $(<span class="string">&quot;#phone&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">phone</span>);</span><br><span class="line">                    $(<span class="string">&quot;#email&quot;</span>).<span class="title function_">val</span>(json.<span class="property">data</span>.<span class="property">email</span>);</span><br><span class="line">                    <span class="keyword">var</span> radio = json.<span class="property">data</span>.<span class="property">gender</span> == <span class="number">0</span> ?</span><br><span class="line">                        $(<span class="string">&quot;#gender-female&quot;</span>) : $(<span class="string">&quot;#gender-male&quot;</span>);</span><br><span class="line">                    <span class="comment">//prop()表示给某个元素添加属性及属性的值</span></span><br><span class="line">                    radio.<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>,<span class="string">&quot;checked&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;用户的数据不存在&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="comment">//xhr.message可以获取未知异常的信息</span></span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;查询用户信息时产生未知的异常!&quot;</span>+xhr.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>2.在检测到用户点击了修改按钮后发送一个 ajax 请求(change_info)</p>
<p>该 ajax 函数需要和上一个 ajax 同级</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn-change-info&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/users/change_info&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: $(<span class="string">&quot;#form-change-info&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;用户信息修改成功&quot;</span>);</span><br><span class="line">        <span class="comment">//修改成功后重新加载当前的页面</span></span><br><span class="line">        location.<span class="property">href</span> = <span class="string">&quot;userdata.html&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;用户信息修改失败&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="comment">//xhr.message可以获取未知异常的信息</span></span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;用户信息修改时产生未知的异常!&quot;</span> + xhr.<span class="property">message</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="上传头像"><a href="#上传头像" class="headerlink" title="上传头像"></a>上传头像</h2><p>错误方法:把文件存到数据库中,需要图片时访问数据库,数据库将文件解析为字节流返回,最后写到本地的某一个文件.这种方法太耗费资源和时间了</p>
<p>正确方法:将对应的文件保存在操作系统上,然后再把这个文件路径记录下来,因为在记录路径的时候是非常便捷和方便的,将来如果要打开这个文件可以依据这个路径找到这个文件,所以说在数据库中保存该文件的路径即可.</p>
<p>稍微大一点的公司都会将所有的静态资源(图片,文件,其他资源文件)放到某台电脑上,再把这台电脑作为一台单独的服务器使用</p>
<h3 id="1-上传头像-持久层"><a href="#1-上传头像-持久层" class="headerlink" title="1.上传头像-持久层"></a>1.上传头像-持久层</h3><h4 id="1-1SQL-语句的规划"><a href="#1-1SQL-语句的规划" class="headerlink" title="1.1SQL 语句的规划"></a>1.1SQL 语句的规划</h4><p>更新用户 avatar 字段的 sql 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> avatar<span class="operator">=</span>?,modified_user<span class="operator">=</span>?,modified_time<span class="operator">=</span>? <span class="keyword">where</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设计接口和抽象方法-2"><a href="#1-2-设计接口和抽象方法-2" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 UserMapper 接口中定义一个抽象方法用于修改用户的头像</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户uid修改用户的头像</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> iddddd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> avatar</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modifiedUser</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modifiedTime</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注解<span class="doctag">@Param</span>(&quot;SQL映射文件中#&#123;&#125;占位符的变量名&quot;),解决的问题:</span></span><br><span class="line"><span class="comment"> * 当SQL语句的占位符和映射的接口方法参数名不一致时,需要将某个参数强行注入到某个</span></span><br><span class="line"><span class="comment"> * 占位符变量上时,可以使用<span class="doctag">@Param</span>这个注解来标注映射的关系</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">Integer <span class="title function_">updateAvatarByUid</span><span class="params">(<span class="meta">@Param(&quot;uid&quot;)</span> Integer iddddd,//<span class="meta">@Param(&quot;参数名&quot;)</span>注解中的参数名需要和sql语句中</span></span><br><span class="line"><span class="params">                          //的#&#123;参数名&#125;的参数名保持一致.该处表示iddddd中的变量值要注入到sql语句的uid中</span></span><br><span class="line"><span class="params">                          String avatar,</span></span><br><span class="line"><span class="params">                          String modifiedUser,</span></span><br><span class="line"><span class="params">                          Date modifiedTime)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-2"><a href="#1-3-编写映射-2" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>UserMapper.xml 文件中编写映射的 SQL 语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateAvatarByUid&quot;</span>&gt;</span></span><br><span class="line">    update t_user</span><br><span class="line">    set</span><br><span class="line">        avatar = #&#123;avatar&#125;,</span><br><span class="line">        modified_user = #&#123;modifiedUser&#125;,</span><br><span class="line">        modified_time = #&#123;modifiedTime&#125;</span><br><span class="line">    where</span><br><span class="line">        uid = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-2"><a href="#1-4-单元测试-2" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAvatarByUid</span><span class="params">()</span> &#123;</span><br><span class="line">    userMapper.updateAvatarByUid(</span><br><span class="line">        <span class="number">11</span>,</span><br><span class="line">        <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mxy&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-上传头像-业务层"><a href="#2-上传头像-业务层" class="headerlink" title="2.上传头像-业务层"></a>2.上传头像-业务层</h3><h4 id="2-1-规划异常-3"><a href="#2-1-规划异常-3" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>用户数据不存在,找不到对应的用户数据</li>
<li>更新的时候,出现未知异常</li>
</ul>
<blockquote>
<p>无需重复开发</p>
</blockquote>
<h4 id="2-2-设计接口和抽象方法及实现-3"><a href="#2-2-设计接口和抽象方法及实现-3" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.先分析一下业务层接口需要哪些参数:那就需要看持久层接口要的有什么参数:</p>
<p>uid,avatar,modifiedUser,modifiedTime,其中 modifiedTime 是在方法中创建的,uid 和 modifiedUser 从 session 中获取,但是 session 对象是在控制层的并不会出现在业务层,所以业务层要保留这两个参数,以便控制层可以传递过来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改用户的头像</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> avatar 用户头像的路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username 用户名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">changeAvatar</span><span class="params">(Integer uid,</span></span><br><span class="line"><span class="params">                  String avatar,</span></span><br><span class="line"><span class="params">                  String username)</span>;<span class="comment">//业务层一般叫username而不叫modifiedUser,因</span></span><br><span class="line">                                    <span class="comment">// 为业务层并没有直接和数据库关联</span></span><br></pre></td></tr></table></figure>
<p>2.编写业务层的更新用户头像的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeAvatar</span><span class="params">(Integer uid, String avatar, String username)</span> &#123;</span><br><span class="line">    <span class="comment">//查询当前的用户数据是否存在</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUid(uid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.updateAvatarByUid(uid, avatar, username, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="keyword">if</span> (rows!=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新用户头像时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-3"><a href="#2-3-单元测试-3" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeAvatar</span><span class="params">()</span> &#123;</span><br><span class="line">    userService.changeAvatar(<span class="number">11</span>,<span class="string">&quot;222&quot;</span>,<span class="string">&quot;mmm&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-上传头像-控制层"><a href="#3-上传头像-控制层" class="headerlink" title="3.上传头像-控制层"></a>3.上传头像-控制层</h3><p><em>文件上传过程中产生的异常太多了,再比如文件类型不匹配或文件被损坏</em></p>
<h4 id="3-1-规划异常"><a href="#3-1-规划异常" class="headerlink" title="3.1 规划异常"></a>3.1 规划异常</h4><blockquote>
<p>客户端传递文件给服务器,服务器的控制端 controller 接收文件,接收时可能抛出异常,因为用户传过来的文件有可能超出了我们的大小限制</p>
<p>该异常能放在业务层抛出吗?没必要的,因为此时数据是从控制层往下传的,所以控制层产生的异常直接在这一层(控制层)抛就可以了</p>
</blockquote>
<p>上传文件时的异常都是文件异常,所以可以先创建一个文件异常类的基类 FileUploadException 并使其继承 RuntimeException</p>
<p>文件异常基类的子类有:</p>
<ul>
<li>FileEmptyException:文件为空的异常(没有选择上传的文件就提交了表单,或选择的文件是 0 字节的空文件)</li>
<li>FileSizeException:文件大小超出限制</li>
<li>FileTypeException:文件类型异常(上传的文件类型超出了限制)</li>
<li>FileUploadIOException:文件读写异常</li>
<li>FileStateException:文件状态异常(上穿文件时该文件正在打开状态)</li>
</ul>
<p>在 controller 包下创子包 ex,在 ex 包里面创建文件异常类的基类和上述五个文件异常类,创建的六个类都重写其父类的五个构造方法</p>
<h4 id="3-2-处理异常"><a href="#3-2-处理异常" class="headerlink" title="3.2 处理异常"></a>3.2 处理异常</h4><p>在基类 BaseController 中进行编写和统一处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FileEmptyException) &#123;</span><br><span class="line">    result.setState(<span class="number">6000</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FileSizeException) &#123;</span><br><span class="line">    result.setState(<span class="number">6001</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FileTypeException) &#123;</span><br><span class="line">    result.setState(<span class="number">6002</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FileStateException) &#123;</span><br><span class="line">    result.setState(<span class="number">6003</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FileUploadIOException) &#123;</span><br><span class="line">    result.setState(<span class="number">6004</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>异常统一处理方法的修饰符@ExceptionHandler(ServiceException.class)表明我们现在创建的 FileUploadException 异常类不会被拦截到该方法中,点进@ExceptionHandler 注解可以发现传参可以传数组类型,所以可以将异常统一处理方法上的注解改为:</p>
<p>@ExceptionHandler({ServiceException.class,FileUploadException.class})</p>
<h4 id="3-3-设计请求"><a href="#3-3-设计请求" class="headerlink" title="3.3 设计请求"></a>3.3 设计请求</h4><ul>
<li>/users/change_avatar</li>
<li>POST(GET 请求提交数据只有 2KB 左右)</li>
<li>HttpSession session(获取 uid 和 username),MultipartFile file</li>
<li>JsonResult<String>(不能是 JsonResult<Void>:如果上传头像后浏览别的页面,然后再回到上传头像的页面就展示不出来了,所以图片一旦上传成功,就要保存该图片在服务器的哪个位置,这样的话一旦检测到进入上传头像的页面就可以通过保存的路径拿到图片,最后展示在页面上)</li>
</ul>
<h4 id="3-4-处理请求"><a href="#3-4-处理请求" class="headerlink" title="3.4 处理请求"></a>3.4 处理请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;change_avatar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">changeAvatar</span><span class="params">(HttpSession session,</span></span><br><span class="line"><span class="params">                                       MultipartFile file)</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.参数名为什么必须用file:在upload.html页面的147行&lt;input type=</span></span><br><span class="line"><span class="comment">     * &quot;file&quot; name=&quot;file&quot;&gt;中的name=&quot;file&quot;,所以必须有一个方法的参数名</span></span><br><span class="line"><span class="comment">     * 为file用于接收前端传递的该文件.如果想要参数名和前端的name不一</span></span><br><span class="line"><span class="comment">     * 样:<span class="doctag">@RequestParam</span>(&quot;file&quot;)MultipartFile ffff:把表单中name=</span></span><br><span class="line"><span class="comment">     * &quot;file&quot;的控件值传递到变量ffff上</span></span><br><span class="line"><span class="comment">     * 2.参数类型为什么必须是MultipartFile:这是springmvc中封装的一个</span></span><br><span class="line"><span class="comment">     * 包装接口,如果类型是MultipartFile并且参数名和前端上传文件的name</span></span><br><span class="line"><span class="comment">     * 相同,则会自动把整体的数据包传递给file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//判断文件是否为null</span></span><br><span class="line">    <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileEmptyException</span>(<span class="string">&quot;文件为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (file.getSize()&gt;AVATAR_MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeException</span>(<span class="string">&quot;文件超出限制&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断文件的类型是否是我们规定的后缀类型</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> file.getContentType();</span><br><span class="line">    <span class="comment">//如果集合包含某个元素则返回值为true</span></span><br><span class="line">    <span class="keyword">if</span> (!AVATAR_TYPE.contains(contentType)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileTypeException</span>(<span class="string">&quot;文件类型不支持&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传的文件路径:.../upload/文件名.png</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * session.getServletContext()获取当前Web应用程序的上下文</span></span><br><span class="line"><span class="comment">     * 对象(每次启动tomcat都会创建一个新的上下文对象)</span></span><br><span class="line"><span class="comment">     * getRealPath(&quot;/upload&quot;)的/代表当前web应用程序的根目录,通过该相</span></span><br><span class="line"><span class="comment">     * 对路径获取绝对路径,返回一个路径字符串,如果不能进行映射返回null,单</span></span><br><span class="line"><span class="comment">     * 斜杠可要可不要</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">parent</span> <span class="operator">=</span></span><br><span class="line">            session.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">    System.out.println(parent);<span class="comment">//调试用</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//File对象指向这个路径,通过判断File是否存在得到该路径是否存在</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parent);</span><br><span class="line">    <span class="keyword">if</span> (!dir.exists()) &#123;<span class="comment">//检测目录是否存在</span></span><br><span class="line">        dir.mkdirs();<span class="comment">//创建当前目录</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取这个文件名称(文件名+后缀,如avatar01.png,不包含父目录结构)用UUID</span></span><br><span class="line">    <span class="comment">// 工具生成一个新的字符串作为文件名(好处:避免了因文件名重复发生的覆盖)</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    System.out.println(<span class="string">&quot;OriginalFilename=&quot;</span>+originalFilename);</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(index);</span><br><span class="line">    <span class="comment">//filename形如SAFS1-56JHIOHI-HIUGHUI-5565TYRF.png</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span></span><br><span class="line">            UUID.randomUUID().toString().toUpperCase()+suffix;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在dir目录下创建filename文件(此时是空文件)</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//java可以把一个文件的数据直接写到同类型的文件中,这里将参数file中的数据写入到空文件dest中</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        file.transferTo(dest);<span class="comment">//transferTo是一个封装的方法,用来将file文件中的数据写入到dest文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 先捕获FileStateException再捕获IOException是</span></span><br><span class="line"><span class="comment">         * 因为后者包含前者,如果先捕获IOException那么</span></span><br><span class="line"><span class="comment">         * FileStateException就永远不可能会被捕获</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileStateException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileStateException</span>(<span class="string">&quot;文件状态异常&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">//这里不用打印e,而是用自己写的FileUploadIOException类并</span></span><br><span class="line">        <span class="comment">// 抛出文件读写异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileUploadIOException</span>(<span class="string">&quot;文件读写异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">avatar</span> <span class="operator">=</span> <span class="string">&quot;/upload/&quot;</span>+filename;</span><br><span class="line">    userService.changeAvatar(uid,avatar,username);</span><br><span class="line">    <span class="comment">//返回用户头像的路径给前端页面,将来用于头像展示使用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,avatar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-上传头像-前端页面"><a href="#4-上传头像-前端页面" class="headerlink" title="4.上传头像-前端页面"></a>4.上传头像-前端页面</h3><p>1.在 upload.html 的上传头像的表单加上三个属性:</p>
<ul>
<li>action=“/users/change_avatar”</li>
<li>method=“post”(get 请求提交数据只有 2KB 左右)</li>
<li><p>enctype=“multipart/form-data”(如果直接使用表单进行文件的上传,需要给表单加该属性,这样不会将目标文件的数据结构做修改后再上传,这不同于字符串,字符串随意切割修改也能拼在一起,但文件不行)</p>
<p>2.确认<input type=“file” name=“file”>的 type 和 name 以及<input type=“submit” class=“btn btn-primary” value=“上传” />中的 type</p>
</li>
</ul>
<h3 id="5-前端页面优化——修复-bug"><a href="#5-前端页面优化——修复-bug" class="headerlink" title="5.前端页面优化——修复 bug"></a>5.前端页面优化——修复 bug</h3><h4 id="5-1-更改默认的大小限制"><a href="#5-1-更改默认的大小限制" class="headerlink" title="5.1 更改默认的大小限制"></a>5.1 更改默认的大小限制</h4><p>springmvc 默认为 1MB 文件可以进行上传,如果刚好是 1024*1024=1048576 bytes 则会报代码错误,自己在控制层设置的 public static final int AVATAR_MAX_SIZE = 10*1024*1024;需要在不超过原有大小的情况下才会起作用,所以要手动修改 springmvc 默认上传文件的大小</p>
<p>方式 1:直接在配置文件 application.properties 中进行配置:</p>
<ul>
<li>spring.servlet.multipart.max-file-size=10MB(表示上传的文件最大是多大)</li>
<li>spring.servlet.multipart.max-request-size=15MB(整个文件是放在了 request 中发送给服务器的,请求当中还会有消息头等其他携带的信息,这里设置请求最大为 15MB)</li>
</ul>
<p>方式 2:采用 java 代码的形式来设置文件的上传大小的限制:</p>
<p>1.该代码必须在主类中进行配置,因为主类是最早加载的,而配置文件必须是最早加载的</p>
<p>2.在主类中定义一个方法,方法名无所谓,但方法需要用@bean 修饰,表示该方法返回值是一个 bean 对象,并且该 bean 对象被 bean 修饰,也就是这个方法返回了一个对象,然后把该对象交给 bean 管理,类似 spring 中的 bean 标签,含义是一样的,只是这里改为了注解</p>
<p>3.用@Configuration 修饰主类使@bean 注解生效,但其实@SpringBootApplication 是@SpringBootConfiguration,@EnableAutoConfiguration,@ComponentScan 三个注解的合并,所以可以不需要@Configuration</p>
<p>4.方法返回值是 MultipartConfigElement 类型,表示所要配置的目标的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MultipartConfigElement <span class="title function_">getMultipartConfigElement</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1.创建一个配置的工厂类对象</span></span><br><span class="line">    <span class="type">MultipartConfigFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultipartConfigFactory</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.设置需要创建的对象的相关信息</span></span><br><span class="line">    factory.setMaxFileSize(DataSize.of(<span class="number">10</span>, DataUnit.MEGABYTES));</span><br><span class="line">    factory.setMaxRequestSize(DataSize.of(<span class="number">15</span>,DataUnit.MEGABYTES));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.通过工厂类创建MultipartConfigElement对象</span></span><br><span class="line">    <span class="keyword">return</span> factory.createMultipartConfig();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-上传后显示头像"><a href="#5-2-上传后显示头像" class="headerlink" title="5.2 上传后显示头像"></a>5.2 上传后显示头像</h4><p>上传头像成功后不能显示头像.</p>
<p>在页面中通过 ajax 请求来提交文件,提交完成后返回了 json 串,解析出 json 串中的 data 数据设置到 img 标签的 src 属性上</p>
<p>1.删掉在 upload.html 的上传头像的表单中加的三个属性:action=“/users/change_avatar”,method=“post”,enctype=“multipart/form-data”.加上 id 属性:id=“form-change-avatar”</p>
<p>2.把 153 行的 input 标签里面的 type=”submit”改为 type=“button”(因为 submit 按钮不能添加事件,所以要改为普通的按钮)并加上属性 id=“btn-change-avatar”</p>
<blockquote>
<p>1.serialize():可以将表单数据自动拼接成 key=value 的结构提交给服务器,一般提交的是普通的控件类型中的数据(type=text/password/radio/checkbox 等等)</p>
<p>2.FormData 类:将表单中数据保持原有的结构进行数据提交.文件类型的数据可以使用 FormData 对象进行存储</p>
<p>使用方法:new FormData($(“form”)[0]);</p>
<p>这行代码的含义是将 id=”form”的表单的第一个元素的整体值作为创建 FormData 对象的数据</p>
<p>3.虽然我们把文件的数据保护下来了,但是 ajax 默认处理数据时按照字符串的形式进行处理,以及默认会采用字符串的形式进行数据提交.手动关闭这两个功能:</p>
<ul>
<li>processData: false,//处理数据的形式,关闭处理数据</li>
<li>contentType: false,//提交数据的形式,关闭默认提交数据的形式</li>
</ul>
</blockquote>
<p>下面给提交表单加上事件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&quot;#btn-change-avatar&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/users/change_avatar&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&quot;#form-change-avatar&quot;</span>)[<span class="number">0</span>]),</span><br><span class="line">            <span class="attr">processData</span>: <span class="literal">false</span>,<span class="comment">//处理数据的形式,关闭处理数据</span></span><br><span class="line">            <span class="attr">contentType</span>: <span class="literal">false</span>,<span class="comment">//提交数据的形式,关闭默认提交数据的形式</span></span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;头像修改成功&quot;</span>)</span><br><span class="line">                    <span class="comment">//将服务器端返回的头像地址设置到img标签的src属性上</span></span><br><span class="line">                    <span class="comment">//attr(属性,属性值)用来给某个属性设值</span></span><br><span class="line">                    $(<span class="string">&quot;#img-avatar&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,json.<span class="property">data</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;头像修改失败&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;修改头像时产生未知的异常!&quot;</span>+xhr.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-登录后显示头像"><a href="#5-3-登录后显示头像" class="headerlink" title="5.3 登录后显示头像"></a>5.3 登录后显示头像</h4><p>将头像上传后会显示头像,但是关闭浏览器后再进入个人头像页面就不会显示头像了,因为只有点击”上传”才能发送 ajax 请求并显示头像.</p>
<p>可以在每次用户登录成功后将 avatar 保存在 cookie 中,登录的业务层返回给控制层 user 对象,该对象包含 uid,username,avatar.所以要在登录页面 login.html 中将服务器返回的头像路径设置到 cookie 中,然后每次检测到用户打开上传头像页面,在这个页面中通过 ready()方法来自动读取 cookie 中头像路径并设到 src 属性上</p>
<p>1.需要在 login.html 页面头部导入 cookie.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script</span><br><span class="line">  src=<span class="string">&quot;../bootstrap3/js/jquery.cookie.js&quot;</span></span><br><span class="line">  type=<span class="string">&quot;text/javascript&quot;</span></span><br><span class="line">  charset=<span class="string">&quot;utf-8&quot;</span></span><br><span class="line">&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>2.调用 cookie 方法保存路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">cookie</span>(key, value, time); <span class="comment">//time单位:天</span></span><br></pre></td></tr></table></figure>
<p>在 ajax 请求原有的代码上加$.cookie(“avatar”,json.data.avatar,{expires: 7});</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        location.<span class="property">href</span> = <span class="string">&quot;index.html&quot;</span>;</span><br><span class="line">        $.<span class="title function_">cookie</span>(<span class="string">&quot;avatar&quot;</span>,json.<span class="property">data</span>.<span class="property">avatar</span>,&#123;<span class="attr">expires</span>: <span class="number">7</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;登录失败&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>3.需要在 upload.html 获取 cookie 中的值,所以要在页面头部导入 cookie.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script</span><br><span class="line">  src=<span class="string">&quot;../bootstrap3/js/jquery.cookie.js&quot;</span></span><br><span class="line">  type=<span class="string">&quot;text/javascript&quot;</span></span><br><span class="line">  charset=<span class="string">&quot;utf-8&quot;</span></span><br><span class="line">&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>4.在 upload.html 的 script 标签中加 ready()自动读取 cookie 数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> avatar = $.<span class="title function_">cookie</span>(<span class="string">&quot;avatar&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(avatar); <span class="comment">//调试用</span></span><br><span class="line">  $(<span class="string">&quot;#img-avatar&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, avatar);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5-4-显示最新头像"><a href="#5-4-显示最新头像" class="headerlink" title="5.4 显示最新头像"></a>5.4 显示最新头像</h4><p>上传头像后不重新登录而是浏览其他页面,然后再进入个人头像页面时展示的头像是上次上传的,因为此时 cookie 中的值是上次上传的头像的路径,所以需要上传头像后使用同名覆盖更改 cookie 中路径</p>
<p>在 ajax 函数的 success 属性值的 if 语句加:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">cookie</span>(<span class="string">&quot;avatar&quot;</span>, json.<span class="property">data</span>, &#123; <span class="attr">expires</span>: <span class="number">7</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>完善后重启服务测试,结果若和预测的不一样,则参考项目环境搭建-&gt;项目测试-&gt;测试静态资源能否正常加载里面的四种解决方法</p>
<h2 id="新增收货地址"><a href="#新增收货地址" class="headerlink" title="新增收货地址"></a>新增收货地址</h2><h3 id="1-创建数据表-1"><a href="#1-创建数据表-1" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.选中数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use store</span><br></pre></td></tr></table></figure>
<p>2.在 store 数据库中创建 t_address 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_address (</span><br><span class="line">	aid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;收货地址id&#x27;</span>,</span><br><span class="line">	uid <span class="type">INT</span> COMMENT <span class="string">&#x27;归属的用户id&#x27;</span>,</span><br><span class="line">	`name` <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">	province_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;省-名称&#x27;</span>,</span><br><span class="line">	province_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;省-行政代号&#x27;</span>,</span><br><span class="line">	city_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;市-名称&#x27;</span>,</span><br><span class="line">	city_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;市-行政代号&#x27;</span>,</span><br><span class="line">	area_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;区-名称&#x27;</span>,</span><br><span class="line">	area_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;区-行政代号&#x27;</span>,</span><br><span class="line">	zip <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;邮政编码&#x27;</span>,</span><br><span class="line">	address <span class="type">VARCHAR</span>(<span class="number">50</span>) COMMENT <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">	phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;手机&#x27;</span>,</span><br><span class="line">	tel <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;固话&#x27;</span>,</span><br><span class="line">	tag <span class="type">VARCHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;标签&#x27;</span>,</span><br><span class="line">	is_default <span class="type">INT</span> COMMENT <span class="string">&#x27;是否默认：0-不默认，1-默认&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (aid)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<p>注意 name 是关键字,所以需要用``</p>
<h3 id="2-创建收货地址的实体类"><a href="#2-创建收货地址的实体类" class="headerlink" title="2.创建收货地址的实体类"></a>2.创建收货地址的实体类</h3><p>在 entity 包下创建实体类 Address 继承 BaseEntity 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**收货地址额实体类*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer aid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String provinceName;</span><br><span class="line">    <span class="keyword">private</span> String provinceCode;</span><br><span class="line">    <span class="keyword">private</span> String cityName;</span><br><span class="line">    <span class="keyword">private</span> String cityCode;</span><br><span class="line">    <span class="keyword">private</span> String areaName;</span><br><span class="line">    <span class="keyword">private</span> String areaCode;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> String tag;</span><br><span class="line">    <span class="keyword">private</span> Integer isDefault;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-新增收货地址-持久层"><a href="#3-新增收货地址-持久层" class="headerlink" title="3.新增收货地址-持久层"></a>3.新增收货地址-持久层</h3><h4 id="3-1-各功能的开发顺序"><a href="#3-1-各功能的开发顺序" class="headerlink" title="3.1 各功能的开发顺序"></a>3.1 各功能的开发顺序</h4><p>当前收货地址功能模块:</p>
<ul>
<li>第一个页面:列表的展示,修改,删除,设置默认</li>
<li>第二个页面:新增收货地址</li>
</ul>
<p>开发顺序:新增收货地址-&gt;列表的展示-&gt;设置默认收货地址-&gt;删除收货地址-&gt;修改收货地址</p>
<h4 id="3-2-规划需要执行的-SQL-语句"><a href="#3-2-规划需要执行的-SQL-语句" class="headerlink" title="3.2 规划需要执行的 SQL 语句"></a>3.2 规划需要执行的 SQL 语句</h4><p>1.新增收货地址对应的是插入语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_address (aid以外的所有字段) <span class="keyword">values</span> (字段值)</span><br></pre></td></tr></table></figure>
<p>2.大部分平台都会规定一个用户的收货地址数量,这里规定最多 20 个.那么在插入用户新的地址之前就要先做查询操作.如果查询到的是刚好 20,这并不是一个 java 语法的异常,可以认为是业务控制的异常,这个异常随后在 service 抛,在 controller 捕获</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t_address <span class="keyword">where</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="3-3-设计接口和抽象方法"><a href="#3-3-设计接口和抽象方法" class="headerlink" title="3.3 设计接口和抽象方法"></a>3.3 设计接口和抽象方法</h4><p>创建接口 AddressMapper,在这个接口中定义上面两个 SQL 语句抽象方法定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**收货地址持久层的接口*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入用户的收货地址数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address 收货地址数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insert</span> <span class="params">(Address address)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户的uid统计收货地址数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 用户的uid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前用户的收货地址总数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">countByUid</span><span class="params">(Integer uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-编写映射"><a href="#3-4-编写映射" class="headerlink" title="3.4 编写映射"></a>3.4 编写映射</h4><p>1.快速创建一个 AddressMapper.xml 映射文件:</p>
<ul>
<li>鼠标放在 UserMapper.xml 文件上并 ctrl+c,再把鼠标放到 mapper 文件夹上 ctrl+v,在弹出的窗口中把 UserMapper 改为 AddressMapper.</li>
<li>进入 AddressMapper.xml 文件将 mapper 标签下的代码全部删除并修改 mapper 标签属性值为 namespace=“com.cy.store.mapper.AddressMapper”</li>
</ul>
<p>结果如下所示:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.AddressMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.在 mapper 标签中配置 Address 类属性与数据库中表的字段映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;AddressEntityMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.cy.store.entity.Address&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;aid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;province_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;provinceName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;province_code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;provinceCode&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;city_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;city_code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityCode&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;area_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;areaName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;area_code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;areaCode&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;is_default&quot;</span> <span class="attr">property</span>=<span class="string">&quot;isDefault&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdUser&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdTime&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedUser&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedTime&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>判断该映射是否配置成功:按着 ctrl 并点击 type=”com.cy.store.entity.Address”中的 Address,如果能跳转到 Address 类说明映射成功</p>
<p>3.在 AddressMapper.xml 中配置以上两个抽象方法的映射</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;insert&quot; useGeneratedKeys<span class="operator">=</span>&quot;true&quot; keyProperty<span class="operator">=</span>&quot;aid&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_address (</span><br><span class="line">        uid, `name`, province_name, province_code, city_name, city_code, area_name, area_code, zip,</span><br><span class="line">        address, phone, tel,tag, is_default, created_user, created_time, modified_user, modified_time</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        #&#123;uid&#125;, #&#123;name&#125;, #&#123;provinceName&#125;, #&#123;provinceCode&#125;, #&#123;cityName&#125;, #&#123;cityCode&#125;, #&#123;areaName&#125;,</span><br><span class="line">        #&#123;areaCode&#125;, #&#123;zip&#125;, #&#123;address&#125;, #&#123;phone&#125;, #&#123;tel&#125;, #&#123;tag&#125;, #&#123;isDefault&#125;, #&#123;createdUser&#125;,</span><br><span class="line">        #&#123;createdTime&#125;, #&#123;modifiedUser&#125;, #&#123;modifiedTime&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">!</span><span class="comment">--resultType=&quot;java.lang.Integer&quot;不写会报错,因为Integer不是基本数据类型--&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;countByUid&quot;  resultType<span class="operator">=</span>&quot;java.lang.Integer&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t_address <span class="keyword">where</span> uid<span class="operator">=</span>#&#123;uid&#125;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-5-单元测试"><a href="#3-5-单元测试" class="headerlink" title="3.5 单元测试"></a>3.5 单元测试</h4><p>在 test 下的 mapper 文件夹下创建 AddressMapperTests 测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressMapperTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressMapper addressMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setUid(<span class="number">11</span>);</span><br><span class="line">        address.setPhone(<span class="string">&quot;133336&quot;</span>);</span><br><span class="line">        address.setName(<span class="string">&quot;女朋友&quot;</span>);</span><br><span class="line">        addressMapper.insert(address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countByUid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> addressMapper.countByUid(<span class="number">11</span>);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-新增收货地址-业务层"><a href="#4-新增收货地址-业务层" class="headerlink" title="4.新增收货地址-业务层"></a>4.新增收货地址-业务层</h3><h4 id="4-1-规划异常-1"><a href="#4-1-规划异常-1" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><ul>
<li>插入数据时用户不存在(被管理员误删等等),抛 UsernameNotFoundException 异常(已经有了,不需要重复创建)</li>
<li><p>当用户插入的地址是第一条时,需要将当前地址作为默认收货地址</p>
<p>实现办法:如果查询到统计总数为 0 则将当前地址的 is_default 值设置为 1</p>
</li>
<li><p>如果查询的结果&gt;=20,这时需要抛出业务控制的异常 AddressCountLimitException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**收货地址总数超出限制的异常(20条)*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressCountLimitException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据时产生未知的异常 InsertException(已经有了,不需要重复创建)</p>
</li>
</ul>
<h4 id="4-2-设计接口和抽象方法及实现"><a href="#4-2-设计接口和抽象方法及实现" class="headerlink" title="4.2 设计接口和抽象方法及实现"></a>4.2 设计接口和抽象方法及实现</h4><p>1.创建一个 IAddressService 接口,在接口中定义业务的抽象方法</p>
<p>因为 mapper 层接口该功能模块定义了两个抽象方法,所以就要在 service 层接口该功能模块也定义两个抽象方法?不是这样的,要看 mapper 层的这两个方法是依赖关系还是独立关系,如果某一个抽象方法依赖于另一个抽象方法,那就需要在业务层将这两个方法整合到一个方法中.一句话来说就是:一个功能模块可能需要多条 sql 语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**收货地址的业务层接口*/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *这三个参数的由来:</span></span><br><span class="line"><span class="comment">     * 1.首先肯定要有address</span></span><br><span class="line"><span class="comment">     * 2.业务层需要根据uid查询该用户收货地址总数及新建地址时给字段uid赋值</span></span><br><span class="line"><span class="comment">     * 但新建收货地址的表单中并没有哪个控件让输入用户uid,所以需要控制层将uid传给业务层</span></span><br><span class="line"><span class="comment">     * 3.业务层在创建/修改收货地址时需要同时修改数据库中创建人/修改人的字段</span></span><br><span class="line"><span class="comment">     * 但新建收货地址的表单中并没有哪个控件让输入用户username,所以需要控制层将username传给业务层</span></span><br><span class="line"><span class="comment">     * 注意:&gt; 可以用HttpSession session代替Integer uid, String username,但</span></span><br><span class="line"><span class="comment">     * 这样写的话就需要把BaseController类下获取uid,username的方法重新封装到一个</span></span><br><span class="line"><span class="comment">     * 类中并让IAddressServiceImp实现类继承该类,这样就需要微调一下代码逻辑,太麻</span></span><br><span class="line"><span class="comment">     * 烦,并且,最好每一层只处理该层需要做的事情,session对象是控制层传递的,所以就</span></span><br><span class="line"><span class="comment">     * 把session对象定义封装在控制层中,不需要在业务层中额外处理以降低耦合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addNewAddress</span><span class="params">(Integer uid, String username, Address address)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法 addNewAddress 中三个参数的由来:</p>
<ul>
<li>首先肯定要有 address</li>
<li><p>业务层需要根据 uid 查询该用户收货地址总数及新建地址时给字段 uid 赋值</p>
<p>但新建收货地址的表单中并没有哪个控件让输入用户 uid,所以需要控制层将 uid 传给业务层并在业务层封装到 address 对象中</p>
</li>
<li><p>业务层在创建/修改收货地址时需要同时修改数据库中创建人/修改人的字段</p>
<p>但新建收货地址的表单中并没有哪个控件让输入用户 username,所以需要控制层将 username 传给业务层并在业务层封装到 address 对象中</p>
</li>
</ul>
<blockquote>
<p>可以用 HttpSession session 代替 Integer uid, String username,但这样写的话就需要把 BaseController 类下获取 uid,username 的方法重新封装到一个类中并让 AddressServiceImpl 实现类继承该类,这样就需要微调一下代码逻辑,太麻烦,并且,最好每一层只处理该层需要做的事情,session 对象是控制层传递的,所以就把 session 对象定义封装在控制层中,不需要在业务层中额外处理,这样可以降低耦合</p>
</blockquote>
<p>2.创建一个 AddressServiceImpl 类实现接口中抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**新增收货地址的实现类*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressMapper addressMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为了方便日后修改最大收货地址数量,可以在配置文件</span></span><br><span class="line"><span class="comment">     * application.properties中定义user.address.max-count=20</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//spring读取配置文件中数据:@Value(&quot;$&#123;user.address.max-count&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;user.address.max-count&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNewAddress</span><span class="params">(Integer uid, String username, Address address)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.findByUid(uid);</span><br><span class="line">        <span class="keyword">if</span> (result ==<span class="literal">null</span> || result.getIsDelete() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用统计收货地址数量的方法</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> addressMapper.countByUid(uid);</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= maxCount) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressCountLimitException</span>(<span class="string">&quot;用户收货地址超出上限&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//uid,isDefault</span></span><br><span class="line">        address.setUid(uid);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">isDefault</span> <span class="operator">=</span> count == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;<span class="comment">//1表示默认收货地址,0反之</span></span><br><span class="line">        address.setIsDefault(isDefault);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//补全四项日志</span></span><br><span class="line">        address.setCreatedUser(username);</span><br><span class="line">        address.setModifiedUser(username);</span><br><span class="line">        address.setCreatedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        address.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用插入收货地址的方法</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> addressMapper.insert(address);</span><br><span class="line">        <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入用户的收货地址时产生未知异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>别忘了在配置文件 application.properties 中定义 user.address.max-count=20</p>
<h4 id="4-3-单元测试-1"><a href="#4-3-单元测试-1" class="headerlink" title="4.3 单元测试"></a>4.3 单元测试</h4><p>在 test 下的 service 文件夹下创建 AddressServiceTests 测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressServiceTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAddressService addressService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNewAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setPhone(<span class="string">&quot;175726&quot;</span>);</span><br><span class="line">        address.setName(<span class="string">&quot;男朋友&quot;</span>);</span><br><span class="line">        addressService.addNewAddress(<span class="number">11</span>,<span class="string">&quot;mxy&quot;</span>,address);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-新增收货地址-控制层"><a href="#5-新增收货地址-控制层" class="headerlink" title="5.新增收货地址-控制层"></a>5.新增收货地址-控制层</h3><h4 id="5-1-处理异常"><a href="#5-1-处理异常" class="headerlink" title="5.1 处理异常"></a>5.1 处理异常</h4><p>义务层抛出了收货地址总数超出上限的异常,在 BaseController 中进行捕获处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AddressCountLimitException) &#123;</span><br><span class="line">    result.setState(<span class="number">4003</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;用户的收货地址超出上限的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-设计请求-1"><a href="#5-2-设计请求-1" class="headerlink" title="5.2 设计请求"></a>5.2 设计请求</h4><ul>
<li>/addresses/add_new_address</li>
<li>post</li>
<li>Address address,HttpSession session</li>
<li>JsonResult<Void></li>
</ul>
<h4 id="5-3-处理请求-1"><a href="#5-3-处理请求-1" class="headerlink" title="5.3 处理请求"></a>5.3 处理请求</h4><p>在 controller 包下创建 AddressController 并继承 BaseController,该类用来处理用户收货地址的请求和响应</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;addresses&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAddressService addressService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;add_new_address&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addNewAddress</span><span class="params">(Address address, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">        addressService.addNewAddress(uid,username,address);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务器,登录账号后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/addresses/add_new_address?name=tom&amp;phone=98745612">http://localhost:8080/addresses/add_new_address?name=tom&amp;phone=98745612</a> 进行测试</p>
<h3 id="6-新增收货地址-前端页面"><a href="#6-新增收货地址-前端页面" class="headerlink" title="6.新增收货地址-前端页面"></a>6.新增收货地址-前端页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&quot;#btn-add-new-address&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/addresses/add_new_address&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-add-new-address&quot;</span>).<span class="title function_">serialize</span>(),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;新增收货地址成功&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;新增收货地址失败&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;新增收货地址时产生未知的异常!&quot;</span>+xhr.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="获取省市区列表"><a href="#获取省市区列表" class="headerlink" title="获取省市区列表"></a>获取省市区列表</h2><p>新增收货地址页面的三个下拉列表的内容展示没有和数据库进行交互,而是通过前端实现的(将代码逻辑放在了 distpicker.data.js 文件中),实现方法是在加载新增收货地址页面时加载该 js 文件,这种做法不可取(我不知道为啥)</p>
<p>正确做法是:把这些数据保存到数据库中,用户点击下拉列表时相应的数据会被详细的展示出来,然后监听用户选择了哪一项以便后面的下拉列表进行二级关联</p>
<h3 id="1-创建数据表-2"><a href="#1-创建数据表-2" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.创建 t_dict_district 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_dict_district (</span><br><span class="line">  id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  parent <span class="type">VARCHAR</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `code` <span class="type">VARCHAR</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<ul>
<li>code 和 name 需要加``</li>
<li>parent 代表父区域的代码号</li>
<li>code 代表自身的代码号</li>
<li><p>省的父代码号是+86,代表中国</p>
<p>2.向该表中插入省市区数据</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES t_dict_district WRITE;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dict_district <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;110100&#x27;</span>,<span class="string">&#x27;110101&#x27;</span>,<span class="string">&#x27;东城区&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;110100&#x27;</span>,<span class="string">&#x27;110102&#x27;</span>,<span class="string">&#x27;西城区&#x27;</span>)等等等等;</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure>
<p>LOCK 和 UNLOVK 干嘛用的?</p>
<h3 id="2-创建省市区的实体类"><a href="#2-创建省市区的实体类" class="headerlink" title="2.创建省市区的实体类"></a>2.创建省市区的实体类</h3><p>在包 entity 下创建实体类 District(不需要继承 BaseEntity,但因为没有继承 BaseEntity 所以需要实现接口 Serializable 序列化)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**省市区的数据实体类*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">District</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String parent;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-获取省市区列表-持久层"><a href="#3-获取省市区列表-持久层" class="headerlink" title="3.获取省市区列表-持久层"></a>3.获取省市区列表-持久层</h3><h4 id="3-1-规划需执行的-SQL-语句"><a href="#3-1-规划需执行的-SQL-语句" class="headerlink" title="3.1 规划需执行的 SQL 语句"></a>3.1 规划需执行的 SQL 语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dict_district <span class="keyword">where</span> parent<span class="operator">=</span>? <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计接口和抽象方法"><a href="#3-2-设计接口和抽象方法" class="headerlink" title="3.2 设计接口和抽象方法"></a>3.2 设计接口和抽象方法</h4><p>日后可能开发新的模块仍要用到省市区列表,那么为了降低耦合性,就要创建新的接口</p>
<p>在 mapper 层下创建接口 DistrictMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DistrictMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据父代码号查询区域信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parent 父代码号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 某个父区域下所有的区域列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;District&gt; <span class="title function_">findByParent</span><span class="params">(String parent)</span>;<span class="comment">//查询的结果可能是多个,所以放在集合中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射-1"><a href="#3-3-编写映射-1" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>创建一个 DistrictMapper.xml 映射文件并配置上述抽象方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.DistrictMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByParent&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.cy.store.entity.District&quot;</span>&gt;</span></span><br><span class="line">        select * from t_dict_district where parent=#&#123;parent&#125;</span><br><span class="line">        order by code ASC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试-1"><a href="#3-4-单元测试-1" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>创建 DistrictMapperTests 测试类编写代码进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictMapperTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DistrictMapper districtMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByParent</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;District&gt; list = districtMapper.findByParent(<span class="string">&quot;210100&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (District district : list) &#123;</span><br><span class="line">            System.out.println(district);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-获取省市区列表-业务层"><a href="#4-获取省市区列表-业务层" class="headerlink" title="4.获取省市区列表-业务层"></a>4.获取省市区列表-业务层</h3><h4 id="4-1-规划异常-2"><a href="#4-1-规划异常-2" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><p>没有异常需要处理</p>
<h4 id="4-2-设计接口和抽象方法及实现-1"><a href="#4-2-设计接口和抽象方法及实现-1" class="headerlink" title="4.2 设计接口和抽象方法及实现"></a>4.2 设计接口和抽象方法及实现</h4><p>1.创建一个接口 IDistrictService,并定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IDistrictService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据父代码号来查询区域信息(省或市或区)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parent 父代码号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 多个区域的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;District&gt; <span class="title function_">getByParent</span><span class="params">(String parent)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.创建 DistrictServiceImpl 实现类来实现抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IDistrictService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DistrictMapper districtMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;District&gt; <span class="title function_">getByParent</span><span class="params">(String parent)</span> &#123;</span><br><span class="line">        List&lt;District&gt; list = districtMapper.findByParent(parent);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 在进行网络数据传输时,为了尽量避免无效数据的传递,可以将无效数据</span></span><br><span class="line"><span class="comment">         * 设置为null,这样既节省流量,又提升了效率</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (District district : list) &#123;</span><br><span class="line">            district.setId(<span class="literal">null</span>);</span><br><span class="line">            district.setParent(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-单元测试-2"><a href="#4-3-单元测试-2" class="headerlink" title="4.3 单元测试"></a>4.3 单元测试</h4><p>在 test 下的 service 文件夹下创建 DistrictServiceTests 测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictServiceTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDistrictService districtService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getByParent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//86代表中国,所有的省父代码号都是86</span></span><br><span class="line">        List&lt;District&gt; list = districtService.getByParent(<span class="string">&quot;86&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (District district : list) &#123;</span><br><span class="line">            System.err.println(district);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-获取省市区列表-控制层"><a href="#5-获取省市区列表-控制层" class="headerlink" title="5.获取省市区列表-控制层"></a>5.获取省市区列表-控制层</h3><h4 id="5-1-设计请求"><a href="#5-1-设计请求" class="headerlink" title="5.1 设计请求"></a>5.1 设计请求</h4><ul>
<li>/districts/</li>
<li>GET</li>
<li>String parent</li>
<li>JsonResult<List<District>&gt;</li>
</ul>
<h4 id="5-2-处理请求"><a href="#5-2-处理请求" class="headerlink" title="5.2 处理请求"></a>5.2 处理请求</h4><p>1.创建一个 DistrictController 类,在类中编写处理请求的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;districts&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistrictController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDistrictService districtService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求路径和父路径相同时用<span class="doctag">@RequestMapping</span>(&#123;&quot;/&quot;,&quot;&quot;&#125;),表</span></span><br><span class="line"><span class="comment">     * 示districts后面跟/或者什么也不跟都会进入这个方法</span></span><br><span class="line"><span class="comment">     * 点进RequestMapping发现参数类型是String[],且传入一</span></span><br><span class="line"><span class="comment">     * 个路径时默认有&#123;&#125;,传入一个以上路径时需要手动添加&#123;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/&quot;,&quot;&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;District&gt;&gt; <span class="title function_">getByParent</span><span class="params">(String parent)</span> &#123;</span><br><span class="line">        List&lt;District&gt; data = districtService.getByParent(parent);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.为了能不登录也可以访问该数据,需要将 districts 请求添加到白名单中:</p>
<p>在 LoginInterceptorConfigure 类的 addInterceptors 方法中添加代码:patterns.add(“/districts/**”);</p>
<p>3.启动服务器,不登录账号,直接在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/districts?parent=86">http://localhost:8080/districts?parent=86</a> 测试能否正常获取数据</p>
<h3 id="6-获取省市区列表-前端页面"><a href="#6-获取省市区列表-前端页面" class="headerlink" title="6.获取省市区列表-前端页面"></a>6.获取省市区列表-前端页面</h3><p>1.原始的下拉列表展示是将数据放在 js,再动态获取 js 中的数据,而目前为止我们已经将数据放在了数据库,所以不能让它再使用这种办法了,所以需要注释掉 addAddress.html 页面的这两行 js 代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;../js/distpicker.data.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/distpicker.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>关于这两行 js 代码:前者是为了获取数据,后者是为了将获取到的数据展示到下拉列表中</p>
<p>2.检查前端页面在提交省市区数据时是否有相关 name 属性和 id 属性(name 用于提交数据,id 用于监听用户的点击)</p>
<p>3.启动服务器,在前端验证一下是否还可以正常保存数据(除了省市区)</p>
<h2 id="获取省市区名称"><a href="#获取省市区名称" class="headerlink" title="获取省市区名称"></a>获取省市区名称</h2><p>上一个模块获取省市区列表是通过父代码号获取子代码号完成联动,该模块获取省市区名称是通过自身的 code 获取自身的 name</p>
<h3 id="1-获取省市区名称-持久层"><a href="#1-获取省市区名称-持久层" class="headerlink" title="1.获取省市区名称-持久层"></a>1.获取省市区名称-持久层</h3><h4 id="3-1-规划需要执行的-SQL-语句-1"><a href="#3-1-规划需要执行的-SQL-语句-1" class="headerlink" title="3.1 规划需要执行的 SQL 语句"></a>3.1 规划需要执行的 SQL 语句</h4><p>根据当前 code 来获取当前省市区的名称,对应就是一条查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dict_district <span class="keyword">where</span> code<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计接口和抽象方法-1"><a href="#3-2-设计接口和抽象方法-1" class="headerlink" title="3.2 设计接口和抽象方法"></a>3.2 设计接口和抽象方法</h4><p>在 DistrictMapper 接口定义 findNameByCode 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">findNameByCode</span><span class="params">(String code)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射-2"><a href="#3-3-编写映射-2" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>在 DistrictMapper.xml 文件中添加 findNameByCode 方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findNameByCode&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">    select name from t_dict_district where code=#&#123;code&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试-2"><a href="#3-4-单元测试-2" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>在 DistrictMapperTests 编写测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findNameByCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> districtMapper.findNameByCode(<span class="string">&quot;610000&quot;</span>);</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-获取省市区名称-业务层"><a href="#2-获取省市区名称-业务层" class="headerlink" title="2.获取省市区名称-业务层"></a>2.获取省市区名称-业务层</h3><h4 id="2-1-规划异常-4"><a href="#2-1-规划异常-4" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><p>没有异常需要处理</p>
<h4 id="2-2-设计接口和抽象方法及实现-4"><a href="#2-2-设计接口和抽象方法及实现-4" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 IDistrictService 接口定义对应的业务层接口中的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getNameByCode</span><span class="params">(String code)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在 DistrictServiceImpl 实现此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getNameByCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> districtMapper.findNameByCode(code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-4"><a href="#2-3-单元测试-4" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>业务层只是调用持久层对应的方法然后返回,没有什么额外的实现,可以不用测试(一般超过 8 行的代码都要进行测试)</p>
<h3 id="3-获取省市区名称-控制层"><a href="#3-获取省市区名称-控制层" class="headerlink" title="3.获取省市区名称-控制层"></a>3.获取省市区名称-控制层</h3><p>实际开发中在获取省市区名称时并不需要前端传控制层,然后传业务层,再传持久层,而是在新增收货地址的业务层需要获取省市区名称,也就是说获取省市区名称的模块不需要控制层,只是需要被新增收货地址的业务层所依赖</p>
<h3 id="4-获取省市区名称-业务层优化"><a href="#4-获取省市区名称-业务层优化" class="headerlink" title="4.获取省市区名称-业务层优化"></a>4.获取省市区名称-业务层优化</h3><p>1.<strong>在新增收货地址的业务层需要对 address 进行封装,使其存有所有数据,然后将 address 传给持久层(记住,持久层只会根据传过来的参数调用某个方法与数据库交互,永远不会有额外的实现),而此时新增收货地址的业务层并没有省市区的数据,所以需要依赖于获取省市区列表的业务层对应的接口中的 getNameByCode 方法</strong></p>
<p>所以需要在业务层实现类 AddressServiceImpl 中加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IDistrictService districtService;</span><br></pre></td></tr></table></figure>
<p>2.在 AddressServiceImpl 的方法中将 DistrictService 接口中获取到的省市区数据封装到 address 对象,此时 address 就包含了所有用户收货地址的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 对address对象中的数据进行补全:省市区的名字看前端代码发现前端传递过来的省市区的name分别为:</span></span><br><span class="line"><span class="comment">* provinceCode,cityCode,areaCode,所以这里可以用address对象的get方法获取这三个的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">String</span> <span class="variable">provinceName</span> <span class="operator">=</span> districtService.getNameByCode(address.getProvinceCode());</span><br><span class="line"><span class="type">String</span> <span class="variable">cityName</span> <span class="operator">=</span> districtService.getNameByCode(address.getCityCode());</span><br><span class="line"><span class="type">String</span> <span class="variable">areaName</span> <span class="operator">=</span> districtService.getNameByCode(address.getAreaCode());</span><br><span class="line">address.setProvinceName(provinceName);</span><br><span class="line">address.setCityName(cityName);</span><br><span class="line">address.setAreaName(areaName);</span><br></pre></td></tr></table></figure>
<h3 id="5-获取省市区名称-前端页面"><a href="#5-获取省市区名称-前端页面" class="headerlink" title="5.获取省市区名称-前端页面"></a>5.获取省市区名称-前端页面</h3><p><strong>在 addAddress.html 页面中来编写对应的省市区展示及根据用户的不同选择来限制对应的标签中的内容</strong></p>
<p>分析:</p>
<ul>
<li>在加载该页面时三个下拉列表的内容都显示为”——-请选择——-“</li>
<li>没有选择市时如果点击区的下拉列表则列表中只有一个”——-请选择——-“</li>
<li>加载该页面时需要自动发送一个请求把 parent=86 发送出去,然后将返回的省/直辖市填充到 select 标签中</li>
<li>点击四川省后发送请求获取其下的市,并且将获取到的市罗列在市区域下拉列表中</li>
<li>省点击”——-请选择——-“则需要把市,县内容填充为”——-请选择——-“终止请求而不是程序继续跑下去</li>
<li>切换省份时,市,县内容更换为”——-请选择——-“</li>
</ul>
<p>在 addAddress.html 中编写 js 代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**因为清空后下拉列表的select标签没有option标签,所以需要设置一个默认的option标</span></span><br><span class="line"><span class="comment"> * 签并给市,县加上该标签.option标签并不会把内容发送到后端,而是将value值发</span></span><br><span class="line"><span class="comment"> * 送给后端,所以用value表示当前这个区域的code值</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">var</span> defaultOption=<span class="string">&quot;&lt;option value=&#x27;0&#x27;&gt;-----请选择-----&lt;/option&gt;&quot;</span>;</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//加载省的数据罗列时代码量较多,建议定义在外部方法中,然后在这里调用定义的方法</span></span><br><span class="line">    <span class="title function_">showProvinceList</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将省,市,县的下拉列表内容设为&quot;-----请选择-----&quot;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * select标签默认获取第一个option的内容填充到下拉列表中,所以即使加载</span></span><br><span class="line"><span class="comment">     * 页面时省区域的下拉列表中已经有了所有省但仍然会显示-----请选择-----</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    $(<span class="string">&quot;#province-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line">    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//省的下拉列表数据展示</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showProvinceList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,<span class="comment">//发送请求用于获取所有省对象</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="string">&quot;parent=86&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> list = json.<span class="property">data</span>;<span class="comment">//获取所有省对象的List集合</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> opt =</span><br><span class="line">                        <span class="string">&quot;&lt;option value=&#x27;&quot;</span>+list[i].<span class="property">code</span>+<span class="string">&quot;&#x27;&gt;&quot;</span>+list[i].<span class="property">name</span>+<span class="string">&quot;&lt;/option&gt;&quot;</span>;</span><br><span class="line">                    $(<span class="string">&quot;#province-list&quot;</span>).<span class="title function_">append</span>(opt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                &lt;!--这个其实永远不会执行,因为没有编写</span><br><span class="line">                异常,控制层返回的状态码永远是<span class="variable constant_">OK</span>--&gt;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;省/直辖区的信息加载失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这里没有写属性error,不知道为啥不用写,感觉写了更好</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * change()函数用于监听某个控件是否发生改变,一旦发生改变就</span></span><br><span class="line"><span class="comment"> * 会触发参数形式的函数,所以参数需要是function()&#123;&#125;</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">$(<span class="string">&quot;#province-list&quot;</span>).<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//先获取到省区域父代码号</span></span><br><span class="line">    <span class="keyword">var</span> parent = $(<span class="string">&quot;#province-list&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果我选择了河南省洛阳市涧西区,然后又选择了河北省,此时需要</span></span><br><span class="line"><span class="comment">     * 将市,县下拉列表的所有option清除并显示内容-----请选择-----</span></span><br><span class="line"><span class="comment">     * empty()表示某标签的所有子标签(针对此页面来说select的子标</span></span><br><span class="line"><span class="comment">     * 签只有option)</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    $(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">    <span class="comment">//填充默认值:-----请选择-----</span></span><br><span class="line">    $(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line">    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="number">0</span>) &#123;<span class="comment">//如果继续程序,后面的ajax接收的json数据中的data是</span></span><br><span class="line">        <span class="keyword">return</span>;<span class="comment">//空集合[],进不了for循环,没有任何意义,所以直接在这里终止程序</span></span><br><span class="line">    &#125;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="string">&quot;parent=&quot;</span>+parent,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> opt =</span><br><span class="line">                        <span class="string">&quot;&lt;option value=&#x27;&quot;</span>+list[i].<span class="property">code</span>+<span class="string">&quot;&#x27;&gt;&quot;</span>+list[i].<span class="property">name</span>+<span class="string">&quot;&lt;/option&gt;&quot;</span>;</span><br><span class="line">                    $(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">append</span>(opt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;市的信息加载失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> parent = $(<span class="string">&quot;#city-list&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">append</span>(defaultOption);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/districts&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="string">&quot;parent=&quot;</span>+parent,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> opt =</span><br><span class="line">                        <span class="string">&quot;&lt;option value=&#x27;&quot;</span>+list[i].<span class="property">code</span>+<span class="string">&quot;&#x27;&gt;&quot;</span>+list[i].<span class="property">name</span>+<span class="string">&quot;&lt;/option&gt;&quot;</span>;</span><br><span class="line">                    $(<span class="string">&quot;#area-list&quot;</span>).<span class="title function_">append</span>(opt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;县的信息加载失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="收货地址列表展示"><a href="#收货地址列表展示" class="headerlink" title="收货地址列表展示"></a>收货地址列表展示</h2><h3 id="1-收货地址列表展示-持久层"><a href="#1-收货地址列表展示-持久层" class="headerlink" title="1.收货地址列表展示-持久层"></a>1.收货地址列表展示-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-1"><a href="#1-1-规划需要执行的-SQL-语句-1" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>数据库数据的查询操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> uid ? <span class="keyword">order</span> <span class="keyword">by</span> is_default <span class="keyword">DESC</span>,created_time <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<p>其中 order by is_default DESC 是为了让默认收货地址展示在最上面,order by 可以有多个字句,中间用逗号隔开,后面加的 create_time DESC 是为了让非默认收货地址创建的越晚越展示在上面</p>
<h4 id="1-2-设计接口和抽象方法-3"><a href="#1-2-设计接口和抽象方法-3" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 AddressMapper 接口追加抽象方法 findByUid</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据用户的uid查询用户的收货地址数据</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> uid 用户uid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 收货地址数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Address&gt; <span class="title function_">findByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-3"><a href="#1-3-编写映射-3" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 xml 文件添加相应的 sql 语句映射</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;findByUid&quot; resultMap<span class="operator">=</span>&quot;AddressEntityMap&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> uid<span class="operator">=</span>#&#123;uid&#125;</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> is_default <span class="keyword">DESC</span>,created_time <span class="keyword">DESC</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-3"><a href="#1-4-单元测试-3" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByUid</span> <span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Address&gt; list = addressMapper.findByUid(<span class="number">11</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-收货地址列表展示-业务层"><a href="#2-收货地址列表展示-业务层" class="headerlink" title="2.收货地址列表展示-业务层"></a>2.收货地址列表展示-业务层</h3><h4 id="2-1-规划异常-5"><a href="#2-1-规划异常-5" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><p>该模块只是为了展示列表,不涉及到增删改,即便没有拿到任何数据,那无非就是不展示呗,所以不涉及到异常,不需要在业务层抛出异常</p>
<h4 id="2-2-设计接口和抽象方法及实现-5"><a href="#2-2-设计接口和抽象方法及实现-5" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Address&gt; <span class="title function_">getByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<p>2.实现该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Address&gt; <span class="title function_">getByUid</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    List&lt;Address&gt; list = addressMapper.findByUid(uid);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 收货地址列表在前端只展示了四个数据,这里让其他值为空降低数据量</span></span><br><span class="line"><span class="comment">    * ProvinceName,CityName,AreaName,aid,tel(确认订单页展示展示用户地</span></span><br><span class="line"><span class="comment">    * 址时用到tel)在展示地址列表用不到,但是后面提交订单时的地址会用到,所以这里不设为null</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">for</span> (Address address : list) &#123;</span><br><span class="line">        <span class="comment">//address.setAid(null);</span></span><br><span class="line">        address.setUid(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//address.setProvinceName(null);</span></span><br><span class="line">        address.setProvinceCode(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//address.setCityName(null);</span></span><br><span class="line">        address.setCityCode(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//address.setAreaName(null);</span></span><br><span class="line">        address.setAreaCode(<span class="literal">null</span>);</span><br><span class="line">        address.setZip(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//address.setTel(null);</span></span><br><span class="line">        address.setIsDefault(<span class="literal">null</span>);</span><br><span class="line">        address.setCreatedTime(<span class="literal">null</span>);</span><br><span class="line">        address.setCreatedUser(<span class="literal">null</span>);</span><br><span class="line">        address.setModifiedTime(<span class="literal">null</span>);</span><br><span class="line">        address.setModifiedUser(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-5"><a href="#2-3-单元测试-5" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>这里不再进行单元测试</p>
<h3 id="3-收货地址列表展示-控制层"><a href="#3-收货地址列表展示-控制层" class="headerlink" title="3.收货地址列表展示-控制层"></a>3.收货地址列表展示-控制层</h3><h4 id="3-1-处理异常-3"><a href="#3-1-处理异常-3" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>因为业务层没有抛出异常,所以这里不需要处理异常</p>
<h4 id="3-2-设计请求-3"><a href="#3-2-设计请求-3" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/addresses</li>
<li>HttpSession session</li>
<li>get(该功能模块只需要 uid,不需要别的数据,而且 uid 也是在后端封装的,所以前端没有提交什么数据,体量很小可以用 get)</li>
<li>JsonResult<List<Address>&gt;</li>
</ul>
<h4 id="3-3-处理请求-3"><a href="#3-3-处理请求-3" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>实现请求方法的编写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&#123;&quot;&quot;,&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;Address&gt;&gt; <span class="title function_">getByUid</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUidFromSession(session);</span><br><span class="line">    List&lt;Address&gt; data = addressService.getByUid(uid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录账号后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/addresses">http://localhost:8080/addresses</a> 测试能否拿到数据</p>
<h3 id="4-收货地址列表展示-前端页面"><a href="#4-收货地址列表展示-前端页面" class="headerlink" title="4.收货地址列表展示-前端页面"></a>4.收货地址列表展示-前端页面</h3><p>在 address.html 中编写 js 代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    	<span class="title function_">showAddressList</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**展示用户收货地址数据列表*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showAddressList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/addresses&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="comment">//data: &quot;parent=86&quot;,//不需要提交数据,所以data可以删去</span></span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(list);<span class="comment">//调试用</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="comment">//先写一个var tr = &#x27;&#x27;; 然后去上面的地址展示中找一个tr标签复制粘贴到单引号里面,再删去多余的制表符</span></span><br><span class="line">                    <span class="keyword">var</span> tr = <span class="string">&#x27;&lt;tr&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;#&#123;tag&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;#&#123;name&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;#&#123;address&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;#&#123;phone&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;&lt;a class=&quot;btn btn-xs btn-info&quot;&gt;&lt;span class=&quot;fa fa-edit&quot;&gt;&lt;/span&gt; 修改&lt;/a&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;&lt;a class=&quot;btn btn-xs add-del btn-info&quot;&gt;&lt;span class=&quot;fa fa-trash-o&quot;&gt;&lt;/span&gt; 删除&lt;/a&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;&lt;a class=&quot;btn btn-xs add-def btn-default&quot;&gt;设为默认&lt;/a&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">                    <span class="comment">//下面用正则表达式更改字符串,上面的#&#123;tag&#125;#&#123;name&#125;等等只</span></span><br><span class="line">                    <span class="comment">//是占位符,没有任何意义,我也可以把#&#123;tag&#125;写成任何想写的东西</span></span><br><span class="line">                    <span class="comment">//replace的第一个参数/占位符/g可以,&quot;占位符&quot;也可以</span></span><br><span class="line">                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;tag&#125;/g</span>,list[i].<span class="property">tag</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;name&#125;/g</span>,list[i].<span class="property">name</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;address&#125;&quot;</span>,list[i].<span class="property">address</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;phone&#125;&quot;</span>,list[i].<span class="property">phone</span>);</span><br><span class="line"></span><br><span class="line">                    $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">append</span>(tr);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//用hide方法将第一个收货地址的&quot;设为默认&quot;元素隐藏,.add-def:eq(0)表</span></span><br><span class="line">                <span class="comment">//示第一个class为add-def的标签,这样就可以保证隐藏的是第一个收货地址</span></span><br><span class="line">                $(<span class="string">&quot;.add-def:eq(0)&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                &lt;!--这个其实永远不会执行,因为没有编写</span><br><span class="line">                异常,控制层返回的状态码永远是<span class="variable constant_">OK</span>--&gt;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;用户收货地址数据加载失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="设置默认收货地址"><a href="#设置默认收货地址" class="headerlink" title="设置默认收货地址"></a>设置默认收货地址</h2><h3 id="1-设置默认收货地址-持久层"><a href="#1-设置默认收货地址-持久层" class="headerlink" title="1.设置默认收货地址-持久层"></a>1.设置默认收货地址-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-2"><a href="#1-1-规划需要执行的-SQL-语句-2" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>无论选择的是哪一条数据,都把所有的数据设为非默认,再把当前数据设为默认</p>
<blockquote>
<p>我们可能会想着把第一条设为非默认,再将该条设为默认,但这样处理的话需要额外做一条查询语句拿到默认地址的数据</p>
</blockquote>
<p>1.检测当前用户想设置为默认收货地址的这条数据是否存在</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> aid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<p>2.在修改用户的默认收货地址之前先将所有的收货地址设置为非默认</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span> is_default<span class="operator">=</span><span class="number">0</span> <span class="keyword">where</span> uid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<p>3.将用户选中的这条记录设置为默认收货地址</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span> is_default<span class="operator">=</span><span class="number">1</span>,modified_user<span class="operator">=</span>?,modified_time<span class="operator">=</span>? <span class="keyword">where</span> aid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设计接口和抽象方法-4"><a href="#1-2-设计接口和抽象方法-4" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 AddressMapper 接口中来定义实现该模块所需的三个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据aid查询收货地址数据</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> aid 收货地址aid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 收货地址数据,如果没有找到则返回null值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Address <span class="title function_">findByAid</span><span class="params">(Integer aid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据用户uid修改用户的收货地址统一设置为非默认</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> uid 用户uid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Integer <span class="title function_">updateNonDefault</span><span class="params">(Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Integer <span class="title function_">updateDefaultByAid</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;aid&quot;)</span> Integer aid,</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;modifiedUser&quot;)</span> String modifiedUser,</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;modifiedTime&quot;)</span> Date modifiedTime)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-4"><a href="#1-3-编写映射-4" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 AddressMapper.xml 中编写映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByAid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_address where aid=#&#123;aid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateNonDefault&quot;</span>&gt;</span></span><br><span class="line">    update t_address</span><br><span class="line">    set is_default=0</span><br><span class="line">    where uid=#&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateDefaultByAid&quot;</span>&gt;</span></span><br><span class="line">    update t_address</span><br><span class="line">    set is_default=1,</span><br><span class="line">    modified_user=#&#123;modifiedUser&#125;,</span><br><span class="line">    modified_time=#&#123;modifiedTime&#125;</span><br><span class="line">    where aid=#&#123;aid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-4"><a href="#1-4-单元测试-4" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByAid</span><span class="params">()</span> &#123;</span><br><span class="line">    System.err.println(addressMapper.findByAid(<span class="number">9</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateNonDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(addressMapper.updateNonDefault(<span class="number">11</span>));<span class="comment">//有几条数据影响行数就输出几</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateDefaultByAid</span><span class="params">()</span> &#123;</span><br><span class="line">    addressMapper.updateDefaultByAid(<span class="number">9</span>,<span class="string">&quot;明明&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-设置默认收货地址-业务层"><a href="#2-设置默认收货地址-业务层" class="headerlink" title="2.设置默认收货地址-业务层"></a>2.设置默认收货地址-业务层</h3><h4 id="2-1-规划异常-6"><a href="#2-1-规划异常-6" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>在执行更新时产生未知的 UpdateException 异常,已经创建无需重复创建</li>
<li>访问的数据不是当前登录用户的收货地址数据,属于非法访问,AccessDeniedException 异常(就比如说,展示收货地址列表的 sql 语句写错了,然后这里展示的是别人的收货地址,此时想要将某个收货地址改为默认就属于非法访问了)</li>
<li>收货地址可能不存在的 AddressNotFoundException 异常,(比如,刚展示完收货地址列表,管理员误删地址了,此时地址就不存在了)</li>
</ul>
<p>在业务层的 ex 包下创建如下两个异常类,并使其继承 ServiceException 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**收货地址数据不存在的异常*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**非法访问的异常*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现-6"><a href="#2-2-设计接口和抽象方法及实现-6" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 IAddressService 接口中编写抽象方法 setDefault,并使其在方法内部统一实现持久层的三个方法</p>
<p>分析一下该方法需要什么参数:</p>
<blockquote>
<p>先看持久层的三个方法需要什么参数:aid,uid,modifiedUser,modifiedTime.</p>
<p>其中 aid 是从前端一步一步传到业务层的,所以需要该参数</p>
<p>uid 和 modifiedUser 是一样的,都是由控制层从 session 获取的 uid 并传给业务层,所以需要该参数</p>
<p>modifiedTime 可以在业务层 new Date,所以不需要该参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 修改某个用户的某条收货地址数据为默认收货地址</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> aid 收货地址的id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> username 修改执行人</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(Integer aid,Integer uid,String username)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在 AddressServiceImpl 类编写该方法的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(Integer aid, Integer uid, String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.检测是否有该条收货地址数据</span></span><br><span class="line">    <span class="type">Address</span> <span class="variable">result</span> <span class="operator">=</span> addressMapper.findByAid(aid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收货地址不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.检测当前获取到的收货地址数据的归属</span></span><br><span class="line">    <span class="keyword">if</span> (!result.getUid().equals(uid)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法数据访问&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.先将所有的收货地址设置为非默认</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> addressMapper.updateNonDefault(uid);</span><br><span class="line">    <span class="keyword">if</span> (rows &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.将用户选中的地址设置为默认收货地址</span></span><br><span class="line">    rows = addressMapper.updateDefaultByAid(aid, username, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-6"><a href="#2-3-单元测试-6" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>在 AddressServiceTests 类中编写单元测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    addressService.setDefault(<span class="number">9</span>,<span class="number">11</span>,<span class="string">&quot;管理员&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-设置默认收货地址-控制层"><a href="#3-设置默认收货地址-控制层" class="headerlink" title="3.设置默认收货地址-控制层"></a>3.设置默认收货地址-控制层</h3><h4 id="3-1-处理异常-4"><a href="#3-1-处理异常-4" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>在 BaseController 类中处理业务层抛出的两个异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AddressNotFoundException) &#123;</span><br><span class="line">    result.setState(<span class="number">4004</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;用户的收货地址数据不存在的异常&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AccessDeniedException) &#123;</span><br><span class="line">    result.setState(<span class="number">4005</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;收货地址数据非法访问的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求-4"><a href="#3-2-设计请求-4" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/addresses/{aid}/set_default(以前的数据是通过表单直接提交的,还有一种提交方式就是 RestFul 风格,这种提交方式可以提交更多的数据,这里用这个提交方式)</li>
<li>GET</li>
<li>Integer aid,HttpSession session(如果这里是 id 那就必须在 Integer aid 前加@PathVariable(“aid”)强行将 aid 的值注入到 id 中)</li>
<li>JsonResult<Void></li>
</ul>
<h4 id="3-3-处理请求-4"><a href="#3-3-处理请求-4" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>在 AddressController 类中编写请求处理方法.</p>
<p><strong>RestFul 编写时不管参数名和占位符是否一致都必须加@PathVariable(“aid”)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RestFul风格的请求编写</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;&#123;aid&#125;/set_default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">setDefault</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@PathVariable(&quot;aid&quot;)</span> Integer aid,HttpSession session)</span> &#123;</span><br><span class="line">    addressService.setDefault(</span><br><span class="line">        aid,</span><br><span class="line">        getUidFromSession(session),</span><br><span class="line">        getUsernameFromSession(session));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录账号后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/addresses/8/set_default">http://localhost:8080/addresses/8/set_default</a> 进行测试</p>
<h3 id="4-设置默认收货地址-前端页面"><a href="#4-设置默认收货地址-前端页面" class="headerlink" title="4.设置默认收货地址-前端页面"></a>4.设置默认收货地址-前端页面</h3><p>观察 address.html 代码发现”设为默认”按钮没有 id 属性,那应该怎么获取”设为默认”按钮以监听是否被点击了呢?</p>
<p>法一:给”设为默认”的标签添加 id 属性(我觉得不对,因为 id 必须是唯一的,如果给该按钮加 id 属性,那么该用户有几个收货地址就会给几个按钮加同样的 id,这显然不对,我认为可以用按钮上本就存在的 class 属性)。</p>
<p>法二:给”设置默认”按钮添加一个 onclick 属性,指向一个方法的调用,在这个方法中来完成 ajax 请求的方法</p>
<p>在这里用第二种方法:</p>
<p>1.展示用户收货地址数据列表的 js 函数中用 for 循环给页面增加地址数据的 tr 标签,我们需要在 for 循环中为每一个 tr 标签增加 onclick 属性并指向 setDefault(#{aid})函数,括号里面占位符是为了给外部的 setDefault 函数传参,可以随便写,只要给占位符赋值时对应就可以了,.<strong>注意,即使调用的是无参函数也要加括号</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">&quot;setDefault(#&#123;aid&#125;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-xs add-def btn-default&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    设为默认</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/td&gt;</span><br></pre></td></tr></table></figure>
<p>2.在 for 循环中为占位符赋值:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;aid&#125;&quot;</span>, list[i].<span class="property">aid</span>);</span><br></pre></td></tr></table></figure>
<p>3.完成 setDefault 方法的声明</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setDefault</span>(<span class="params">aid</span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/addresses/&quot;</span> + aid + <span class="string">&quot;/set_default&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="comment">//data: $(&quot;#form-change-password&quot;).serialize(),</span></span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">//重新加载收货地址列表页面</span></span><br><span class="line">        <span class="title function_">showAddressList</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;设置默认收货地址失败&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;设置默认收货地址时产生未知的异常!&quot;</span> + xhr.<span class="property">message</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除收货地址"><a href="#删除收货地址" class="headerlink" title="删除收货地址"></a>删除收货地址</h2><h3 id="1-删除收货地址-持久层"><a href="#1-删除收货地址-持久层" class="headerlink" title="1.删除收货地址-持久层"></a>1.删除收货地址-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-3"><a href="#1-1-规划需要执行的-SQL-语句-3" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>1.在删除之前判断该数据是否存在,需要执行查询语句看能否查到该数据,还需要根据返回的 aid 获取 uid 并和 session 中的 uid 进行比较判断归属是否正确,这一条 SQL 语句在设置收货地址时已经开发,无需重复开发</p>
<p>2.开发执行删除的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> aid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<p>3.需要判断删除的地址是否是默认地址(使用 aid 查询到的地址对象的 getIsDefault 方法),如果判断出删的是默认地址,则还需要定义把哪个地址设为默认,这里定义最新修改的为默认地址.</p>
<p>开发该 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> uid<span class="operator">=</span>? <span class="keyword">order</span> <span class="keyword">by</span> modified_time <span class="keyword">DESC</span> limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>其中 limit 0,1 表示查询到的第一条数据(limit (n-1),pageSize),这样查询后就只会获得第一条数据</strong></p>
<p>4.如果用户本身就只有一条地址,那么删除后其他操作就可以不进行了,所以需要查询该用户的所有地址数量,在设置收货地址时已经开发,无需重复开发</p>
<h4 id="1-2-设计接口和抽象方法-5"><a href="#1-2-设计接口和抽象方法-5" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 AddressMapper 接口中进行抽象方法的设计</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据收货地址id删除收货地址数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> aid 收货地址的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Integer <span class="title function_">deleteByAid</span><span class="params">(Integer aid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户uid查询用户最后一次被修改的收货地址数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 收货地址数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Address <span class="title function_">findLastModified</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-5"><a href="#1-3-编写映射-5" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 AddressMapper.xml 文件中进行映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByAid&quot;</span>&gt;</span></span><br><span class="line">    delete from t_address where aid=#&#123;aid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findLastModified&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_address</span><br><span class="line">    where uid=#&#123;uid&#125;</span><br><span class="line">    order by modified_time DESC limit 0,1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-5"><a href="#1-4-单元测试-5" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteByAid</span><span class="params">()</span> &#123;</span><br><span class="line">    addressMapper.deleteByAid(<span class="number">11</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findLastModified</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(addressMapper.findLastModified(<span class="number">11</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-删除收货地址-业务层"><a href="#2-删除收货地址-业务层" class="headerlink" title="2.删除收货地址-业务层"></a>2.删除收货地址-业务层</h3><h4 id="2-1-规划异常-7"><a href="#2-1-规划异常-7" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>可能没有该条地址数据(已开发)</li>
<li>可能地址数据归属错误(已开发)</li>
<li>在执行删除的时候可能会产生未知的异常导致数据不能够删除成功,则抛出 DeleteException 异常,在 service 创建该异常并使其继承业务层异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**删除数据时产生的异常*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeleteException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现-7"><a href="#2-2-设计接口和抽象方法及实现-7" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 IAddressService 接口中定义抽象方法</p>
<p>需要给抽象方法声明哪些参数呢:</p>
<blockquote>
<p>根据分析可得,该抽象方法的实现依赖于持久层的以下方法:</p>
<p>1.findByAid:查询该条地址数据是否存在,参数是 aid</p>
<p>3.deleteByAid:删除地址数据,参数是 aid</p>
<p>5.countByUid:统计用户地址数量,参数是 uid</p>
<p>6.findLastModified:查询得到最后修改的一条地址,参数是 uid</p>
<p>7.updateDefaultByAid:设置默认收货地址,参数是 aid,modifiedUser,modifiedTime</p>
<p>稍加分析可以得出接下来定义的抽象方法的参数是:aid,uid,username</p>
</blockquote>
<p><strong>把上面的分析补上:2.判断地址数据归属是否正确 4.判断删除的是否是默认地址.这七步就是业务层完整的开发流程</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除用户选中的收货地址数据</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> aid 收货地址id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer aid,Integer uid,String username)</span>;</span><br></pre></td></tr></table></figure>
<p>2.实现该抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer aid, Integer uid, String username)</span> &#123;</span><br><span class="line">    <span class="type">Address</span> <span class="variable">result</span> <span class="operator">=</span> addressMapper.findByAid(aid);</span><br><span class="line">    <span class="comment">//1.</span></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收货地址数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.</span></span><br><span class="line">    <span class="keyword">if</span> (!result.getUid().equals(uid)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法数据访问&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> addressMapper.deleteByAid(aid);</span><br><span class="line">    <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeleteException</span>(<span class="string">&quot;删除数据时产生未知的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.如果删除的是非默认地址则不需要再做后面的任何操作,终止程序</span></span><br><span class="line">    <span class="keyword">if</span> (result.getIsDefault() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> addressMapper.countByUid(uid);</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.</span></span><br><span class="line">    <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressMapper.findLastModified(uid);</span><br><span class="line">    <span class="comment">//7.</span></span><br><span class="line">    rows = addressMapper.updateDefaultByAid(address.getAid(), username, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-7"><a href="#2-3-单元测试-7" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">    addressService.delete(<span class="number">1</span>,<span class="number">11</span>,<span class="string">&quot;4.11删除&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-删除收货地址-控制层"><a href="#3-删除收货地址-控制层" class="headerlink" title="3.删除收货地址-控制层"></a>3.删除收货地址-控制层</h3><h4 id="3-1-处理异常-5"><a href="#3-1-处理异常-5" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>需要在 BaseController 类中处理异常类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DeleteException) &#123;</span><br><span class="line">    result.setState(<span class="number">5002</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;删除数据时产生未知的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求-5"><a href="#3-2-设计请求-5" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/addresses/{aid}/delete</li>
<li>POST</li>
<li>Integer aid,HttpSession session</li>
<li>JsonResult<Void></li>
</ul>
<h4 id="3-3-处理请求-5"><a href="#3-3-处理请求-5" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;&#123;aid&#125;/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;aid&quot;)</span> Integer aid,HttpSession session)</span> &#123;</span><br><span class="line">    addressService.delete(</span><br><span class="line">        aid,</span><br><span class="line">        getUidFromSession(session),</span><br><span class="line">        getUsernameFromSession(session));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试-3"><a href="#3-4-单元测试-3" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>在 AddressController 类编写请求处理方法的实现</p>
<p>这个方法就只是调用业务层方法然后给前端返回一些信息,可以选择不用测试</p>
<h3 id="4-删除收货地址-前端页面"><a href="#4-删除收货地址-前端页面" class="headerlink" title="4.删除收货地址-前端页面"></a>4.删除收货地址-前端页面</h3><p>处理该前端页面的所有步骤和处理”设置默认收货地址”的一样</p>
<p>1.给”删除”按钮添加 onclick 属性并指向 deleteByAid(aid)方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">&quot;delete(#&#123;aid&#125;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-xs add-del btn-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-trash-o&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> 删除</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/td&gt;</span><br></pre></td></tr></table></figure>
<p>2.给占位符赋值</p>
<p>因为处理”设置默认收货地址”时已经编写 tr = tr.replace(“#{aid}”,list[i].aid);用来给占位符#{aid}赋值,所以这里不需要再写.但是需要把 replace 改为 replaceAll</p>
<p>3.完成 deleteByAid(aid)方法的声明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">setDefault</span><span class="params">(aid)</span> &#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">&quot;/addresses/&quot;</span>+aid+<span class="string">&quot;/set_default&quot;</span>,</span><br><span class="line">        type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="comment">//data: $(&quot;#form-change-password&quot;).serialize(),</span></span><br><span class="line">        dataType: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        success: function (json) &#123;</span><br><span class="line">            <span class="keyword">if</span> (json.state == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="comment">//重新加载收货地址列表页面</span></span><br><span class="line">                showAddressList();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(<span class="string">&quot;删除收货地址失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: function (xhr) &#123;</span><br><span class="line">            alert(<span class="string">&quot;删除收货地址时产生未知的异常!&quot;</span>+xhr.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="商品热销排行"><a href="#商品热销排行" class="headerlink" title="商品热销排行"></a>商品热销排行</h2><h3 id="1-创建数据表-3"><a href="#1-创建数据表-3" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.在 store 数据库中创建 t_product 数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_product (</span><br><span class="line">  id int(20) NOT NULL COMMENT &#x27;商品id&#x27;,</span><br><span class="line">  category_id int(20) DEFAULT NULL COMMENT &#x27;分类id&#x27;,</span><br><span class="line">  item_type varchar(100) DEFAULT NULL COMMENT &#x27;商品系列&#x27;,</span><br><span class="line">  title varchar(100) DEFAULT NULL COMMENT &#x27;商品标题&#x27;,</span><br><span class="line">  sell_point varchar(150) DEFAULT NULL COMMENT &#x27;商品卖点&#x27;,</span><br><span class="line">  price bigint(20) DEFAULT NULL COMMENT &#x27;商品单价&#x27;,</span><br><span class="line">  num int(10) DEFAULT NULL COMMENT &#x27;库存数量&#x27;,</span><br><span class="line">  image varchar(500) DEFAULT NULL COMMENT &#x27;图片路径&#x27;,</span><br><span class="line">  `status` int(1) DEFAULT &#x27;1&#x27; COMMENT &#x27;商品状态  1：上架   2：下架   3：删除&#x27;,</span><br><span class="line">  priority int(10) DEFAULT NULL COMMENT &#x27;显示优先级&#x27;,</span><br><span class="line">  created_time datetime DEFAULT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  modified_time datetime DEFAULT NULL COMMENT &#x27;最后修改时间&#x27;,</span><br><span class="line">  created_user varchar(50) DEFAULT NULL COMMENT &#x27;创建人&#x27;,</span><br><span class="line">  modified_user varchar(50) DEFAULT NULL COMMENT &#x27;最后修改人&#x27;,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<p>2.向该表插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES t_product WRITE;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product <span class="keyword">VALUES</span> (<span class="number">10000001</span>,<span class="number">238</span>,<span class="string">&#x27;牛皮纸记事本&#x27;</span>,<span class="string">&#x27;广博(GuangBo)10本装40张A5牛皮纸记事本子日记本办公软抄本GBR0731&#x27;</span>,<span class="string">&#x27;经典回顾！超值特惠！&#x27;</span>,<span class="number">23</span>,<span class="number">99999</span>,<span class="string">&#x27;/images/portal/00GuangBo1040A5GBR0731/&#x27;</span>,<span class="number">1</span>,<span class="number">62</span>,<span class="string">&#x27;2017-10-25 15:08:55&#x27;</span>,<span class="string">&#x27;2017-10-25 15:08:55&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>),等等等等;</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建商品的实体类"><a href="#2-创建商品的实体类" class="headerlink" title="2.创建商品的实体类"></a>2.创建商品的实体类</h3><p>创建 Product 实体类并使其继承 BaseEntity 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 商品数据的实体类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer categoryId;</span><br><span class="line">    <span class="keyword">private</span> String itemType;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String sellPoint;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-商品热销排行-持久层"><a href="#3-商品热销排行-持久层" class="headerlink" title="3.商品热销排行-持久层"></a>3.商品热销排行-持久层</h3><h4 id="3-1-规划需要执行的-SQL-语句-2"><a href="#3-1-规划需要执行的-SQL-语句-2" class="headerlink" title="3.1 规划需要执行的 SQL 语句"></a>3.1 规划需要执行的 SQL 语句</h4><p>查询热销商品列表的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> status<span class="operator">=</span><span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> priority <span class="keyword">DESC</span> LIMIT <span class="number">0</span>,<span class="number">4</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计接口和抽象方法-2"><a href="#3-2-设计接口和抽象方法-2" class="headerlink" title="3.2 设计接口和抽象方法"></a>3.2 设计接口和抽象方法</h4><p>在 mapper 包下创建 ProductMapper 接口并在接口中添加查询热销商品 findHotList()的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询热销商品的前四名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 热销商品前四名的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findHotList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射-3"><a href="#3-3-编写映射-3" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>在 main\resources\mapper 文件夹下创建 ProductMapper.xml 文件，并在文件中配置 findHotList()方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.ProductMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;ProductEntityMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.cy.store.entity.Product&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;category_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;categoryId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;item_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;itemType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sell_point&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sellPoint&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedTime&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findHotList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ProductEntityMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_product where status=1 order by priority desc limit 0,4</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-商品热销排行-业务层"><a href="#4-商品热销排行-业务层" class="headerlink" title="4.商品热销排行-业务层"></a>4.商品热销排行-业务层</h3><h4 id="4-1-规划异常-3"><a href="#4-1-规划异常-3" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><blockquote>
<p>只要是查询,不涉及到增删改的,都没有异常,无非就是没有该数据然后返回空</p>
</blockquote>
<h4 id="4-2-设计接口和抽象方法及实现-2"><a href="#4-2-设计接口和抽象方法及实现-2" class="headerlink" title="4.2 设计接口和抽象方法及实现"></a>4.2 设计接口和抽象方法及实现</h4><p>1.创建 IProductService 接口，并在接口中添加 findHotList()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProductService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询热销商品的前四名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 热销商品前四名的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findHotList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.在业务层创建 ProductServiceImpl 类并实现该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cy.store.service.impl;</span><br><span class="line"><span class="keyword">import</span> com.cy.store.entity.Product;</span><br><span class="line"><span class="keyword">import</span> com.cy.store.mapper.ProductMapper;</span><br><span class="line"><span class="keyword">import</span> com.cy.store.service.IProductService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 处理商品数据的业务层实现类 */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">findHotList</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Product&gt; list = productMapper.findHotList();</span><br><span class="line">        <span class="keyword">for</span> (Product product : list) &#123;</span><br><span class="line">            product.setPriority(<span class="literal">null</span>);</span><br><span class="line">            product.setCreatedUser(<span class="literal">null</span>);</span><br><span class="line">            product.setCreatedTime(<span class="literal">null</span>);</span><br><span class="line">            product.setModifiedUser(<span class="literal">null</span>);</span><br><span class="line">            product.setModifiedTime(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-商品热销排行-控制层"><a href="#5-商品热销排行-控制层" class="headerlink" title="5.商品热销排行-控制层"></a>5.商品热销排行-控制层</h3><h4 id="5-1-处理异常-1"><a href="#5-1-处理异常-1" class="headerlink" title="5.1 处理异常"></a>5.1 处理异常</h4><blockquote>
<p>无异常。</p>
</blockquote>
<h4 id="5-2-设计请求-2"><a href="#5-2-设计请求-2" class="headerlink" title="5.2 设计请求"></a>5.2 设计请求</h4><ul>
<li>/products/hot_list</li>
<li>GET</li>
<li>不需要请求参数</li>
<li>JsonResult<List<Product>&gt;</li>
</ul>
<h4 id="5-3-处理请求-2"><a href="#5-3-处理请求-2" class="headerlink" title="5.3 处理请求"></a>5.3 处理请求</h4><p>1.创建 ProductController 类并使其继承 BaseController 类,在类中编写处理请求的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;hot_list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;Product&gt;&gt; <span class="title function_">getHotList</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Product&gt; data = productService.findHotList();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;List&lt;Product&gt;&gt;(OK, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.为了能不登录也可以访问该数据,需要将 products/**请求添加到白名单中:</p>
<p>在 LoginInterceptorConfigure 类的 addInterceptors 方法中添加代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patterns.add(<span class="string">&quot;/products/**&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="6-商品-热销排行-前端页面"><a href="#6-商品-热销排行-前端页面" class="headerlink" title="6.商品-热销排行-前端页面"></a>6.商品-热销排行-前端页面</h3><p>1.在 index.html 页面给“热销排行”列表的 div 标签设置 id 属性值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;hot-list&quot;</span> <span class="attr">class</span>=<span class="string">&quot;panel-body panel-item&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.在 index.html 页面中添加展示热销排行商品的 js 代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">showHotList</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHotList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;#hot-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/products/hot_list&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(list[i].<span class="property">title</span>);<span class="comment">//调试用</span></span><br><span class="line">                <span class="keyword">var</span> html = <span class="string">&#x27;&lt;div class=&quot;col-md-12&quot;&gt;&#x27;</span></span><br><span class="line">                + <span class="string">&#x27;&lt;div class=&quot;col-md-7 text-row-2&quot;&gt;&lt;a href=&quot;product.html?id=#&#123;id&#125;&quot;&gt;#&#123;title&#125;&lt;/a&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">                + <span class="string">&#x27;&lt;div class=&quot;col-md-2&quot;&gt;¥#&#123;price&#125;&lt;/div&gt;&#x27;</span></span><br><span class="line">                + <span class="string">&#x27;&lt;div class=&quot;col-md-3&quot;&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">                + <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;id&#125;/g</span>, list[i].<span class="property">id</span>);</span><br><span class="line">                html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;title&#125;/g</span>, list[i].<span class="property">title</span>);</span><br><span class="line">                html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;price&#125;/g</span>, list[i].<span class="property">price</span>);</span><br><span class="line">                html = html.<span class="title function_">replace</span>(<span class="regexp">/#&#123;image&#125;/g</span>, list[i].<span class="property">image</span>);</span><br><span class="line"></span><br><span class="line">                $(<span class="string">&quot;#hot-list&quot;</span>).<span class="title function_">append</span>(html);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>关于 image 标签里面的属性 src=“…#{image}collect.png” class=“img-responsive”</p>
<ul>
<li>…代表跳到父文件夹,即 index.html 的父文件夹 static</li>
<li>…后面和 collect 前面不需要单斜杠,因为数据库中图片地址的数据前面后面加的有</li>
</ul>
<p>关于 a 标签里面的 href=“product.html?id=#{id}”</p>
<ul>
<li>这里是为了点击超链接进入商品详情页时可以把商品 id 传给详情页,使两个页面形成联系</li>
</ul>
<h2 id="显示商品详情"><a href="#显示商品详情" class="headerlink" title="显示商品详情"></a>显示商品详情</h2><h3 id="1-显示商品详情-持久层"><a href="#1-显示商品详情-持久层" class="headerlink" title="1.显示商品详情-持久层"></a>1.显示商品详情-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-4"><a href="#1-1-规划需要执行的-SQL-语句-4" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>根据商品 id 显示商品详情的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设计接口和抽象方法-6"><a href="#1-2-设计接口和抽象方法-6" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 ProductMapper 接口中添加抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据商品id查询商品详情</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 匹配的商品详情，如果没有匹配的数据则返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Product <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-6"><a href="#1-3-编写映射-6" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 ProductMapper.xml 文件中配置 findById(Integer id)方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ProductEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_product where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-显示商品详情-业务层"><a href="#2-显示商品详情-业务层" class="headerlink" title="2.显示商品详情-业务层"></a>2.显示商品详情-业务层</h3><h4 id="2-1-规划异常-8"><a href="#2-1-规划异常-8" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><p>如果商品数据不存在，应该抛出 ProductNotFoundException，所以创建 ProductNotFoundException 异常类并使其继承 ServiceException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 商品数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现-8"><a href="#2-2-设计接口和抽象方法及实现-8" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在业务层 IProductService 接口中添加 findById(Integer id)抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据商品id查询商品详情</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 匹配的商品详情，如果没有匹配的数据则返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Product <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在 ProductServiceImpl 类中，实现接口中的 findById(Integer id)抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Product <span class="title function_">findById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.findById(id);</span><br><span class="line">    <span class="comment">// 判断查询结果是否为null</span></span><br><span class="line">    <span class="keyword">if</span> (product == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(<span class="string">&quot;尝试访问的商品数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将查询结果中的部分属性设置为null</span></span><br><span class="line">    product.setPriority(<span class="literal">null</span>);</span><br><span class="line">    product.setCreatedUser(<span class="literal">null</span>);</span><br><span class="line">    product.setCreatedTime(<span class="literal">null</span>);</span><br><span class="line">    product.setModifiedUser(<span class="literal">null</span>);</span><br><span class="line">    product.setModifiedTime(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> product;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-显示商品详情-控制层"><a href="#3-显示商品详情-控制层" class="headerlink" title="3.显示商品详情-控制层"></a>3.显示商品详情-控制层</h3><h4 id="3-1-处理异常-6"><a href="#3-1-处理异常-6" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>在 BaseController 类中的 handleException()方法中添加处理 ProductNotFoundException 的异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ProductNotFoundException) &#123;</span><br><span class="line">	result.setState(<span class="number">4006</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;访问的商品数据不存在的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求-6"><a href="#3-2-设计请求-6" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/products/{id}/details</li>
<li>Integer id</li>
<li>GET</li>
<li>JsonResult<Product></li>
</ul>
<h4 id="3-3-处理请求-6"><a href="#3-3-处理请求-6" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>在 ProductController 类中添加处理请求的 getById()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;/details&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Product&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="type">Product</span> <span class="variable">data</span> <span class="operator">=</span> productService.findById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;Product&gt;(OK, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-显示商品详情-前端页面"><a href="#4-显示商品详情-前端页面" class="headerlink" title="4.显示商品详情-前端页面"></a>4.显示商品详情-前端页面</h3><p>1.首页将商品 id 发送给详情页后,详情页需要从 url 中裁取获得该 id,实现方法在 jquery-getUrlParam.js 中(目前怎么实现裁取可以先不学),所以需要在 product.html 页面中导入该 js 文件,这里我在 body 标签内部的最后引入该 js 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;../js/jquery-getUrlParam.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>2.在 product.html 页面中 body 标签内部的最后添加获取当前商品详情的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">            <span class="comment">//调用jquery-getUrlParam.js文件的getUrlParam方法获取商品id</span></span><br><span class="line">            <span class="keyword">var</span> id = $.<span class="title function_">getUrlParam</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;id=&quot;</span> + id);</span><br><span class="line">            $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&quot;/products/&quot;</span> + id + <span class="string">&quot;/details&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">                    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;title=&quot;</span> + json.<span class="property">data</span>.<span class="property">title</span>);</span><br><span class="line">                            <span class="comment">//html()方法:</span></span><br><span class="line">                            <span class="comment">// 假设有个标签&lt;div id=&quot;a&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">                            <span class="comment">//那么$(&quot;#a&quot;).html(&lt;p&gt;&lt;/p&gt;)就是给该div标签加p标签</span></span><br><span class="line">                            <span class="comment">//$(&quot;#a&quot;).html(&quot;我爱中国&quot;)就是给该div标签填充&quot;我爱中国&quot;内容</span></span><br><span class="line">                            $(<span class="string">&quot;#product-title&quot;</span>).<span class="title function_">html</span>(json.<span class="property">data</span>.<span class="property">title</span>);</span><br><span class="line">                            $(<span class="string">&quot;#product-sell-point&quot;</span>).<span class="title function_">html</span>(json.<span class="property">data</span>.<span class="property">sellPoint</span>);</span><br><span class="line">                            $(<span class="string">&quot;#product-price&quot;</span>).<span class="title function_">html</span>(json.<span class="property">data</span>.<span class="property">price</span>);</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                                $(<span class="string">&quot;#product-image-&quot;</span> + i + <span class="string">&quot;-big&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;..&quot;</span> + json.<span class="property">data</span>.<span class="property">image</span> + i + <span class="string">&quot;_big.png&quot;</span>);</span><br><span class="line">                                $(<span class="string">&quot;#product-image-&quot;</span> + i).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;..&quot;</span> + json.<span class="property">data</span>.<span class="property">image</span> + i + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">4006</span>) &#123; <span class="comment">// 商品数据不存在的异常</span></span><br><span class="line">                            location.<span class="property">href</span> = <span class="string">&quot;index.html&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title function_">alert</span>(<span class="string">&quot;获取商品信息失败！&quot;</span> + json.<span class="property">message</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h2><h3 id="1-创建数据表-4"><a href="#1-创建数据表-4" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.使用 use 命令先选中 store 数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE store;</span><br></pre></td></tr></table></figure>
<p>2.在 store 数据库中创建 t_cart 用户数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_cart (</span><br><span class="line">	cid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;购物车数据id&#x27;</span>,</span><br><span class="line">	uid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">	pid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">	price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;加入时商品单价&#x27;</span>,</span><br><span class="line">	num <span class="type">INT</span> COMMENT <span class="string">&#x27;商品数量&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (cid)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建购物车的实体类"><a href="#2-创建购物车的实体类" class="headerlink" title="2.创建购物车的实体类"></a>2.创建购物车的实体类</h3><p>在 entity 包下创建购物车的 Cart 实体类并使其继承 BaseEntity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**购物车数据的实体类*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cart</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-加入购物车-持久层"><a href="#3-加入购物车-持久层" class="headerlink" title="3.加入购物车-持久层"></a>3.加入购物车-持久层</h3><h4 id="3-1-规划需要执行的-SQL-语句-3"><a href="#3-1-规划需要执行的-SQL-语句-3" class="headerlink" title="3.1 规划需要执行的 SQL 语句"></a>3.1 规划需要执行的 SQL 语句</h4><p>1.向购物车表中插入商品数据的 SQL 语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_cart (除了cid以外的所有字段) values (匹配的值列表);</span><br></pre></td></tr></table></figure>
<p>2.如果当前商品已经在购物车存在,则直接更新商品即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_cart set num=? where cid=?</span><br></pre></td></tr></table></figure>
<p>3.在插入或者更新具体执行哪个语句,取决于数据库中是否有当前的这个购物车商品的数据,需要查询语句才能确定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_cart where uid=? and pid=?</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计接口和抽象方法-3"><a href="#3-2-设计接口和抽象方法-3" class="headerlink" title="3.2 设计接口和抽象方法"></a>3.2 设计接口和抽象方法</h4><p>在 mapper 包下创建 CartMapper 接口，并添加抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CartMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入购物车数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cart 购物车数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insert</span><span class="params">(Cart cart)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改购物车数据中商品的数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cid 购物车数据的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num 新的数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modifiedUser 修改执行人</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modifiedTime 修改时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateNumByCid</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;cid&quot;)</span> Integer cid,</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;num&quot;)</span> Integer num,</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;modifiedUser&quot;)</span> String modifiedUser,</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;modifiedTime&quot;)</span> Date modifiedTime)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id和商品id查询购物车中的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 匹配的购物车数据，如果该用户的购物车中并没有该商品，则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Cart <span class="title function_">findByUidAndPid</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;uid&quot;)</span> Integer uid,</span></span><br><span class="line"><span class="params">            <span class="meta">@Param(&quot;pid&quot;)</span> Integer pid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射-4"><a href="#3-3-编写映射-4" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>在 resources.mapper 文件夹下创建 CartMapper.xml 文件，并在文件中配置以上三个方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.CartMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;CartEntityMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.cy.store.entity.Cart&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;created_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createdTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_user&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedUser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;modified_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;modifiedTime&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入购物车数据--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;cid&quot;</span>&gt;</span></span><br><span class="line">        insert into t_cart (uid, pid, price, num, created_user, created_time, modified_user, modified_time)</span><br><span class="line">        values (#&#123;uid&#125;, #&#123;pid&#125;, #&#123;price&#125;, #&#123;num&#125;, #&#123;createdUser&#125;, #&#123;createdTime&#125;, #&#123;modifiedUser&#125;, #&#123;modifiedTime&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改购物车数据中商品的数量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateNumByCid&quot;</span>&gt;</span></span><br><span class="line">        update t_cart set</span><br><span class="line">            num=#&#123;num&#125;,</span><br><span class="line">            modified_user=#&#123;modifiedUser&#125;,</span><br><span class="line">            modified_time=#&#123;modifiedTime&#125;</span><br><span class="line">        where cid=#&#123;cid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据用户id和商品id查询购物车中的数据--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUidAndPid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CartEntityMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_cart where uid=#&#123;uid&#125; AND pid=#&#123;pid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试-4"><a href="#3-4-单元测试-4" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>创建 CartMapperTests 测试类进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartMapperTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CartMapper cartMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cart</span>();</span><br><span class="line">        cart.setUid(<span class="number">11</span>);</span><br><span class="line">        cart.setPid(<span class="number">10000001</span>);</span><br><span class="line">        cart.setNum(<span class="number">3</span>);</span><br><span class="line">        cart.setPrice(<span class="number">4L</span>);<span class="comment">//长整型</span></span><br><span class="line">        cartMapper.insert(cart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateNumByCid</span><span class="params">()</span> &#123;</span><br><span class="line">        cartMapper.updateNumByCid(<span class="number">1</span>, <span class="number">4</span>, <span class="string">&quot;张三&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByUidAndPid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> cartMapper.findByUidAndPid(<span class="number">11</span>, <span class="number">10000001</span>);</span><br><span class="line">        System.out.println(cart);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-加入购物车-业务层"><a href="#4-加入购物车-业务层" class="headerlink" title="4.加入购物车-业务层"></a>4.加入购物车-业务层</h3><h4 id="4-1-规划异常-4"><a href="#4-1-规划异常-4" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><p>在插入数据时，可能抛出 InsertException 异常；在修改数据时，可能抛出 UpdateException 异常.这两个异常已开发</p>
<h4 id="4-2-设计接口和抽象方法及实现-3"><a href="#4-2-设计接口和抽象方法及实现-3" class="headerlink" title="4.2 设计接口和抽象方法及实现"></a>4.2 设计接口和抽象方法及实现</h4><p>1.在 com.cy.store.service 包下创建 ICartService 接口，并添加抽象方法</p>
<p>该抽象方法都需要哪些参数呢,还是依据持久层,看持久层三条 sql 语句的实现需要什么参数:</p>
<blockquote>
<p>findByUidAndPid:查询购物车数据,参数是 uid,pid</p>
<p>insert:插入购物车数据,参数是 cart 对象(属性有 cid,uid,pid,price,num)</p>
<p>updateNumByCid:修改购物车中商品数量,参数是 cid,num,modifiedUser,modifiedTime</p>
<p>price 可以通过业务层中调用 ProductMapper 接口的 findById 获取,modifiedTime 在业务层实现类的内部创建,所以需要的参数是 uid,pid,num,username</p>
</blockquote>
<p>经过这次分析结合以前给业务层方法声明参数,可以发现<strong>即使持久层的方法参数是实体类对象,业务层的方法参数也大多不是实体类对象,因为实体类的部分属性是可以在业务层进行拼接然后封装到实体类对象中,再传给持久层(比如这里的 price),这样的话就降低了前端传递数据的压力,如果该对象的所有方法都必须由前端传递过来,那么业务层方法参数可以是实体类对象(如注册用户时业务层的方法参数就是 User 对象)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICartService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将商品添加到购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid 当前登录用户的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 商品的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount 增加的数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 当前登录的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addToCart</span><span class="params">(Integer uid, Integer pid, Integer amount, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.创建 CartServiceImpl 类，并实现 ICartService 接口.在类中声明 CartMapper 持久层对象和 IProductService 处理商品数据的业务对象,并实现业务层的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICartService</span> &#123;</span><br><span class="line">    <span class="comment">/**购物车的业务层依赖于购物车的持久层以及商品的持久层*/</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CartMapper cartMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToCart</span><span class="params">(Integer uid, Integer pid, Integer amount, String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据参数pid和uid查询购物车中该商品是否已经存在</span></span><br><span class="line">        <span class="type">Cart</span> <span class="variable">result</span> <span class="operator">=</span> cartMapper.findByUidAndPid(uid, pid);</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">cid</span> <span class="operator">=</span> result.getCid();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cart</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//封装数据：uid,pid,amount</span></span><br><span class="line">            cart.setUid(uid);</span><br><span class="line">            cart.setPid(pid);</span><br><span class="line">            cart.setNum(amount);<span class="comment">//注意前端传来amount时并没有和数据库商品数量进行求和</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//查询商品数据，得到商品价格并封装</span></span><br><span class="line">            <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.findById(pid);</span><br><span class="line">            cart.setPrice(product.getPrice());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//封装数据：4个日志</span></span><br><span class="line">            cart.setCreatedUser(username);</span><br><span class="line">            cart.setCreatedTime(date);</span><br><span class="line">            cart.setModifiedUser(username);</span><br><span class="line">            cart.setModifiedTime(date);</span><br><span class="line"></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> cartMapper.insert(cart);</span><br><span class="line">            <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时出现未知异常&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//从查询结果中取出原数量，与参数amount相加，得到新的数量</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> result.getNum() + amount;<span class="comment">//加入购物车时只会有+不可能有-</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> cartMapper.updateNumByCid(</span><br><span class="line">                result.getCid(),</span><br><span class="line">                num,</span><br><span class="line">                username,</span><br><span class="line">                date);</span><br><span class="line">            <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;更新数据时产生未知异常&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-单元测试-3"><a href="#4-3-单元测试-3" class="headerlink" title="4.3 单元测试"></a>4.3 单元测试</h4><p>创建测试类 CartServiceTests 并编写测试方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToCart</span><span class="params">()</span> &#123;</span><br><span class="line">        cartService.addToCart(<span class="number">11</span>, <span class="number">10000002</span>, <span class="number">5</span>, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-加入购物车-控制层"><a href="#5-加入购物车-控制层" class="headerlink" title="5.加入购物车-控制层"></a>5.加入购物车-控制层</h3><h4 id="5-1-处理异常-2"><a href="#5-1-处理异常-2" class="headerlink" title="5.1 处理异常"></a>5.1 处理异常</h4><p>InsertException 异常和 UpdateException 异常都已经设置到 BaseController 类中了,这里无需重复开发</p>
<h4 id="5-2-设计请求-3"><a href="#5-2-设计请求-3" class="headerlink" title="5.2 设计请求"></a>5.2 设计请求</h4><ul>
<li>/carts/add_to_cart</li>
<li>post</li>
<li>Integer pid, Integer amount, HttpSession session</li>
<li>JsonResult<Void></li>
</ul>
<h4 id="5-3-处理请求-3"><a href="#5-3-处理请求-3" class="headerlink" title="5.3 处理请求"></a>5.3 处理请求</h4><p>在 controller 包下创建 CartController 类并继承 BaseController 类,在类中添加处理请求的 addToCart()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;carts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;add_to_cart&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addToCart</span><span class="params">(Integer pid, Integer amount, HttpSession session)</span> &#123;</span><br><span class="line">        cartService.addToCart(</span><br><span class="line">                getUidFromSession(session),</span><br><span class="line">                pid,</span><br><span class="line">                amount,</span><br><span class="line">                getUsernameFromSession(session));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;Void&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录账号后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/carts/add_to_cart?pid=10000002&amp;amount=5">http://localhost:8080/carts/add_to_cart?pid=10000002&amp;amount=5</a> 进行测试</p>
<h3 id="6-加入购物车-前端页面"><a href="#6-加入购物车-前端页面" class="headerlink" title="6.加入购物车-前端页面"></a>6.加入购物车-前端页面</h3><p>在 product.html 页面中的 body 标签内的 script 标签里为“加入购物车”按钮添加点击事件</p>
<p>回顾一下在 ajax 函数中 data 参数的数据设置的方式</p>
<ul>
<li>data:$(“选择的 form 表单”).serialize()。当需要提交的参数过多并且在同一个表单中时使用</li>
<li>data:new FormData($(“选择的 form 表单”)[0])。只适用提交文件</li>
<li><p>data:“username=TOM”。手动拼接,适合参数值固定并且参数值列表有限.等同于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = <span class="string">&quot;控件某属性值或控件文本内容或自己声明的值&quot;</span>;</span><br><span class="line"><span class="attr">data</span>: <span class="string">&quot;username=&quot;</span> + user;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 JSON 格式提交数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 RestFul 风格不属于前端给后端传参数</p>
</li>
</ul>
<blockquote>
<p>这里表单里面有很多无用参数,所以不使用表单提交</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn-add-to-cart&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/carts/add_to_cart&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">pid</span>: id,</span><br><span class="line">      <span class="attr">amount</span>: $(<span class="string">&quot;#num&quot;</span>).<span class="title function_">val</span>(),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;增加成功！&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;增加失败！&quot;</span> + json.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;您的登录信息已经过期，请重新登录！HTTP响应码：&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">      location.<span class="property">href</span> = <span class="string">&quot;login.html&quot;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>点击”加入购物车”按钮后页面跳转的实现:product.html 导入的 product.js 文件里面实现了点击后跳转</strong></p>
<h2 id="显示购物车列表"><a href="#显示购物车列表" class="headerlink" title="显示购物车列表"></a>显示购物车列表</h2><h3 id="1-显示购物车列表-持久层"><a href="#1-显示购物车列表-持久层" class="headerlink" title="1.显示购物车列表-持久层"></a>1.显示购物车列表-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-5"><a href="#1-1-规划需要执行的-SQL-语句-5" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>这里需要将商品表和购物车表进行连表查询</p>
<p>显示某用户的购物车列表数据的 SQL 语句大致是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">	cid, #日后勾选购物车商品模块需要用到cid来确定勾选的是购物车表的哪一条数据</span><br><span class="line"></span><br><span class="line">	uid, #感觉没必要,因为uid可以从session中拿的呀,难道是为</span><br><span class="line">	#了后面提交购物车订单时判断提交的商品的uid和登录的uid是否一致?</span><br><span class="line"></span><br><span class="line">	pid, #日购提交订单模块需要用到pid来确定购买的是商品表的哪件商</span><br><span class="line">	#品,然后对商品表的该商品的库存,销售热度等信息进行修改</span><br><span class="line"></span><br><span class="line">	t_cart.price, #两个表都有该字段,需要指定获取的是哪个数据表的</span><br><span class="line"></span><br><span class="line">	t_cart.num, #两个表都有该字段且含义不同,需要指定获取的是哪个数据表的</span><br><span class="line"></span><br><span class="line">	title,</span><br><span class="line"></span><br><span class="line">	t_product.price <span class="keyword">as</span> realPrice, #为了在购物车列表页展示两个价格的差值</span><br><span class="line"></span><br><span class="line">	image</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> t_cart</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> t_product <span class="keyword">on</span> t_cart.pid <span class="operator">=</span> t_product.id #把t_cart作为主表(老师说现在处理的是购物车表的数据所以让其为主表,我不明白)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	uid <span class="operator">=</span> #&#123;uid&#125;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">	t_cart.created_time <span class="keyword">desc</span> #进行排序使最新加入购物车的在最上面</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设计接口和抽象方法-7"><a href="#1-2-设计接口和抽象方法-7" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><blockquote>
<p>VO 全称 Value Object,值对象。当进行 select 查询时,查询的结果属于多张表中的内容,此时发现结果集不能直接使用某个 POJO 实体类来接收,因为 POJO 实体类不能包含多表查询出来的信息,解决方式是:重新去构建一个新的对象,这个对象用于存储所查询出来的结果集对应的映射,所以把这个对象称之为值对象.</p>
</blockquote>
<p>在 store 包下创建一个 vo 包,在该包下面创建 CartVO 类,不需要继承 BaseController 类,那相应的就需要单独实现 Serializable 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 购物车数据的Value Object类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Long realPrice;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get,set</span></span><br><span class="line"><span class="comment"> * equals和hashCode</span></span><br><span class="line"><span class="comment"> * toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.在 CartMapper 接口中添加抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询某用户的购物车数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 该用户的购物车数据的列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;CartVO&gt; <span class="title function_">findVOByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-7"><a href="#1-3-编写映射-7" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>1.在 CartMapper.xml 文件中添加 findVOByUid()方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询某用户的购物车数据：List&lt;CartVO&gt; findVOByUid(Integer uid) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findVOByUid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.cy.store.vo.CartVO&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        cid,</span><br><span class="line">        uid,</span><br><span class="line">        pid,</span><br><span class="line">        t_cart.price,</span><br><span class="line">        t_cart.num,</span><br><span class="line">        title,</span><br><span class="line">        t_product.price as realPrice,</span><br><span class="line">        image</span><br><span class="line">    from t_cart</span><br><span class="line">    left join t_product on t_cart.pid = t_product.id</span><br><span class="line">    where</span><br><span class="line">    	uid = #&#123;uid&#125;</span><br><span class="line">    order by</span><br><span class="line">    	t_cart.created_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-6"><a href="#1-4-单元测试-6" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><p>在 CartMapperTests 测试类中添加 findVOByUid()方法的测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findVOByUid</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;CartVO&gt; list = cartMapper.findVOByUid(<span class="number">11</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-显示购物车列表-业务层"><a href="#2-显示购物车列表-业务层" class="headerlink" title="2.显示购物车列表-业务层"></a>2.显示购物车列表-业务层</h3><h4 id="2-1-规划异常-9"><a href="#2-1-规划异常-9" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><p>查询不到就返回空,不需要规划异常</p>
<h4 id="2-2-设计接口和抽象方法及实现-9"><a href="#2-2-设计接口和抽象方法及实现-9" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 ICartService 接口中添加 findVOByUid()抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询某用户的购物车数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 用户id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 该用户的购物车数据的列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;CartVO&gt; <span class="title function_">getVOByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在 CartServiceImpl 类中重写业务接口中的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CartVO&gt; <span class="title function_">getVOByUid</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cartMapper.findVOByUid(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-8"><a href="#2-3-单元测试-8" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>该业务层只是调用了持久层的方法并返回,可以不再测试</p>
<h3 id="3-显示购物车列表-控制层"><a href="#3-显示购物车列表-控制层" class="headerlink" title="3.显示购物车列表-控制层"></a>3.显示购物车列表-控制层</h3><h4 id="3-1-处理异常-7"><a href="#3-1-处理异常-7" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>业务层没有抛出异常,所以这里不需要处理异常</p>
<h4 id="3-2-设计请求-7"><a href="#3-2-设计请求-7" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/carts/</li>
<li>GET</li>
<li>HttpSession session</li>
<li>JsonResult<List<CartVO>&gt;</li>
</ul>
<h4 id="3-3-处理请求-7"><a href="#3-3-处理请求-7" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>在 CartController 类中编写处理请求的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&#123;&quot;&quot;, &quot;/&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;CartVO&gt;&gt; <span class="title function_">getVOByUid</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    List&lt;CartVO&gt; data = cartService.getVOByUid(getUidFromSession(session));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;List&lt;CartVO&gt;&gt;(OK, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/carts">http://localhost:8080/carts</a> 进行测试</p>
<h3 id="4-显示购物车列表-前端页面"><a href="#4-显示购物车列表-前端页面" class="headerlink" title="4.显示购物车列表-前端页面"></a>4.显示购物车列表-前端页面</h3><p>1.将 cart.html 页面的 head 头标签内引入的 cart.js 文件注释掉(这个就是文件的功能:点击”+“,”-“,“删除”,”全选”等按钮时执行相应的操作)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/cart.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> --&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>多说一下,form 标签的 action=”orderConfirm.html”属性(规定表单数据提交到哪里)和结算按钮的类型”type=submit”是必不可少的,这样点击”结算”时才能将数据传给”确认订单页”并在”确认订单页”展示选中的商品数据</p>
<p>当然也可以把这两个删掉,然后给结算按钮添加”type=button”然后给该按钮绑定一个点击事件实现页面跳转和数据传递,但是这样太麻烦了</p>
</blockquote>
<p>2.在 cart.html 页面 body 标签内的 script 标签中编写展示购物车列表的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">showCartList</span>();</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//展示购物车列表数据</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showCartList</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/carts&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> tr = <span class="string">&#x27;&lt;tr&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;input name=&quot;cids&quot; value=&quot;#&#123;cid&#125;&quot; type=&quot;checkbox&quot; class=&quot;ckitem&quot; /&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;#&#123;title&#125;#&#123;msg&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;¥&lt;span id=&quot;goodsPrice#&#123;cid&#125;&quot;&gt;#&#123;singlePrice&#125;&lt;/span&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;input type=&quot;button&quot; value=&quot;-&quot; class=&quot;num-btn&quot; οnclick=&quot;reduceNum(1)&quot; /&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;input id=&quot;goodsCount#&#123;cid&#125;&quot; type=&quot;text&quot; size=&quot;2&quot; readonly=&quot;readonly&quot; class=&quot;num-text&quot; value=&quot;#&#123;num&#125;&quot;&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;input class=&quot;num-btn&quot; type=&quot;button&quot; value=&quot;+&quot; οnclick=&quot;addNum(#&#123;cid&#125;)&quot; /&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;&lt;span id=&quot;goodsCast#&#123;cid&#125;&quot;&gt;#&#123;totalPrice&#125;&lt;/span&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;input type=&quot;button&quot; οnclick=&quot;delCartItem(this)&quot; class=&quot;cart-del btn btn-default btn-xs&quot; value=&quot;删除&quot; /&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                        <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;cid&#125;/g</span>, list[i].<span class="property">cid</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;image&#125;/g</span>, list[i].<span class="property">image</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;title&#125;/g</span>, list[i].<span class="property">title</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;singlePrice&#125;/g</span>, list[i].<span class="property">realPrice</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;num&#125;/g</span>, list[i].<span class="property">num</span>);</span><br><span class="line">                    tr = tr.<span class="title function_">replaceAll</span>(<span class="regexp">/#&#123;totalPrice&#125;/g</span>, list[i].<span class="property">realPrice</span> * list[i].<span class="property">num</span>);</span><br><span class="line">                    <span class="keyword">if</span> (list[i].<span class="property">realPrice</span> &lt; list[i].<span class="property">price</span>) &#123;</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;msg&#125;/g</span>, <span class="string">&quot;比加入时降价&quot;</span> + (list[i].<span class="property">price</span> - list[i].<span class="property">realPrice</span>) + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="regexp">/#&#123;msg&#125;/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">append</span>(tr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;加载购物车列表数据时产生未知的异常&quot;</span>+xhr.<span class="property">status</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>这 tr 变量是怎么声明的呢:</p>
<p><strong>先敲下 var=‘’;然后在上面的 html 里面找到 tbody 下的任意一个 tr 标签复制在单引号里面,然后删掉制表符.最后对该字符串稍加改动:</strong></p>
<blockquote>
<p>1.第 18 行 name=“cids” value=”#{cid}”是为”点击结算按钮跳转到确认订单页面”模块做准备。这两个属性都是自己添加的,在 tbody 复制的 tr 标签里面没有,这两个属性是为了跳转到”确认订单页”时能够携带该参数(比如传递 cids=1)</p>
<p>2.第 26οnclick=”addNum(#{cid})“是为”在购物车列表增加商品数量”模块做准备。是为了点击”+”后能调用 addNum 函数并传入对应的 cid</p>
<p>3.第 22 行 id=”goodsPrice#{cid}”和第 25 行 id=”goodsCount#{cid}”和第 28 行 id=”goodsCast#{cid}”都是为”在购物车列表增加商品数量”模块做准备。在后端更新完商品数量相应的前端页面也要更新:</p>
<ul>
<li>根据 id=”goodsCount#{cid}”获取数量相关的控件后更新其 value 属性的值(value 属性用.val()赋值)</li>
<li>根据 id=”goodsPrice#{cid}”获取价格相关的控件后拿到其单价</li>
<li><p>将单价和数量相乘后,根据 id=”goodsCast#{cid}”获取总价相关的控件并更新其文本值(文本用.html()更新)</p>
<p>4.上面这三条都是和本模块无关的,其余的修改都是和本模块相关的,在 tbody 复制的 tr 标签里面都有,比葫芦画瓢就可以了</p>
</li>
</ul>
</blockquote>
<p><strong>点击”结算”按钮页面跳转的实现:在 cart.html 页面点击”结算”后会跳转到”确认订单页”并将表单中的数据作为参数传递给”确认订单页”</strong></p>
<h2 id="增加商品数量"><a href="#增加商品数量" class="headerlink" title="增加商品数量"></a>增加商品数量</h2><blockquote>
<p>购物车详情页点击”+“”-“修改商品数量时<strong>必须和数据库进行交互</strong>,因为这是即使展示给用户的,不能说用户看到的数量是 5,结果数据库的购物车表中的数量是 4 吧?</p>
<p>但是在商品详情页点击”+“”-“修改商品数量时可以不用和数据库进行交互而是等到用户点击”加入购物车”后再进行交互,因为在用户点击”加入购物车”之前并不需要将商品数量更新到购物车表,可以去看看这个项目的商品详情页,那里点击”+“”-“修改商品数量时就是 js 实现的,并没有和数据库交互.(如果加一个模块:商品详情页点击”+“”-“时要知道库存够不够用户选择的这个数量,此时就需要和数据库交互了)</p>
</blockquote>
<h3 id="1-增加购物车商品数量-持久层"><a href="#1-增加购物车商品数量-持久层" class="headerlink" title="1.增加购物车商品数量-持久层"></a>1.增加购物车商品数量-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-6"><a href="#1-1-规划需要执行的-SQL-语句-6" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><p>1.更新该商品的数量.此 SQL 语句无需重复开发</p>
<p>2.首先进行查询需要操作的购物车数据信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_cart <span class="keyword">WHERE</span> cid<span class="operator">=</span>?</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设计接口和抽象方法-8"><a href="#1-2-设计接口和抽象方法-8" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 CartMapper 接口中添加抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cart <span class="title function_">findByCid</span><span class="params">(Integer cid)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-编写映射-8"><a href="#1-3-编写映射-8" class="headerlink" title="1.3 编写映射"></a>1.3 编写映射</h4><p>在 CartMapper 文件中添加 findByCid(Integer cid)方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CartEntityMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_cart where cid=#&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-单元测试-7"><a href="#1-4-单元测试-7" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><p>在 CartMapperTests 测试类中添加 findByCid()测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByCid</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(cartMapper.findByCid(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-增加购物车商品数量-业务层"><a href="#2-增加购物车商品数量-业务层" class="headerlink" title="2.增加购物车商品数量-业务层"></a>2.增加购物车商品数量-业务层</h3><h4 id="2-1-规划异常-10"><a href="#2-1-规划异常-10" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><ul>
<li>在更新时产生 UpdateException 未知异常,此异常类无需再次创建</li>
<li>可能该购物车列表数据归属不是登录的用户,抛 AccessDeniedException 异常,此异常类无需再次创建</li>
<li>要查询的数据不存在.抛出 CartNotFoundException 异常,创建该异常类并使其继承 ServiceException</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 购物车数据不存在的异常 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;</span><br><span class="line">    <span class="comment">/**重写ServiceException的所有构造方法*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-设计接口和抽象方法及实现-10"><a href="#2-2-设计接口和抽象方法及实现-10" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>在业务层 ICartService 接口中添加 addNum()抽象方法</p>
<p>1.先判断需要哪些参数,该抽象方法的实现依赖于 CartMapper 接口的两个方法:</p>
<blockquote>
<p>updateNumByCid 方法.参数是 cid,num,String modifiedUser,Date modifiedTime</p>
<p>findByCid 方法.参数是 cid</p>
<p>在业务层中从购物车表查询到该商品的数量,然后再和前端传过来的增加的数量进行求和得到 num</p>
<p>所以该方法的参数是 cid,uid,username</p>
</blockquote>
<p>2.判断一下该方法的返回值:</p>
<ul>
<li>该方法返回值 void.这样的话就需要在前端页面加 location.href 使该页面自己跳转到自己,实现刷新页面(不建议,每次都加载整个页面,数据量太大了)</li>
<li>返回值是 Integer 类型.这样的话就把数据库中更新后的数量层层传给前端,前端接收后填充到控件中就可以了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 增加用户的购物车中某商品的数量</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 增加成功后新的数量</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Integer <span class="title function_">addNum</span><span class="params">(Integer cid,Integer uid, String username)</span>;</span><br></pre></td></tr></table></figure>
<p>3.在 CartServiceImpl 类中实现接口中的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">addNum</span><span class="params">(Integer cid, Integer uid, String username)</span> &#123;</span><br><span class="line">    <span class="type">Cart</span> <span class="variable">result</span> <span class="operator">=</span> cartMapper.findByCid(cid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CartNotFoundException</span>(<span class="string">&quot;数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!result.getUid().equals(uid)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;数据非法访问&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> result.getNum() + <span class="number">1</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> cartMapper.updateNumByCid(cid, num, username, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;更新数据时产生未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-9"><a href="#2-3-单元测试-9" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>就接收个参数,然后业务层将其加一后返回,不需要再测了</p>
<h3 id="3-增加购物车商品数量-控制层"><a href="#3-增加购物车商品数量-控制层" class="headerlink" title="3.增加购物车商品数量-控制层"></a>3.增加购物车商品数量-控制层</h3><h4 id="3-1-处理异常-8"><a href="#3-1-处理异常-8" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>在 BaseController 类中添加 CartNotFoundException 异常类的统一管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> CartNotFoundException) &#123;</span><br><span class="line">    result.setState(<span class="number">4007</span>);</span><br><span class="line">    result.setMessage(<span class="string">&quot;购物车表不存在该商品的异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-设计请求-8"><a href="#3-2-设计请求-8" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/carts/{cid}/num/add</li>
<li>post</li>
<li>@PathVariable(“cid”) Integer cid, HttpSession session</li>
<li>JsonResult<Integer></li>
</ul>
<h4 id="3-3-处理请求-8"><a href="#3-3-处理请求-8" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>在 CartController 类中添加处理请求的 addNum()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;&#123;cid&#125;/num/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">addNum</span><span class="params">(<span class="meta">@PathVariable(&quot;cid&quot;)</span> Integer cid, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">data</span> <span class="operator">=</span> cartService.addNum(</span><br><span class="line">        cid,</span><br><span class="line">        getUidFromSession(session),</span><br><span class="line">        getUsernameFromSession(session));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;Integer&gt;(OK, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/carts/1/num/add">http://localhost:8080/carts/1/num/add</a> 进行验证</p>
<h3 id="4-增加购物车商品数量-前端页面"><a href="#4-增加购物车商品数量-前端页面" class="headerlink" title="4.增加购物车商品数量-前端页面"></a>4.增加购物车商品数量-前端页面</h3><p>1.首先确定在 showCartList()函数中动态拼接的增加购物车按钮是绑定了 addNum()事件，如果已经添加无需重复添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="keyword">class</span>=<span class="string">&quot;num-btn&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;+&quot;</span> onclick=<span class="string">&quot;addNum(#&#123;cid&#125;)&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>2.在 script 标签中定义 addNum()函数并编写增加购物车数量的逻辑代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addNum</span>(<span class="params">cid</span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/carts/&quot;</span> + cid + <span class="string">&quot;/num/add&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#goodsCount&quot;</span> + cid).<span class="title function_">val</span>(json.<span class="property">data</span>); <span class="comment">//字符串+整数cid后结果为字符串</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新该商品总价</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                            html()方法:</span></span><br><span class="line"><span class="comment">                            不传参:是获取某个标签内部的内容(文本或标签)</span></span><br><span class="line"><span class="comment">                            传参:将参数放到标签里面替换掉该标签原有内容</span></span><br><span class="line"><span class="comment">                            * */</span></span><br><span class="line">        <span class="keyword">var</span> price = $(<span class="string">&quot;#goodsPrice&quot;</span> + cid).<span class="title function_">html</span>();</span><br><span class="line">        <span class="keyword">var</span> totalPrice = price * json.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将商品总价更新到控件中</span></span><br><span class="line">        $(<span class="string">&quot;#goodsCast&quot;</span> + cid).<span class="title function_">html</span>(totalPrice);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;增加购物车商品数量失败&quot;</span> + json.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;增加购物车商品数量时产生未知的异常!&quot;</span> + xhr.<span class="property">message</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="确认订单"><a href="#确认订单" class="headerlink" title="确认订单"></a>确认订单</h2><h3 id="1-确认订单-持久层"><a href="#1-确认订单-持久层" class="headerlink" title="1.确认订单-持久层"></a>1.确认订单-持久层</h3><h4 id="1-1-规划需要执行的-SQL-语句-7"><a href="#1-1-规划需要执行的-SQL-语句-7" class="headerlink" title="1.1 规划需要执行的 SQL 语句"></a>1.1 规划需要执行的 SQL 语句</h4><blockquote>
<p>用户在购物车列表页中通过随机勾选相关的商品,在点击”结算”按钮后跳转到”确认订单页”,在这个页面中需要展示用户在上个页面所勾选的”购物车列表页”中对应的数据.说白了也就是列表展示,且展示的内容还是来自于购物车表.但是用户勾选了哪些商品呢,所以”购物车列表页”需要将用户勾选的商品 id 传递给”确认订单页”</p>
</blockquote>
<p>所以在持久层需要完成“根据若干个不确定的 id 值，查询购物车数据表，显示购物车中的数据信息”。则需要执行的 SQL 语句大致是。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    cid,</span><br><span class="line">    uid,</span><br><span class="line">    pid,</span><br><span class="line">    t_cart.price,</span><br><span class="line">    t_cart.num,</span><br><span class="line">    title,</span><br><span class="line">    t_product.price <span class="keyword">as</span> realPrice,</span><br><span class="line">    image</span><br><span class="line"><span class="keyword">from</span> t_cart</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> t_product <span class="keyword">on</span> t_cart.pid <span class="operator">=</span> t_product.id</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	cid <span class="keyword">in</span> (?,?,?)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">	t_cart.created_time <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>
<p>注意 where cid in (?,?,?),这里是需要传入 cid 的集合</p>
<h4 id="1-2-设计接口和抽象方法-9"><a href="#1-2-设计接口和抽象方法-9" class="headerlink" title="1.2 设计接口和抽象方法"></a>1.2 设计接口和抽象方法</h4><p>在 CartMapper 接口中添加 findVOByCids 抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CartVO&gt; <span class="title function_">findVOByCids</span><span class="params">(Integer[] cids)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-配置映射"><a href="#1-3-配置映射" class="headerlink" title="1.3 配置映射"></a>1.3 配置映射</h4><p>1.在 CartMapper.xml 文件中添加 SQL 语句的映射配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findVOByCids&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.cy.store.vo.CartVO&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        cid,</span><br><span class="line">        uid,</span><br><span class="line">        pid,</span><br><span class="line">        t_cart.price,</span><br><span class="line">        t_cart.num,</span><br><span class="line">        title,</span><br><span class="line">        t_product.price as realPrice,</span><br><span class="line">        image</span><br><span class="line">    from t_cart</span><br><span class="line">    left join t_product on t_cart.pid = t_product.id</span><br><span class="line">    where</span><br><span class="line">        cid in (</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">item</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                #&#123;cid&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">            )</span><br><span class="line">    order by</span><br><span class="line">    	t_cart.created_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>foreach 循环就是一个 for 循环</p>
<ul>
<li>collection 标识循环的是 list 集合还是数组,如果是 list 集合就用 collection=“list”</li>
<li>item 用来接收每次循环获取的值</li>
<li>separator 标识循环出来的值中间用什么隔开,且最后循环出来的值后面不加</li>
</ul>
</blockquote>
<h4 id="1-4-单元测试-8"><a href="#1-4-单元测试-8" class="headerlink" title="1.4 单元测试"></a>1.4 单元测试</h4><p>在 CartMapperTests 测试类中添加 findVOByCids 方法进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findVOByCids</span><span class="params">()</span> &#123;</span><br><span class="line">    Integer[] cids = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">100</span>&#125;;<span class="comment">//可以写表中不存在的,无非就是查不到数据,并不会报错</span></span><br><span class="line">    List&lt;CartVO&gt; list = cartMapper.findVOByCids(cids);</span><br><span class="line">    <span class="keyword">for</span> (CartVO item : list) &#123;</span><br><span class="line">        System.out.println(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-确认订单-业务层"><a href="#2-确认订单-业务层" class="headerlink" title="2.确认订单-业务层"></a>2.确认订单-业务层</h3><h4 id="2-1-规划异常-11"><a href="#2-1-规划异常-11" class="headerlink" title="2.1 规划异常"></a>2.1 规划异常</h4><p>查询语句,没有需要规划的异常,在业务层判断这几条购物车商品的数据归属是否正确,如果不正确也不需要抛出异常,直接从查询到的数据中移除该商品就行了</p>
<h4 id="2-2-设计接口和抽象方法及实现-11"><a href="#2-2-设计接口和抽象方法及实现-11" class="headerlink" title="2.2 设计接口和抽象方法及实现"></a>2.2 设计接口和抽象方法及实现</h4><p>1.在 ICartService 接口中添加 getVOByCids()抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CartVO&gt; <span class="title function_">getVOByCids</span><span class="params">(Integer uid, Integer[] cids)</span>;<span class="comment">//uid是为了判断数据归属是否正确</span></span><br></pre></td></tr></table></figure>
<p>2.在 CartServiceImpl 类中重写业务接口中的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CartVO&gt; <span class="title function_">getVOByCids</span><span class="params">(Integer uid, Integer[] cids)</span> &#123;</span><br><span class="line">    List&lt;CartVO&gt; list = cartMapper.findVOByCids(cids);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以使用for遍历,这里玩个新的,用迭代器遍历</span></span><br><span class="line">    Iterator&lt;CartVO&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//指向的是该元素之前,所以需要next得到该元素</span></span><br><span class="line">        <span class="type">CartVO</span> <span class="variable">cart</span> <span class="operator">=</span> it.next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!cart.getUid().equals(uid)) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 不能用list.remove(cart)</span></span><br><span class="line"><span class="comment">             * 在迭代器进行遍历的时候不能使用集合的移除</span></span><br><span class="line"><span class="comment">             * 方法,需要用迭代器特有的移除方法</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            it.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-单元测试-10"><a href="#2-3-单元测试-10" class="headerlink" title="2.3 单元测试"></a>2.3 单元测试</h4><p>业务层只是调用持久层获取数据并判断归属是否正确,这里不再测试</p>
<h3 id="3-确认订单-控制层"><a href="#3-确认订单-控制层" class="headerlink" title="3.确认订单-控制层"></a>3.确认订单-控制层</h3><h4 id="3-1-处理异常-9"><a href="#3-1-处理异常-9" class="headerlink" title="3.1 处理异常"></a>3.1 处理异常</h4><p>业务层没有抛出异常,所以不需要处理异常</p>
<h4 id="3-2-设计请求-9"><a href="#3-2-设计请求-9" class="headerlink" title="3.2 设计请求"></a>3.2 设计请求</h4><ul>
<li>/carts/list</li>
<li>GET</li>
<li>Integer[] cids, HttpSession session</li>
<li>JsonResult<List<CartVO>&gt;</li>
</ul>
<h4 id="3-3-处理请求-9"><a href="#3-3-处理请求-9" class="headerlink" title="3.3 处理请求"></a>3.3 处理请求</h4><p>1.在 CartController 类中添加处理请求的 getVOByCids()方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;CartVO&gt;&gt; <span class="title function_">findVOByCids</span><span class="params">(Integer[] cids, HttpSession session)</span> &#123;</span><br><span class="line">    List&lt;CartVO&gt; data = cartService.getVOByCids(getUidFromSession(session), cids);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务,登录后在地址栏输入 <a target="_blank" rel="noopener" href="http://localhost:8080/carts/list?cids=1&amp;cids=5&amp;cids=7">http://localhost:8080/carts/list?cids=1&amp;cids=5&amp;cids=7</a> 进行测试</p>
<h3 id="4-确认订单-前端页面"><a href="#4-确认订单-前端页面" class="headerlink" title="4.确认订单-前端页面"></a>4.确认订单-前端页面</h3><h4 id="4-1-显示勾选的购物车数据"><a href="#4-1-显示勾选的购物车数据" class="headerlink" title="4.1 显示勾选的购物车数据"></a>4.1 显示勾选的购物车数据</h4><p>1.检查 cart.html 页面,里面 form 标签的 action=”orderConfirm.html”属性(规定表单数据提交到哪里)和结算按钮的类型”type=submit”是必不可少的,这样点击”结算”时才能将数据传给”确认订单页”并在”确认订单页”展示选中的商品数据</p>
<p>2.在 orderConfirm.html 页面中实现自动加载从 cart.html 页面中传递过来的 cids 数据,再去请求 ajax,然后将后端返回的数据填充在页面的某个区域中</p>
<p>3.orderConfirm.js 文件中</p>
<ul>
<li>$(“.link-pay”).click(……)作用:点击”在线支付”后跳转到支付页面,这个其实就是下个模块要做的”创建订单”功能,该功能需要和数据库交互,所以不是在前端实现的,所以这行代码无用</li>
<li><p>$(“.link-success”).click(…):在 orderConfirm.html 页面没有 class 为 link-success 的标签,所以这行代码不会被执行</p>
<p>综上两条,orderConfirm.js 文件在 orderConfirm.html 页面中无用,但存在可能会和下个模块”创建订单”功能冲突(下个模块会实现点击”创建订单”后页面跳转),所以注释掉</p>
</li>
</ul>
<hr>
<p>下面在 orderConfirm.html 页面编写 js 代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">showCartList</span>();</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showCartList</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/carts/list&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: location.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>));<span class="comment">//调试用</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//声明两个变量用于更新&quot;确认订单&quot;页的总件数和总价</span></span><br><span class="line">                    <span class="keyword">var</span> allCount = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">var</span> allPrice = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                        <span class="keyword">var</span> tr = <span class="string">&#x27;&lt;tr&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;td&gt;&lt;img src=&quot;..#&#123;image&#125;collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;td&gt;#&#123;title&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;td&gt;¥&lt;span&gt;#&#123;price&#125;&lt;/span&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;td&gt;#&#123;num&#125;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;td&gt;&lt;span&gt;#&#123;totalPrice&#125;&lt;/span&gt;&lt;/td&gt;\n&#x27;</span> +</span><br><span class="line">                            <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;image&#125;&quot;</span>,list[i].<span class="property">image</span>);</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;title&#125;&quot;</span>,list[i].<span class="property">title</span>);</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;price&#125;&quot;</span>,list[i].<span class="property">realPrice</span>);</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;num&#125;&quot;</span>,list[i].<span class="property">num</span>);</span><br><span class="line">                        tr = tr.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;totalPrice&#125;&quot;</span>,list[i].<span class="property">realPrice</span>*list[i].<span class="property">num</span>);</span><br><span class="line">                        $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">append</span>(tr);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//更新&quot;确认订单&quot;页的总件数和总价</span></span><br><span class="line">                        allCount += list[i].<span class="property">num</span>;</span><br><span class="line">                        allPrice += list[i].<span class="property">realPrice</span>*list[i].<span class="property">num</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $(<span class="string">&quot;#all-count&quot;</span>).<span class="title function_">html</span>(allCount);</span><br><span class="line">                    $(<span class="string">&quot;#all-price&quot;</span>).<span class="title function_">html</span>(allPrice);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;在确认订单页加载勾选的购物车数据时发生未知的异常&quot;</span>+xhr.<span class="property">status</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.为什么点击购物车列表页面的”结算”按钮后地址栏中会请求 <a target="_blank" rel="noopener" href="http://localhost:8080/web/orderConfirm.html?cids=6&amp;cids=5">http://localhost:8080/web/orderConfirm.html?cids=6&amp;cids=5</a> 呢,因为该按钮有一个 type=submit 属性,且表单有一个 action=”orderConfirm.html”属性,所以点击该按钮后会携带表单中参数自动跳转</p>
<p>会携带哪些参数呢:把表单中有 name 属性的标签的 value 值传递出去,针对这个请求传递的是 name”cids”,其 value 值根据勾选的商品而定,可以是 1 或 3 或 10</p>
<p>2.<strong>data: location.search.substr(1)这个 API 的参数为 0 表示截取地址栏中?后面的数据,即参数</strong></p>
<p><strong>如果这个 API 的参数为 0 则表示截取地址栏中?前面的数据,即请求地址</strong></p>
</blockquote>
<h4 id="4-2-显示选择收货地址"><a href="#4-2-显示选择收货地址" class="headerlink" title="4.2 显示选择收货地址"></a>4.2 显示选择收货地址</h4><p>收货地址存放在前端的一个 select 下拉列表中,我们需要将查询到的当前登录用户的收货地址动态的加载到这个下拉列表中.从数据库的角度看,是一个 select 查询语句,在”收货地址列表展示”模块已经编写了该持久层,业务层,控制层,所以这里只需要编写对应的前端页面就可以了</p>
<p>1.在 orderConfirm.html 页面中的 ready 函数中添加 showAddressList 方法的调用,使确认订单页加载时能够自动从后端获取该用户地址填充到 select 控件中并将第一个地址显示出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">showCartList</span>();</span><br><span class="line">  <span class="title function_">showAddressList</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2.在 orderConfirm.html 页面中编写 showAddressList 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showAddressList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/addresses&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> list = json.<span class="property">data</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">                                value=&quot;#&#123;aid&#125;&quot;在该模块没有用,但是扔写上,只要是从数据库查到到的数据,都要让前端页</span></span><br><span class="line"><span class="comment">                                面的该条数据和id绑定(因为可能干别的什么时需要用到,就比如说下一个&quot;创建订单&quot;模块</span></span><br><span class="line"><span class="comment">                                就需要根据前端传给后端的aid查询用户选中的是哪一个地址然后将其加入订单表)</span></span><br><span class="line"><span class="comment">                     * */</span></span><br><span class="line">          <span class="keyword">var</span> opt =</span><br><span class="line">            <span class="string">&#x27;&lt;option value=&quot;#&#123;aid&#125;&quot;&gt;#&#123;name&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&#123;tag&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&#123;provinceName&#125;#&#123;cityName&#125;#&#123;areaName&#125;#&#123;address&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&#123;tel&#125;&lt;/option&gt;&#x27;</span>;</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;aid&#125;&quot;</span>, list[i].<span class="property">aid</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;name&#125;&quot;</span>, list[i].<span class="property">name</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;tag&#125;&quot;</span>, list[i].<span class="property">tag</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;provinceName&#125;&quot;</span>, list[i].<span class="property">provinceName</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;cityName&#125;&quot;</span>, list[i].<span class="property">cityName</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;areaName&#125;&quot;</span>, list[i].<span class="property">areaName</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;address&#125;&quot;</span>, list[i].<span class="property">address</span>);</span><br><span class="line">          opt = opt.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;tel&#125;&quot;</span>, list[i].<span class="property">tel</span>);</span><br><span class="line"></span><br><span class="line">          $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">append</span>(opt);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;在确认订单页加载用户地址时发生未知的异常&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建订单"><a href="#创建订单" class="headerlink" title="创建订单"></a>创建订单</h2><h3 id="1-创建数据表-5"><a href="#1-创建数据表-5" class="headerlink" title="1.创建数据表"></a>1.创建数据表</h3><p>1.使用 use 命令先选中 store 数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE store;</span><br></pre></td></tr></table></figure>
<p>2.在 store 数据库中创建 t_order 和 t_order_item 数据表</p>
<blockquote>
<p>针对该模块可以将 t_order_item 表和 t_order 表合并,但是以后可能开发某个模块可能单独用到 t_order_item(比如用户查看订单时只需要 t_order_item 表就可以实现)所以,建议这两个表分开创建</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">	oid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">	uid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">	recv_name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">	recv_phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;收货人电话&#x27;</span>,</span><br><span class="line">	recv_province <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在省&#x27;</span>,</span><br><span class="line">	recv_city <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在市&#x27;</span>,</span><br><span class="line">	recv_area <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在区&#x27;</span>,</span><br><span class="line">	recv_address <span class="type">VARCHAR</span>(<span class="number">50</span>) COMMENT <span class="string">&#x27;收货详细地址&#x27;</span>,</span><br><span class="line">	total_price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;总价&#x27;</span>,</span><br><span class="line">	status <span class="type">INT</span> COMMENT <span class="string">&#x27;状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成&#x27;</span>,</span><br><span class="line">	order_time DATETIME COMMENT <span class="string">&#x27;下单时间&#x27;</span>,</span><br><span class="line">	pay_time DATETIME COMMENT <span class="string">&#x27;支付时间&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (oid)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order_item (</span><br><span class="line">	id <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单中的商品记录的id&#x27;</span>,</span><br><span class="line">	oid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所归属的订单的id&#x27;</span>,</span><br><span class="line">	pid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品的id&#x27;</span>,</span><br><span class="line">	title <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">	image <span class="type">VARCHAR</span>(<span class="number">500</span>) COMMENT <span class="string">&#x27;商品图片&#x27;</span>,</span><br><span class="line">	price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;商品价格&#x27;</span>,</span><br><span class="line">	num <span class="type">INT</span> COMMENT <span class="string">&#x27;购买数量&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建用户的实体类-1"><a href="#2-创建用户的实体类-1" class="headerlink" title="2.创建用户的实体类"></a>2.创建用户的实体类</h3><p>1.entity 包下创建 Order 实体类并继承 BaseEntity 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 订单数据的实体类 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String recvName;</span><br><span class="line">    <span class="keyword">private</span> String recvPhone;</span><br><span class="line">    <span class="keyword">private</span> String recvProvince;</span><br><span class="line">    <span class="keyword">private</span> String recvCity;</span><br><span class="line">    <span class="keyword">private</span> String recvArea;</span><br><span class="line">    <span class="keyword">private</span> String recvAddress;</span><br><span class="line">    <span class="keyword">private</span> Long totalPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> Date orderTime;</span><br><span class="line">    <span class="keyword">private</span> Date payTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get,set</span></span><br><span class="line"><span class="comment">     * equals和hashCode</span></span><br><span class="line"><span class="comment">     * toString</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.在 com.cy.store.entity 包下创建 OrderItem 实体类并继承 BaseEntity 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 订单中的商品数据 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get,set</span></span><br><span class="line"><span class="comment">     * equals和hashCode</span></span><br><span class="line"><span class="comment">     * toString</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-创建订单-持久层"><a href="#3-创建订单-持久层" class="headerlink" title="3.创建订单-持久层"></a>3.创建订单-持久层</h3><h4 id="3-1-规划需要执行的-SQL-语句-4"><a href="#3-1-规划需要执行的-SQL-语句-4" class="headerlink" title="3.1 规划需要执行的 SQL 语句"></a>3.1 规划需要执行的 SQL 语句</h4><p>1.插入订单数据的 SQL 语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inert into t_order (aid除外的所有字段) values (字段的值)</span><br></pre></td></tr></table></figure>
<p>2.插入某一个订单中商品数据的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inert <span class="keyword">into</span> t_order (id除外的所有字段) <span class="keyword">values</span> (字段的值)</span><br></pre></td></tr></table></figure>
<h4 id="3-2-实现接口和抽象方法"><a href="#3-2-实现接口和抽象方法" class="headerlink" title="3.2 实现接口和抽象方法"></a>3.2 实现接口和抽象方法</h4><p>在 mapper 包下创建 OrderMapper 接口并在接口中添加抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入订单数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> order 订单数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insertOrder</span><span class="params">(Order order)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入某一个订单中商品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderItem 订单中商品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insertOrderItem</span><span class="params">(OrderItem orderItem)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-编写映射-5"><a href="#3-3-编写映射-5" class="headerlink" title="3.3 编写映射"></a>3.3 编写映射</h4><p>创建 OrderMapper.xml 文件,并添加抽象方法的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cy.store.mapper.OrderMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入订单数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrder&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;oid&quot;</span>&gt;</span></span><br><span class="line">        insert into t_order (</span><br><span class="line">        uid, recv_name, recv_phone, recv_province, recv_city, recv_area, recv_address,</span><br><span class="line">        total_price,status, order_time, pay_time, created_user, created_time, modified_user,</span><br><span class="line">        modified_time</span><br><span class="line">        ) values (</span><br><span class="line">        #&#123;uid&#125;, #&#123;recvName&#125;, #&#123;recvPhone&#125;, #&#123;recvProvince&#125;, #&#123;recvCity&#125;, #&#123;recvArea&#125;,</span><br><span class="line">        #&#123;recvAddress&#125;, #&#123;totalPrice&#125;, #&#123;status&#125;, #&#123;orderTime&#125;, #&#123;payTime&#125;, #&#123;createdUser&#125;,</span><br><span class="line">        #&#123;createdTime&#125;, #&#123;modifiedUser&#125;, #&#123;modifiedTime&#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入订单商品数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrderItem&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into t_order_item (</span><br><span class="line">        oid, pid, title, image, price, num, created_user,</span><br><span class="line">        created_time, modified_user, modified_time</span><br><span class="line">        ) values (</span><br><span class="line">        #&#123;oid&#125;, #&#123;pid&#125;, #&#123;title&#125;, #&#123;image&#125;, #&#123;price&#125;, #&#123;num&#125;, #&#123;createdUser&#125;,</span><br><span class="line">        #&#123;createdTime&#125;, #&#123;modifiedUser&#125;, #&#123;modifiedTime&#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-单元测试-5"><a href="#3-4-单元测试-5" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><p>创建 OrderMapperTests 测试类并添加测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMapperTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUid(<span class="number">31</span>);</span><br><span class="line">        order.setRecvName(<span class="string">&quot;小王&quot;</span>);</span><br><span class="line">        order.setRecvPhone(<span class="string">&quot;133333&quot;</span>);</span><br><span class="line">        orderMapper.insertOrder(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertOrderItem</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">        orderItem.setOid(<span class="number">1</span>);</span><br><span class="line">        orderItem.setPid(<span class="number">10000001</span>);</span><br><span class="line">        orderItem.setTitle(<span class="string">&quot;高档铅笔&quot;</span>);</span><br><span class="line">        orderMapper.insertOrderItem(orderItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-创建订单-业务层"><a href="#4-创建订单-业务层" class="headerlink" title="4.创建订单-业务层"></a>4.创建订单-业务层</h3><h4 id="4-1-规划异常-5"><a href="#4-1-规划异常-5" class="headerlink" title="4.1 规划异常"></a>4.1 规划异常</h4><p>无异常</p>
<h4 id="4-2-实现接口和抽象方法及实现"><a href="#4-2-实现接口和抽象方法及实现" class="headerlink" title="4.2 实现接口和抽象方法及实现"></a>4.2 实现接口和抽象方法及实现</h4><blockquote>
<p>查看订单表的字段从而分析业务层方法需要哪些参数:</p>
<p>oid:主键自增,所以不需要该参数</p>
<p>uid:由控制层获取 session 中 uid 传给业务层,所以需要该参数<br>recv_name:通过”确认订单页”传递选中的地址 aid,根据 aid 在在业务层调用已经声明的 findByAid 方法(该方法是在做”设置默认地址”模块时创建的,只在持久层创建了,并没有在业务层继续实现),所以需要参数 aid<br>recv_phone:同上<br>recv_province:同上<br>recv_city:同上<br>recv_area:同上<br>recv_address:同上<br>total_price:根据前端传来的 cids 查询出每类商品数量和单价,然后相乘后求和,所以需要参数 Integer[] cids<br>status:默认是 0,所以不需要该参数<br>order_time:业务层实现方法内部可以声明,所以不需要该参数<br>pay_time:”创建订单”模块不需要此参数<br>created_user:由控制层获取 session 中 username 传给业务层,所以需要该参数<br>created_time:业务层实现方法内部可以声明,所以不需要该参数<br>modified_user:由控制层获取 session 中 username 传给业务层,所以需要该参数<br>modified_time:业务层实现方法内部可以声明,所以不需要该参数</p>
</blockquote>
<p>综上分析,需要的参数是 uid 和 aid,且需要在 IAddressService 接口添加 getByAid()方法来获取选中的收货地址的详细数据:</p>
<p>1.在 IAddressService 接口中添加 getByAid()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Address <span class="title function_">getByAid</span><span class="params">(Integer aid, Integer uid)</span>;</span><br></pre></td></tr></table></figure>
<p>2.在 AddressServiceImpl 类中实现接口中的 getByAid()抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Address <span class="title function_">getByAid</span><span class="params">(Integer aid, Integer uid)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressMapper.findByAid(aid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (address == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotFoundException</span>(<span class="string">&quot;收货地址数据不存在的异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!address.getUid().equals(uid)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;非法访问&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    address.setProvinceCode(<span class="literal">null</span>);</span><br><span class="line">    address.setCityCode(<span class="literal">null</span>);</span><br><span class="line">    address.setAreaCode(<span class="literal">null</span>);</span><br><span class="line">    address.setCreatedUser(<span class="literal">null</span>);</span><br><span class="line">    address.setCreatedTime(<span class="literal">null</span>);</span><br><span class="line">    address.setModifiedUser(<span class="literal">null</span>);</span><br><span class="line">    address.setModifiedTime(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.在 service 包下创建 IOrderService 业务层接口并添加抽象方法用于创建订单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOrderService</span> &#123;</span><br><span class="line">    Order <span class="title function_">create</span><span class="params">(Integer aid, Integer[] cids, Integer uid, String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>返回值是 Order 是因为还要在下个页面展示订单详细信息</strong></p>
<p>4.在 impl 包下创建 OrderServiceImpl 并编写代码实现订单和订单中所有商品数据的插入操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要调用业务层的getByAid方法</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAddressService addressService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要调用业务层的getVOByCids方法</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要调用业务层的getByUid方法</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">create</span><span class="params">(Integer aid, Integer[] cids, Integer uid, String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回的列表中的对象都是即将下单的</span></span><br><span class="line">        List&lt;CartVO&gt; list = cartService.getVOByCids(uid, cids);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">totalPrice</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">for</span> (CartVO cartVO : list) &#123;</span><br><span class="line">            totalPrice += cartVO.getRealPrice()*cartVO.getNum();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.getByAid(aid, uid);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUid(uid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装收货地址</span></span><br><span class="line">        order.setRecvName(address.getName());</span><br><span class="line">        order.setRecvPhone(address.getPhone());</span><br><span class="line">        order.setRecvProvince(address.getProvinceName());</span><br><span class="line">        order.setRecvCity(address.getCityName());</span><br><span class="line">        order.setRecvArea(address.getAreaName());</span><br><span class="line">        order.setRecvAddress(address.getAddress());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装创建时间,支付状态和总价</span></span><br><span class="line">        order.setOrderTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line">        order.setTotalPrice(totalPrice);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装四个日志</span></span><br><span class="line">        order.setCreatedUser(username);</span><br><span class="line">        order.setCreatedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        order.setModifiedUser(username);</span><br><span class="line">        order.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rows</span> <span class="operator">=</span> orderMapper.insertOrder(order);</span><br><span class="line">        <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时产生未知的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入数据——将某条订单的所有商品的详细数据插入</span></span><br><span class="line">        <span class="keyword">for</span> (CartVO cartVO : list) &#123;</span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 此时获取的oid不为空,因为在配置文件里面开启了oid主</span></span><br><span class="line"><span class="comment">             * 键自增,所以上面的代码执行插入时就自动将oid赋值了</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            orderItem.setOid(order.getOid());</span><br><span class="line"></span><br><span class="line">            orderItem.setPid(cartVO.getPid());</span><br><span class="line">            orderItem.setTitle(cartVO.getTitle());</span><br><span class="line">            orderItem.setImage(cartVO.getImage());</span><br><span class="line">            orderItem.setPrice(cartVO.getRealPrice());</span><br><span class="line">            orderItem.setNum(cartVO.getNum());</span><br><span class="line"></span><br><span class="line">            orderItem.setCreatedUser(username);</span><br><span class="line">            orderItem.setCreatedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            orderItem.setModifiedUser(username);</span><br><span class="line">            orderItem.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">            rows = orderMapper.insertOrderItem(orderItem);</span><br><span class="line">            <span class="keyword">if</span> (rows != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;插入数据时产生未知的异常&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-单元测试-4"><a href="#4-3-单元测试-4" class="headerlink" title="4.3 单元测试"></a>4.3 单元测试</h4><p>创建 OrderServiceTests 测试类并添加 create()方法进行功能测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">        Integer[] cids = &#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>&#125;;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.create(<span class="number">13</span>, cids, <span class="number">11</span>, <span class="string">&quot;小红&quot;</span>);</span><br><span class="line">        System.out.println(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-创建订单-控制层"><a href="#5-创建订单-控制层" class="headerlink" title="5.创建订单-控制层"></a>5.创建订单-控制层</h3><h4 id="5-1-处理异常-3"><a href="#5-1-处理异常-3" class="headerlink" title="5.1 处理异常"></a>5.1 处理异常</h4><p>没有异常需要处理</p>
<h4 id="5-2-设计请求-4"><a href="#5-2-设计请求-4" class="headerlink" title="5.2 设计请求"></a>5.2 设计请求</h4><ul>
<li>/orders/create</li>
<li>GET</li>
<li>Integer aid, Integer[] cids, HttpSession session</li>
<li>JsonResult<Order></li>
</ul>
<h4 id="5-3-处理请求-4"><a href="#5-3-处理请求-4" class="headerlink" title="5.3 处理请求"></a>5.3 处理请求</h4><p>controller 包下创建 OrderController 类，并继承自 BaseController 类,在类中编写请求方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Order&gt; <span class="title function_">create</span><span class="params">(Integer aid, Integer[] cids, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">data</span> <span class="operator">=</span> orderService.create(</span><br><span class="line">                aid,</span><br><span class="line">                cids,</span><br><span class="line">                getUidFromSession(session),</span><br><span class="line">                getUsernameFromSession(session));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-创建订单-前端页面"><a href="#6-创建订单-前端页面" class="headerlink" title="6.创建订单-前端页面"></a>6.创建订单-前端页面</h3><p>在”确认订单页”添加发送请求的处理方法使点击”在线支付”按钮可以创建订单并跳转到”支付信息页”(支付页显示详细商品信息这个功能这里不做了)</p>
<p><strong>请求参数是通过字符串拼接得到的,那么就必须用 get 请求,因为 post 请求不能拼接字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn-create-order&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> aid = $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">val</span>(); <span class="comment">//12</span></span><br><span class="line">  <span class="keyword">var</span> cids = location.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>); <span class="comment">//cids=4&amp;cids=6&amp;cids=8</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/orders/create&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;aid=&quot;</span> + aid + <span class="string">&quot;&amp;&quot;</span> + cids, <span class="comment">//aid=12&amp;cids=4&amp;cids=6&amp;cids=8</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">json</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (json.<span class="property">state</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        location.<span class="property">href</span> = <span class="string">&quot;payment.html&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;创建订单失败！&quot;</span> + json.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;创建订单数据时产生未知的异常&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><p>检测项目所有业务层方法的耗时(开始执行时间和结束执行时间只差值),再在不改变项目主体流程代码的前提条件下完成此功能,就要用到 AOP</p>
<blockquote>
<p>如果我们想对业务某一些方法同时添加相同的功能需求,并且在不改变业务功能逻辑的基础之上进行完成,就可以使用 AOP 的切面编程进行开发</p>
</blockquote>
<h3 id="1-Spring-AOP"><a href="#1-Spring-AOP" class="headerlink" title="1.Spring AOP"></a>1.Spring AOP</h3><p>AOP：面向切面（Aspect）编程。AOP 并不是 Spring 框架的特性(Spring 已经被整合到了 SpringBoot 中,所以如果 AOP 是 Spring 框架的特性,那么就不需要手动导包,只需要在一个类上写@Aspect 注解,鼠标放到该注解上按 alt+enter 就可以自动导包了,但是事与愿违,所以说 AOP 并不是 Spring 框架的特性)，只是 Spring 很好的支持了 AOP。</p>
<p>使用步骤:</p>
<ol>
<li>首先定义一个类,将这个类作为切面类</li>
<li>在这个类中定义切面方法(5 种:前置,后置,环绕,异常,最终)</li>
<li>将这个切面方法中的业务逻辑对应的代码进行编写和设计</li>
<li>通过连接点来连接目标方法,就是用粗粒度表达式和细粒度表达式来进行连接</li>
</ol>
<h3 id="2-切面方法"><a href="#2-切面方法" class="headerlink" title="2.切面方法"></a>2.切面方法</h3><p>1.切面方法的访问权限是 public。</p>
<p>2.切面方法的返回值类型可以是 void 或 Object，如果该方法被@Around 注解修饰，必须使用 Object 作为返回值类型，并返回连接点方法的返回值；如果使用的注解是@Before 或@After 等其他注解时，则自行决定。</p>
<p>3.切面方法的名称可以自定义。</p>
<p>4.切面方法可以接收参数,参数是 ProccedingJoinPoint 接口类型的参数.但是@Around 所修饰的方法必须要传递这个参数.其他注解修饰的方法要不要该参数都可以</p>
<h3 id="3-统计业务方法执行时长"><a href="#3-统计业务方法执行时长" class="headerlink" title="3 统计业务方法执行时长"></a>3 统计业务方法执行时长</h3><p>1.因为 AOP 不是 Spring 内部封装的技术,所以需要进行导包操作:在 pom.xml 文件中添加两个关于 AOP 的依赖 aspectjweaver 和 aspectjtools。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.在 com.cy.store.aop 包下创建 TimerAspect 切面类,给类添加两个注解进行修饰:</p>
<ul>
<li>@Aspect(将当前类标记为切面类)</li>
<li>@Component(将当前类的对象创建使用维护交由 Spring 容器维护)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimerAspect</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.在类中添加切面方法,这里使用环绕通知的方式来进行编写</p>
<p><strong>参数 ProceedingJoinPoint 接口表示连接点,也就是是目标方法的对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">//开始时间</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//调用目标方法,比如login方法,getByUid方法</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    <span class="comment">//结束时间</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;耗时:&quot;</span>+(end-start));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.将当前环绕通知映射到某个切面上,也就是指定连接的点.给 around 方法添加注解@Around</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(* com.cy.store.service.impl.*.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>第一个*表示方法返回值是任意的</li>
<li>第二个*表示 imp 包下的类是任意的</li>
<li>第三个*表示类里面的方法是任意的</li>
<li><p>(…)表示方法的参数是任意的</p>
<p>5.启动项目，在前端浏览器访问任意一个功能模块进行功能的测试</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://104483264.github.io/">陈文彬</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://104483264.github.io/posts/b75a4e69.html">https://104483264.github.io/posts/b75a4e69.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://104483264.github.io" target="_blank">卑微小陈的Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/6d/wallhaven-6dkg8w.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">卑微小陈在线乞讨</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.acwing.com/media/article/image/2022/10/31/127575_9ad32ca759-wx.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.acwing.com/media/article/image/2022/10/31/127575_9ad32ca759-wx.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://cdn.acwing.com/media/article/image/2022/10/31/127575_b388dd8a59-ali.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.acwing.com/media/article/image/2022/10/31/127575_b388dd8a59-ali.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><audio id="coinAudio" src="https://cdn.cbd.int/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin/coin.js"></script><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/posts/2c57c182.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/7p/wallhaven-7p6dzy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">acwing-springboot 8. 创建对战列表与排行榜页面</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/6482513a.html" title="springboot入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p93gm9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-14</div><div class="title">springboot入门</div></div></a></div><div><a href="/posts/bd56ed73.html" title="acwing-springboot 配置Mysql与注册登录模块（上）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6d/wallhaven-6djzl7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-28</div><div class="title">acwing-springboot 配置Mysql与注册登录模块（上）</div></div></a></div><div><a href="/posts/5ea8a16.html" title="acwing-springboot 配置Mysql与注册登录模块（下）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/9d/wallhaven-9dxv78.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-30</div><div class="title">acwing-springboot 配置Mysql与注册登录模块（下）</div></div></a></div><div><a href="/posts/80b37af4.html" title="acwing-springboot 配置Mysql与注册登录模块（中）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/kx/wallhaven-kx36mq.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-29</div><div class="title">acwing-springboot 配置Mysql与注册登录模块（中）</div></div></a></div><div><a href="/posts/2ebdbc54.html" title="acwing-springboot 创建个人中心页面(上)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/l8/wallhaven-l8qy8l.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-31</div><div class="title">acwing-springboot 创建个人中心页面(上)</div></div></a></div><div><a href="/posts/37a68d15.html" title="acwing-springboot 创建个人中心页面(下)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/l8/wallhaven-l8967r.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">acwing-springboot 创建个人中心页面(下)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">卑微小陈</div><div class="author-info__description">一个爱学习的好孩子写的博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/104483264" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gitHub"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=1044823264@qq.com" target="_blank" title="Email"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-rss"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/510951283" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=1044823264&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ1"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">文章目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number"></span> <span class="toc-text">项目环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">1.项目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">2.项目基本环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">3.项目创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">4.项目测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%B5%8B%E8%AF%95%E8%83%BD%E5%90%A6%E6%88%90%E5%8A%9F%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 测试能否成功连接数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%B5%8B%E8%AF%95%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%83%BD%E5%90%A6%E6%AD%A3%E5%B8%B8%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 测试静态资源能否正常加载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number"></span> <span class="toc-text">用户注册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">2.创建用户的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B3%A8%E5%86%8C-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.注册-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B3%A8%E5%86%8C-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.注册-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B3%A8%E5%86%8C-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.注册-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%88%9B%E5%BB%BA%E5%93%8D%E5%BA%94"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 创建响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 处理请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E6%8E%A7%E5%88%B6%E5%B1%82%E4%BC%98%E5%8C%96%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 控制层优化设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B3%A8%E5%86%8C-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.注册-前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E7%86%9F%E6%82%89-ajax"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 熟悉 ajax</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%89%8D%E7%AB%AF-js-%E7%BC%96%E5%86%99"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 前端 js 编写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number"></span> <span class="toc-text">用户登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%99%BB%E5%BD%95-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.登录-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.</span> <span class="toc-text">规划需要执行的 SQL 语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%99%BB%E5%BD%95-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.登录-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%99%BB%E5%BD%95-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.登录-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%99%BB%E5%BD%95-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.登录-前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%94%A8-session-%E5%AD%98%E5%82%A8%E5%92%8C%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">5.用 session 存储和获取用户数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">6.拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number"></span> <span class="toc-text">修改密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.修改密码-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.修改密码-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-1"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-1"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.修改密码-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-1"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-1"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-1"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.修改密码-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="toc-number"></span> <span class="toc-text">个人资料</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.个人资料-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-1"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-1"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.个人资料-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-2"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-2"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.个人资料-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-2"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-2"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-2"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.个人资料-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F"><span class="toc-number"></span> <span class="toc-text">上传头像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.上传头像-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1SQL-%E8%AF%AD%E5%8F%A5%E7%9A%84%E8%A7%84%E5%88%92"><span class="toc-number">1.1.</span> <span class="toc-text">1.1SQL 语句的规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-2"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-2"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-2"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.上传头像-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-3"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-3"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-3"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.上传头像-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.上传头像-前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E4%BF%AE%E5%A4%8D-bug"><span class="toc-number">5.</span> <span class="toc-text">5.前端页面优化——修复 bug</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%9A%84%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 更改默认的大小限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E4%B8%8A%E4%BC%A0%E5%90%8E%E6%98%BE%E7%A4%BA%E5%A4%B4%E5%83%8F"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 上传后显示头像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E7%99%BB%E5%BD%95%E5%90%8E%E6%98%BE%E7%A4%BA%E5%A4%B4%E5%83%8F"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 登录后显示头像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E6%98%BE%E7%A4%BA%E6%9C%80%E6%96%B0%E5%A4%B4%E5%83%8F"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 显示最新头像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number"></span> <span class="toc-text">新增收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-1"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">2.创建收货地址的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%B0%E5%A2%9E%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.新增收货地址-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%90%84%E5%8A%9F%E8%83%BD%E7%9A%84%E5%BC%80%E5%8F%91%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 各功能的开发顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%96%B0%E5%A2%9E%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.新增收货地址-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-1"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-1"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%96%B0%E5%A2%9E%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.新增收货地址-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-1"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-1"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%96%B0%E5%A2%9E%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.新增收货地址-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8"><span class="toc-number"></span> <span class="toc-text">获取省市区列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-2"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%9C%81%E5%B8%82%E5%8C%BA%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">2.创建省市区的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.获取省市区列表-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划需执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-1"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-1"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.获取省市区列表-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-2"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-2"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.获取省市区列表-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.获取省市区列表-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0"><span class="toc-number"></span> <span class="toc-text">获取省市区名称</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.获取省市区名称-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-1"><span class="toc-number">1.1.</span> <span class="toc-text">3.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.2.</span> <span class="toc-text">3.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-2"><span class="toc-number">1.3.</span> <span class="toc-text">3.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-2"><span class="toc-number">1.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.获取省市区名称-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-4"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-4"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-4"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.获取省市区名称-控制层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0-%E4%B8%9A%E5%8A%A1%E5%B1%82%E4%BC%98%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">4.获取省市区名称-业务层优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%90%8D%E7%A7%B0-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.</span> <span class="toc-text">5.获取省市区名称-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-number"></span> <span class="toc-text">收货地址列表展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.收货地址列表展示-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-1"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-3"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-3"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-3"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.收货地址列表展示-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-5"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-5"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-5"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.收货地址列表展示-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-3"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-3"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-3"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.收货地址列表展示-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number"></span> <span class="toc-text">设置默认收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.设置默认收货地址-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-2"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-4"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-4"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-4"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.设置默认收货地址-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-6"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-6"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-6"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.设置默认收货地址-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-4"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-4"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-4"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.设置默认收货地址-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number"></span> <span class="toc-text">删除收货地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.删除收货地址-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-3"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-5"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-5"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-5"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.删除收货地址-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-7"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-7"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-7"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.删除收货地址-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-5"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-5"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-3"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.删除收货地址-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C"><span class="toc-number"></span> <span class="toc-text">商品热销排行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-3"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">2.创建商品的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%95%86%E5%93%81%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.商品热销排行-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-2"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-2"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-3"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 编写映射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%95%86%E5%93%81%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.商品热销排行-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-3"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 设计接口和抽象方法及实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%95%86%E5%93%81%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.商品热销排行-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-1"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-2"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-2"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%95%86%E5%93%81-%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.商品-热销排行-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="toc-number"></span> <span class="toc-text">显示商品详情</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.显示商品详情-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-4"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-6"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-6"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.显示商品详情-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-8"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-8"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.显示商品详情-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-6"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-6"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-6"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.显示商品详情-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number"></span> <span class="toc-text">加入购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-4"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">2.创建购物车的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.加入购物车-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-3"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-3"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-4"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-4"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.加入购物车-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-4"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-3"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-3"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.加入购物车-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-2"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-3"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-3"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.加入购物车-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8"><span class="toc-number"></span> <span class="toc-text">显示购物车列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%98%BE%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.显示购物车列表-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-7"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-7"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-6"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%98%BE%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.显示购物车列表-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-9"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-9"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-8"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%98%BE%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.显示购物车列表-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-7"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-7"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-7"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%98%BE%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.显示购物车列表-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F"><span class="toc-number"></span> <span class="toc-text">增加商品数量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A2%9E%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.增加购物车商品数量-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-6"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-8"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-8"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-7"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A2%9E%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.增加购物车商品数量-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-10"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-10"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-9"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A2%9E%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.增加购物车商品数量-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-8"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A2%9E%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E6%95%B0%E9%87%8F-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.增加购物车商品数量-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95"><span class="toc-number"></span> <span class="toc-text">确认订单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.确认订单-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-7"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 设计接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%85%8D%E7%BD%AE%E6%98%A0%E5%B0%84"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 配置映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-8"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">2.确认订单-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-11"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0-11"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 设计接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-10"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.确认订单-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-9"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-9"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-9"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%A1%AE%E8%AE%A4%E8%AE%A2%E5%8D%95-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.确认订单-前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%98%BE%E7%A4%BA%E5%8B%BE%E9%80%89%E7%9A%84%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 显示勾选的购物车数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%98%BE%E7%A4%BA%E9%80%89%E6%8B%A9%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 显示选择收货地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="toc-number"></span> <span class="toc-text">创建订单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-5"><span class="toc-number">1.</span> <span class="toc-text">1.创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB-1"><span class="toc-number">2.</span> <span class="toc-text">2.创建用户的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.</span> <span class="toc-text">3.创建订单-持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%A7%84%E5%88%92%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-SQL-%E8%AF%AD%E5%8F%A5-4"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 规划需要执行的 SQL 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 实现接口和抽象方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%BC%96%E5%86%99%E6%98%A0%E5%B0%84-5"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 编写映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-5"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">4.创建订单-业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%A7%84%E5%88%92%E5%BC%82%E5%B8%B8-5"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 规划异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95%E5%8F%8A%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 实现接口和抽象方法及实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-4"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">5.创建订单-控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-3"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 处理异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E8%AE%A1%E8%AF%B7%E6%B1%82-4"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 设计请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82-4"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 处理请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">6.创建订单-前端页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP"><span class="toc-number"></span> <span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Spring-AOP"><span class="toc-number">1.</span> <span class="toc-text">1.Spring AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%87%E9%9D%A2%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">2.切面方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BB%9F%E8%AE%A1%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E9%95%BF"><span class="toc-number">3.</span> <span class="toc-text">3 统计业务方法执行时长</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/b75a4e69.html" title="电脑商城项目(springboot+mybatis)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/6d/wallhaven-6dkg8w.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="电脑商城项目(springboot+mybatis)"/></a><div class="content"><a class="title" href="/posts/b75a4e69.html" title="电脑商城项目(springboot+mybatis)">电脑商城项目(springboot+mybatis)</a><time datetime="2022-12-20T04:00:00.000Z" title="发表于 2022-12-20 12:00:00">2022-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2c57c182.html" title="acwing-springboot 8. 创建对战列表与排行榜页面"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/7p/wallhaven-7p6dzy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="acwing-springboot 8. 创建对战列表与排行榜页面"/></a><div class="content"><a class="title" href="/posts/2c57c182.html" title="acwing-springboot 8. 创建对战列表与排行榜页面">acwing-springboot 8. 创建对战列表与排行榜页面</a><time datetime="2022-12-06T11:51:00.000Z" title="发表于 2022-12-06 19:51:00">2022-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7a87d6c7.html" title="acwing-springboot 7. 实现微服务：Bot代码的执行"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/vq/wallhaven-vqml88.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="acwing-springboot 7. 实现微服务：Bot代码的执行"/></a><div class="content"><a class="title" href="/posts/7a87d6c7.html" title="acwing-springboot 7. 实现微服务：Bot代码的执行">acwing-springboot 7. 实现微服务：Bot代码的执行</a><time datetime="2022-11-29T12:00:00.000Z" title="发表于 2022-11-29 20:00:00">2022-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c0a8ef92.html" title="acwing-springboot 6. 实现微服务：匹配系统"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/jx/wallhaven-jx9gyy.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="acwing-springboot 6. 实现微服务：匹配系统"/></a><div class="content"><a class="title" href="/posts/c0a8ef92.html" title="acwing-springboot 6. 实现微服务：匹配系统">acwing-springboot 6. 实现微服务：匹配系统</a><time datetime="2022-11-02T16:25:00.000Z" title="发表于 2022-11-03 00:25:00">2022-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/37a68d15.html" title="acwing-springboot 创建个人中心页面(下)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/l8/wallhaven-l8967r.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="acwing-springboot 创建个人中心页面(下)"/></a><div class="content"><a class="title" href="/posts/37a68d15.html" title="acwing-springboot 创建个人中心页面(下)">acwing-springboot 创建个人中心页面(下)</a><time datetime="2022-10-31T16:30:00.000Z" title="发表于 2022-11-01 00:30:00">2022-11-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 卑微小陈</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://ky.cwbnb.top/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://ky.cwbnb.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div class="aplayer no-destroy" data-id="1708664797" data-server="tencent" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#425aef' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = '7e71f725c7b74f059102010b4b4a876b';
  var gaud_map_key = '899d624b2226d3fd390b19f852877f55';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.2.2" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime/runtime.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="/js/ali_font.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item swiper_container_card" style="height: auto;width: 100%"><div id="random"><div id="random-banner"><canvas id="peoplecanvas"></canvas></div><a id="random-hover" style="width:100%;height:auto;" href="javascript:toRandomPost()" rel="external nofollow noreferrer" one-link-mark="yes"><i class="fa fa-paper-plane" style="margin-left:10px"></i><div style="margin-left:10px">随便逛逛<i class="fa-solid fa-arrow-right" style="margin-left:10px"></i></div></a></div><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/270eeb2d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/1p/wallhaven-1p35kv.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/270eeb2d.html&quot;);" href="javascript:void(0);" alt="">mybatis-plus入门</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/270eeb2d.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/6482513a.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p93gm9.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/6482513a.html&quot;);" href="javascript:void(0);" alt="">springboot入门</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/6482513a.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/91794a99.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/57/wallhaven-571998.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-08</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/91794a99.html&quot;);" href="javascript:void(0);" alt="">ssm整合</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/91794a99.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/b824cc2f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/g7/wallhaven-g7319l.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/b824cc2f.html&quot;);" href="javascript:void(0);" alt="">springMVC入门</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/b824cc2f.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/dd9a467d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/d6/wallhaven-d6g1gl.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/dd9a467d.html&quot;);" href="javascript:void(0);" alt="">spring第一天</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/dd9a467d.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper_init.js"></script><script data-pjax src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/gsap/3.9.1/gsap.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/people.min.js"></script><script async src="/anzhiyu/random.js"></script><script data-pjax src="https://cdn.cbd.int/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://github.anzhiy.cn/api?104483264",['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'],'104483264')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>